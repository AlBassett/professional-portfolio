"use strict";
/** [[include:doc/result.md]] */
Object.defineProperty(exports, "__esModule", { value: true });
/** (keep typedoc from getting confused by the import) */
const maybe_1 = require("./maybe");
const unit_1 = require("./unit");
const utils_1 = require("./utils");
// So that it doesn't appear unused but can be exported.
utils_1._Brand; // tslint:disable-line:no-unused-expression
/**
  Discriminant for `Ok` and `Err` variants of `Result` type.

  You can use the discriminant via the `variant` property of `Result` instances
  if you need to match explicitly on it.
 */
var Variant;
(function (Variant) {
    Variant["Ok"] = "Ok";
    Variant["Err"] = "Err";
})(Variant = exports.Variant || (exports.Variant = {}));
/**
  An `Ok` instance is the *successful* variant instance of the
  [`Result`](../modules/_result_.html#result) type, representing a successful
  outcome from an operation which may fail. For a full discussion, see [the
  module docs](../modules/_result_.html).

  @typeparam T The type wrapped in this `Ok` variant of `Result`.
  @typeparam E The type which would be wrapped in an `Err` variant of `Result`.
 */
class Ok {
    /**
      Create an instance of `Result.Ok` with `new`.
  
      Note: While you *may* create the `Result` type via normal
      JavaScript class construction, it is not recommended for the functional
      style for which the library is intended. Instead, use [`Result.ok`].
  
      [`Result.ok`]: ../modules/_result_.html#ok
  
      ```ts
      // Avoid:
      const aString = new Result.Ok('characters');
  
      // Prefer:
      const aString = Result.ok('characters);
      ```
  
      Note that you may explicitly pass `Unit` to the `Ok` constructor to create
      a `Result<Unit, E>`. However, you may *not* call the `Ok` constructor with
      `null` or `undefined` to get that result (the type system won't allow you to
      construct it that way). Instead, for convenience, you can simply call
      `Result.ok()`, which will construct the type correctly.
  
      @param value
      The value to wrap in a `Result.Ok`.
  
      Note: `null` and `undefined` are allowed by the type signature so that the
      constructor may `throw` on those rather than constructing a type like
      `Result<undefined>`.
  
      @throws If you pass `null`.
     */
    constructor(value) {
        /** `Ok` is always [`Variant.Ok`](../enums/_result_.variant#ok). */
        this.variant = Variant.Ok;
        if (utils_1.isVoid(value)) {
            throw new Error('Tried to construct `Ok` with `null` or `undefined`. Maybe you want `Maybe.Nothing`?');
        }
        this.value = value;
    }
    /**
      Unwrap the contained value. A convenience method for functional idioms.
  
      A common scenario where you might want to use this is in a pipeline of
      functions:
  
      ```ts
      import Result, { Ok } from 'true-myth/result';
  
      function getLengths(results: Array<Result<string, string>>): Array<number> {
        return results
          .filter(Result.isOk)
          .map(Ok.unwrap)
          .map(s => s.length);
      }
      ```
     */
    static unwrap(theOk) {
        return theOk.value;
    }
    /** Method variant for [`Result.isOk`](../modules/_result_.html#isok) */
    isOk() {
        return true;
    }
    /** Method variant for [`Result.isErr`](../modules/_result_.html#iserr) */
    isErr() {
        return false;
    }
    /** Method variant for [`Result.map`](../modules/_result_.html#map) */
    map(mapFn) {
        return map(mapFn, this);
    }
    /** Method variant for [`Result.mapOr`](../modules/_result_.html#mapor) */
    mapOr(orU, mapFn) {
        return mapOr(orU, mapFn, this);
    }
    /** Method variant for [`Result.mapOrElse`](../modules/_result_.html#maporelse) */
    mapOrElse(orElseFn, mapFn) {
        return mapOrElse(orElseFn, mapFn, this);
    }
    /** Method variant for [`Result.match`](../modules/_result_.html#match) */
    match(matcher) {
        return match(matcher, this);
    }
    /** Method variant for [`Result.mapErr`](../modules/_result_.html#maperr) */
    mapErr(mapErrFn) {
        return mapErr(mapErrFn, this);
    }
    /** Method variant for [`Result.or`](../modules/_result_.html#or) */
    or(orResult) {
        return or(orResult, this);
    }
    /** Method variant for [`Result.orElse`](../modules/_result_.html#orelse) */
    orElse(orElseFn) {
        return orElse(orElseFn, this);
    }
    /** Method variant for [`Result.and`](../modules/_result_.html#and) */
    and(mAnd) {
        return and(mAnd, this);
    }
    /** Method variant for [`Result.andThen`](../modules/_result_.html#andthen) */
    andThen(andThenFn) {
        return andThen(andThenFn, this);
    }
    /** Method variant for [`Result.chain`](../modules/_result_.html#chain) */
    chain(chainFn) {
        return exports.chain(chainFn, this);
    }
    /** Method variant for [`Result.flatMap`](../modules/_result_.html#flatmap) */
    flatMap(flatMapFn) {
        return exports.flatMap(flatMapFn, this);
    }
    /** Method variant for [`Result.unwrap`](../modules/_result_.html#unwrap) */
    unsafelyUnwrap() {
        return this.value;
    }
    /** Method variant for [`Result.unwrapErr`](../modules/_result_.html#unwraperr) */
    unsafelyUnwrapErr() {
        throw new Error('Tried to `unsafelyUnwrapErr` an `Ok`');
    }
    /** Method variant for [`Result.unwrapOr`](../modules/_result_.html#unwrapor) */
    unwrapOr(defaultValue) {
        return unwrapOr(defaultValue, this);
    }
    /** Method variant for [`Result.unwrapOrElse`](../modules/_result_.html#unwrapOrElse) */
    unwrapOrElse(elseFn) {
        return unwrapOrElse(elseFn, this);
    }
    /** Method variant for [`Result.toMaybe`](../modules/_result_.html#tomaybe) */
    toMaybe() {
        return toMaybe(this);
    }
    /** Method variant for [`Result.toString`](../modules/_result_.html#tostring) */
    toString() {
        return exports.toString(this);
    }
    /** Method variant for [`Result.equals`](../modules/_result_.html#equals) */
    equals(comparison) {
        return equals(comparison, this);
    }
    /** Method variant for [`Result.ap`](../modules/_result_.html#ap) */
    ap(r) {
        return ap(this, r);
    }
}
exports.Ok = Ok;
/**
  An `Err` instance is the *failure* variant instance of the
  [`Result`](../modules/_result_.html#result) type, representing a failure
  outcome from an operation which may fail. For a full discussion, see [the
  module docs](../modules/_result_.html).

  @typeparam T The type which would be wrapped in an `Ok` variant of `Result`.
  @typeparam E The type wrapped in this `Err` variant of `Result`.
  */
class Err {
    /**
      Create an instance of `Result.Err` with `new`.
  
      Note: While you *may* create the `Result` type via normal
      JavaScript class construction, it is not recommended for the functional
      style for which the library is intended. Instead, use [`Result.err`].
  
      [`Result.err`]: ../modules/_result_.html#err
  
      ```ts
      // Avoid:
      const anErr = new Result.Err('alas, failure');
  
      // Prefer:
      const anErr = Result.err('alas, failure');
      ```
  
      Note that you may explicitly pass `Unit` to the `Err` constructor to create
      a `Result<T, Unit>`. However, you may *not* call the `Err` constructor with
      `null` or `undefined` to get that result (the type system won't allow you to
      construct it that way). Instead, for convenience, you can simply call
      `Result.err()`, which will construct the type correctly.
  
      @param error
      The value to wrap in a `Result.Err`.
  
      `Note: null` and `undefined` are allowed by the type signature so that the
      constructor may `throw` on those rather than constructing a type like
      `Result<number, undefined>`.
  
      @throws If you pass `null` or `undefined`.
     */
    constructor(error) {
        /** `Err` is always [`Variant.Err`](../enums/_result_.variant#err). */
        this.variant = Variant.Err;
        if (utils_1.isVoid(error)) {
            throw new Error('Tried to construct `Err` with `null` or `undefined`. Maybe you want `Maybe.Nothing`?');
        }
        this.error = error;
    }
    /**
      Unwrap the contained error . A convenience method for functional idioms.
  
      A common scenario where you might want to use this is in a pipeline of
      functions:
  
      ```ts
      import Result, { Ok } from 'true-myth/result';
  
      function getMessages(results: Array<Result<string, Error>>): Array<number> {
        return maybeStrings
          .filter(Result.isErr)
          .map(Err.unwrapErr)
          .map(e => e.message);
      }
      ```
     */
    static unwrapErr(theErr) {
        return theErr.error;
    }
    /** Method variant for [`Result.isOk`](../modules/_result_.html#isok) */
    isOk() {
        return false;
    }
    /** Method variant for [`Result.isErr`](../modules/_result_.html#iserr) */
    isErr() {
        return true;
    }
    /** Method variant for [`Result.map`](../modules/_result_.html#map) */
    map(mapFn) {
        return map(mapFn, this);
    }
    /** Method variant for [`Result.mapOr`](../modules/_result_.html#mapor) */
    mapOr(orU, mapFn) {
        return mapOr(orU, mapFn, this);
    }
    /** Method variant for [`Result.mapOrElse`](../modules/_result_.html#maporelse) */
    mapOrElse(orElseFn, mapFn) {
        return mapOrElse(orElseFn, mapFn, this);
    }
    /** Method variant for [`Result.match`](../modules/_result_.html#match) */
    match(matchObj) {
        return match(matchObj, this);
    }
    /** Method variant for [`Result.mapErr`](../modules/_result_.html#maperr) */
    mapErr(mapErrFn) {
        return mapErr(mapErrFn, this);
    }
    /** Method variant for [`Result.or`](../modules/_result_.html#or) */
    or(orResult) {
        return or(orResult, this);
    }
    /** Method variant for [`Result.orElse`](../modules/_result_.html#orelse) */
    orElse(orElseFn) {
        return orElse(orElseFn, this);
    }
    /** Method variant for [`Result.and`](../modules/_result_.html#and) */
    and(mAnd) {
        return and(mAnd, this);
    }
    /** Method variant for [`Result.andThen`](../modules/_result_.html#andthen) */
    andThen(andThenFn) {
        return andThen(andThenFn, this);
    }
    /** Method variant for [`Result.chain`](../modules/_result_.html#chain) */
    chain(chainFn) {
        return this.andThen(chainFn);
    }
    /** Method variant for [`Result.flatMap`](../modules/_result_.html#flatmap) */
    flatMap(flatMapFn) {
        return this.andThen(flatMapFn);
    }
    /** Method variant for [`Result.unsafelyUnwrap`](../modules/_result_.html#unsafelyunwrap) */
    unsafelyUnwrap() {
        throw new Error('Tried to `unsafelyUnwrap an Err`');
    }
    /** Method variant for [`Result.unsafelyUnwrapErr`](../modules/_result_.html#unsafelyunwraperr) */
    unsafelyUnwrapErr() {
        return this.error;
    }
    /** Method variant for [`Result.unwrapOr`](../modules/_result_.html#unwrapor) */
    unwrapOr(defaultValue) {
        return unwrapOr(defaultValue, this);
    }
    /** Method variant for [`Result.unwrapOrElse`](../modules/_result_.html#unwraporelse) */
    unwrapOrElse(elseFn) {
        return unwrapOrElse(elseFn, this);
    }
    /** Method variant for [`Result.toMaybe`](../modules/_result_.html#tomaybe) */
    toMaybe() {
        return toMaybe(this);
    }
    /** Method variant for [`Result.toString`](../modules/_result_.html#tostring) */
    toString() {
        return exports.toString(this);
    }
    /** Method variant for [`Result.equals`](../modules/_result_.html#equals) */
    equals(comparison) {
        return equals(comparison, this);
    }
    /** Method variant for [`Result.ap`](../modules/_result_.html#ap) */
    ap(r) {
        return ap(this, r);
    }
}
exports.Err = Err;
/**
  Is this `Result` an `Ok` instance?

  In TypeScript, narrows the type from `Result<T, E>` to `Ok<T, E>`.
 */
function isOk(result) {
    return result.variant === Variant.Ok;
}
exports.isOk = isOk;
/**
  Is this `Result` an `Err` instance?

  In TypeScript, narrows the type from `Result<T, E>` to `Err<T, E>`.
 */
function isErr(result) {
    return result.variant === Variant.Err;
}
exports.isErr = isErr;
function ok(value) {
    return value === undefined ? new Ok(unit_1.default) : new Ok(value);
}
exports.ok = ok;
/** `Result.of` is an alias for `Result.ok`. */
exports.of = ok;
function err(error) {
    return utils_1.isVoid(error) ? new Err(unit_1.default) : new Err(error);
}
exports.err = err;
function map(mapFn, result) {
    const op = (r) => (isOk(r) ? ok(mapFn(r.value)) : r);
    return utils_1.curry1(op, result);
}
exports.map = map;
function mapOr(orU, mapFn, result) {
    function fullOp(fn, r) {
        return isOk(r) ? fn(r.value) : orU;
    }
    function partialOp(fn, curriedResult) {
        return curriedResult !== undefined
            ? fullOp(fn, curriedResult)
            : (extraCurriedResult) => fullOp(fn, extraCurriedResult);
    }
    return mapFn === undefined
        ? partialOp
        : result === undefined
            ? partialOp(mapFn)
            : partialOp(mapFn, result);
}
exports.mapOr = mapOr;
function mapOrElse(orElseFn, mapFn, result) {
    function fullOp(fn, r) {
        return isOk(r) ? fn(r.value) : orElseFn(r.error);
    }
    function partialOp(fn, curriedResult) {
        return curriedResult !== undefined
            ? fullOp(fn, curriedResult)
            : (extraCurriedResult) => fullOp(fn, extraCurriedResult);
    }
    return mapFn === undefined
        ? partialOp
        : result === undefined
            ? partialOp(mapFn)
            : partialOp(mapFn, result);
}
exports.mapOrElse = mapOrElse;
function mapErr(mapErrFn, result) {
    const op = (r) => (isOk(r) ? r : err(mapErrFn(r.error)));
    return utils_1.curry1(op, result);
}
exports.mapErr = mapErr;
function and(andResult, result) {
    const op = (r) => (isOk(r) ? andResult : r);
    return utils_1.curry1(op, result);
}
exports.and = and;
function andThen(thenFn, result) {
    const op = (r) => (isOk(r) ? thenFn(r.value) : r);
    return utils_1.curry1(op, result);
}
exports.andThen = andThen;
/** Alias for [`andThen`](#andthen). */
exports.chain = andThen;
/** Alias for [`andThen`](#andthen). */
exports.flatMap = andThen;
function or(defaultResult, result) {
    const op = (r) => (isOk(r) ? r : defaultResult);
    return utils_1.curry1(op, result);
}
exports.or = or;
function orElse(elseFn, result) {
    const op = (r) => (isOk(r) ? r : elseFn(r.unsafelyUnwrapErr()));
    return utils_1.curry1(op, result);
}
exports.orElse = orElse;
/**
  Get the value out of the `Result`.

  Returns the content of an `Ok`, but **throws if the `Result` is `Err`.**
  Prefer to use [`unwrapOr`](#unwrapor) or [`unwrapOrElse`](#unwraporelse).

  @throws If the `Result` instance is `Nothing`.
 */
function unsafelyUnwrap(result) {
    return result.unsafelyUnwrap();
}
exports.unsafelyUnwrap = unsafelyUnwrap;
/** Alias for [`unsafelyUnwrap`](#unsafelyunwrap) */
exports.unsafelyGet = unsafelyUnwrap;
/** Alias for [`unsafelyUnwrap`](#unsafelyunwrap) */
exports.unsafeGet = unsafelyUnwrap;
/**
  Get the error value out of the [`Result`](#result).

  Returns the content of an `Err`, but **throws if the `Result` is `Ok`**.
  Prefer to use [`unwrapOrElse`](#unwraporelse).

  @param result
  @throws Error If the `Result` instance is `Nothing`.
 */
function unsafelyUnwrapErr(result) {
    return result.unsafelyUnwrapErr();
}
exports.unsafelyUnwrapErr = unsafelyUnwrapErr;
/** Alias for [`unsafelyUnwrapErr`](#unsafelyunwraperr) */
exports.unsafelyGetErr = unsafelyUnwrapErr;
function unwrapOr(defaultValue, result) {
    const op = (r) => (isOk(r) ? r.value : defaultValue);
    return utils_1.curry1(op, result);
}
exports.unwrapOr = unwrapOr;
/** Alias for [`unwrapOr`](#unwrapor) */
exports.getOr = unwrapOr;
function unwrapOrElse(orElseFn, result) {
    const op = (r) => (isOk(r) ? r.value : orElseFn(r.error));
    return utils_1.curry1(op, result);
}
exports.unwrapOrElse = unwrapOrElse;
/** Alias for [`unwrapOrElse`](#unwraporelse) */
exports.getOrElse = unwrapOrElse;
/**
  Convert a [`Result`](#result) to a [`Maybe`](../modules/_maybe_.html#maybe).

  The converted type will be [`Just`] if the `Result` is [`Ok`] or [`Nothing`]
  if the `Result` is [`Err`]; the wrapped error value will be discarded.

  [`Just`]: ../classes/_maybe_.just.html
  [`Nothing`]: ../classes/_maybe_.nothing.html
  [`Ok`]: ../classes/_result_.ok.html
  [`Err`]: ../classes/_result_.err.html

  @param result The `Result` to convert to a `Maybe`
  @returns      `Just` the value in `result` if it is `Ok`; otherwise `Nothing`
 */
function toMaybe(result) {
    return isOk(result) ? maybe_1.just(result.value) : maybe_1.nothing();
}
exports.toMaybe = toMaybe;
function fromMaybe(errValue, maybe) {
    const op = (m) => (maybe_1.isJust(m) ? ok(maybe_1.default.unsafelyUnwrap(m)) : err(errValue));
    return utils_1.curry1(op, maybe);
}
exports.fromMaybe = fromMaybe;
/**
  Create a `String` representation of a `result` instance.

  An `Ok` instance will be printed as `Ok(<representation of the value>)`, and
  an `Err` instance will be printed as `Err(<representation of the error>)`,
  where the representation of the value or error is simply the value or error's
  own `toString` representation. For example:

                call                |         output
  --------------------------------- | ----------------------
  `toString(ok(42))`                | `Ok(42)`
  `toString(ok([1, 2, 3]))`         | `Ok(1,2,3)`
  `toString(ok({ an: 'object' }))`  | `Ok([object Object])`n
  `toString(err(42))`               | `Err(42)`
  `toString(err([1, 2, 3]))`        | `Err(1,2,3)`
  `toString(err({ an: 'object' }))` | `Err([object Object])`

  @typeparam T The type of the wrapped value; its own `.toString` will be used
               to print the interior contents of the `Just` variant.
  @param maybe The value to convert to a string.
  @returns     The string representation of the `Maybe`.
 */
exports.toString = (result) => {
    const body = (isOk(result) ? result.value : result.error).toString();
    return `${result.variant.toString()}(${body})`;
};
function match(matcher, result) {
    const op = (r) => mapOrElse(matcher.Err, matcher.Ok, r);
    return utils_1.curry1(op, result);
}
exports.match = match;
/** Alias for [`match`](#match) */
exports.cata = match;
function equals(resultB, resultA) {
    return resultA !== undefined
        ? resultA.match({
            Err: () => isErr(resultB),
            Ok: a => isOk(resultB) && resultB.unsafelyUnwrap() === a,
        })
        : (curriedResultA) => curriedResultA.match({
            Err: () => isErr(resultB),
            Ok: a => isOk(resultB) && resultB.unsafelyUnwrap() === a,
        });
}
exports.equals = equals;
function ap(resultFn, result) {
    const op = (r) => r.match({
        Ok: val => resultFn.map(fn => fn(val)),
        Err: e => exports.Result.err(e),
    });
    return utils_1.curry1(op, result);
}
exports.ap = ap;
/**
  Determine whether an item is an instance of `Just` or `Nothing`.

  @param item The item to check.
 */
function isInstance(item) {
    return item instanceof Ok || item instanceof Err;
}
exports.isInstance = isInstance;
exports.Result = {
    Variant,
    Ok,
    Err,
    isOk,
    isErr,
    ok,
    err,
    map,
    mapOr,
    mapOrElse,
    mapErr,
    and,
    andThen,
    chain: exports.chain,
    flatMap: exports.flatMap,
    or,
    orElse,
    unsafelyUnwrap,
    unsafelyGet: exports.unsafelyGet,
    unsafeGet: exports.unsafeGet,
    unsafelyUnwrapErr,
    unsafelyGetErr: exports.unsafelyGetErr,
    unwrapOr,
    getOr: exports.getOr,
    unwrapOrElse,
    getOrElse: exports.getOrElse,
    toMaybe,
    fromMaybe,
    toString: exports.toString,
    match,
    cata: exports.cata,
    equals,
    ap,
    isInstance,
};
exports.default = exports.Result;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzdWx0LmpzIiwic291cmNlUm9vdCI6Ii4vIiwic291cmNlcyI6WyJyZXN1bHQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLGdDQUFnQzs7QUFFaEMseURBQXlEO0FBQ3pELG1DQUF1RDtBQUN2RCxpQ0FBMEI7QUFDMUIsbUNBQWlEO0FBRWpELHdEQUF3RDtBQUN4RCxjQUFNLENBQUMsQ0FBQywyQ0FBMkM7QUFFbkQ7Ozs7O0dBS0c7QUFDSCxJQUFZLE9BR1g7QUFIRCxXQUFZLE9BQU87SUFDakIsb0JBQVMsQ0FBQTtJQUNULHNCQUFXLENBQUE7QUFDYixDQUFDLEVBSFcsT0FBTyxHQUFQLGVBQU8sS0FBUCxlQUFPLFFBR2xCO0FBdUVEOzs7Ozs7OztHQVFHO0FBQ0gsTUFBYSxFQUFFO0lBNEJiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O09BK0JHO0lBQ0gsWUFBWSxLQUFnQjtRQXRDNUIsbUVBQW1FO1FBQzFELFlBQU8sR0FBZSxPQUFPLENBQUMsRUFBRSxDQUFDO1FBc0N4QyxJQUFJLGNBQU0sQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUNqQixNQUFNLElBQUksS0FBSyxDQUNiLHFGQUFxRixDQUN0RixDQUFDO1NBQ0g7UUFFRCxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztJQUNyQixDQUFDO0lBbkVEOzs7Ozs7Ozs7Ozs7Ozs7O09BZ0JHO0lBQ0gsTUFBTSxDQUFDLE1BQU0sQ0FBSSxLQUFpQjtRQUNoQyxPQUFPLEtBQUssQ0FBQyxLQUFLLENBQUM7SUFDckIsQ0FBQztJQWtERCx3RUFBd0U7SUFDeEUsSUFBSTtRQUNGLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELDBFQUEwRTtJQUMxRSxLQUFLO1FBQ0gsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRUQsc0VBQXNFO0lBQ3RFLEdBQUcsQ0FBd0IsS0FBa0I7UUFDM0MsT0FBTyxHQUFHLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQzFCLENBQUM7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QUFFLENBQUMsY0FBTSxDQUFDLEdBQUcsQ0FBTyxDQUFDLENBQUM7S0FDOUIsQ0FBQyxDQUFDO0lBRUwsT0FBTyxjQUFNLENBQUMsRUFBRSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0FBQzVCLENBQUM7QUFYRCxnQkFXQztBQUVEOzs7O0dBSUc7QUFDSCxTQUFnQixVQUFVLENBQW1CLElBQVM7SUFDcEQsT0FBTyxJQUFJLFlBQVksRUFBRSxJQUFJLElBQUksWUFBWSxHQUFHLENBQUM7QUFDbkQsQ0FBQztBQUZELGdDQUVDO0FBU1ksUUFBQSxNQUFNLEdBQUc7SUFDcEIsT0FBTztJQUNQLEVBQUU7SUFDRixHQUFHO0lBQ0gsSUFBSTtJQUNKLEtBQUs7SUFDTCxFQUFFO0lBQ0YsR0FBRztJQUNILEdBQUc7SUFDSCxLQUFLO0lBQ0wsU0FBUztJQUNULE1BQU07SUFDTixHQUFHO0lBQ0gsT0FBTztJQUNQLEtBQUssRUFBTCxhQUFLO0lBQ0wsT0FBTyxFQUFQLGVBQU87SUFDUCxFQUFFO0lBQ0YsTUFBTTtJQUNOLGNBQWM7SUFDZCxXQUFXLEVBQVgsbUJBQVc7SUFDWCxTQUFTLEVBQVQsaUJBQVM7SUFDVCxpQkFBaUI7SUFDakIsY0FBYyxFQUFkLHNCQUFjO0lBQ2QsUUFBUTtJQUNSLEtBQUssRUFBTCxhQUFLO0lBQ0wsWUFBWTtJQUNaLFNBQVMsRUFBVCxpQkFBUztJQUNULE9BQU87SUFDUCxTQUFTO0lBQ1QsUUFBUSxFQUFSLGdCQUFRO0lBQ1IsS0FBSztJQUNMLElBQUksRUFBSixZQUFJO0lBQ0osTUFBTTtJQUNOLEVBQUU7SUFDRixVQUFVO0NBQ1gsQ0FBQztBQUVGLGtCQUFlLGNBQU0sQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKiBbW2luY2x1ZGU6ZG9jL3Jlc3VsdC5tZF1dICovXG5cbi8qKiAoa2VlcCB0eXBlZG9jIGZyb20gZ2V0dGluZyBjb25mdXNlZCBieSB0aGUgaW1wb3J0KSAqL1xuaW1wb3J0IE1heWJlLCB7IGlzSnVzdCwganVzdCwgbm90aGluZyB9IGZyb20gJy4vbWF5YmUnO1xuaW1wb3J0IFVuaXQgZnJvbSAnLi91bml0JztcbmltcG9ydCB7IF9CcmFuZCwgY3VycnkxLCBpc1ZvaWQgfSBmcm9tICcuL3V0aWxzJztcblxuLy8gU28gdGhhdCBpdCBkb2Vzbid0IGFwcGVhciB1bnVzZWQgYnV0IGNhbiBiZSBleHBvcnRlZC5cbl9CcmFuZDsgLy8gdHNsaW50OmRpc2FibGUtbGluZTpuby11bnVzZWQtZXhwcmVzc2lvblxuXG4vKipcbiAgRGlzY3JpbWluYW50IGZvciBgT2tgIGFuZCBgRXJyYCB2YXJpYW50cyBvZiBgUmVzdWx0YCB0eXBlLlxuXG4gIFlvdSBjYW4gdXNlIHRoZSBkaXNjcmltaW5hbnQgdmlhIHRoZSBgdmFyaWFudGAgcHJvcGVydHkgb2YgYFJlc3VsdGAgaW5zdGFuY2VzXG4gIGlmIHlvdSBuZWVkIHRvIG1hdGNoIGV4cGxpY2l0bHkgb24gaXQuXG4gKi9cbmV4cG9ydCBlbnVtIFZhcmlhbnQge1xuICBPayA9ICdPaycsXG4gIEVyciA9ICdFcnInLFxufVxuXG4vKiogU2ltcGx5IGRlZmluZXMgdGhlIGNvbW1vbiBzaGFwZSBmb3IgYE9rYCBhbmQgYEVycmAuICovXG5leHBvcnQgaW50ZXJmYWNlIFJlc3VsdFNoYXBlPFQsIEU+IHtcbiAgLyoqIERpc3Rpbmd1aXNoIGJldHdlZW4gdGhlIGBPa2AgYW5kIGBFcnJgIHZhcmlhbnRzLiAqL1xuICByZWFkb25seSB2YXJpYW50OiBWYXJpYW50O1xuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQuaXNPa2BdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNpc29rKSAqL1xuICBpc09rKHRoaXM6IFJlc3VsdDxULCBFPik6IHRoaXMgaXMgT2s8VCwgRT47XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5pc0VycmBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNpc2VycikgKi9cbiAgaXNFcnIodGhpczogUmVzdWx0PFQsIEU+KTogdGhpcyBpcyBFcnI8VCwgRT47XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5tYXBgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjbWFwKSAqL1xuICBtYXA8VT4odGhpczogUmVzdWx0PFQsIEU+LCBtYXBGbjogKHQ6IFQpID0+IFUpOiBSZXN1bHQ8VSwgRT47XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5tYXBPcmBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNtYXBvcikgKi9cbiAgbWFwT3I8VT4odGhpczogUmVzdWx0PFQsIEU+LCBvclU6IFUsIG1hcEZuOiAodDogVCkgPT4gVSk6IFU7XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5tYXBPckVsc2VgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjbWFwb3JlbHNlKSAqL1xuICBtYXBPckVsc2U8VT4odGhpczogUmVzdWx0PFQsIEU+LCBvckVsc2VGbjogKGVycjogRSkgPT4gVSwgbWFwRm46ICh0OiBUKSA9PiBVKTogVTtcblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0Lm1hdGNoYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI21hdGNoKSAqL1xuICBtYXRjaDxVPih0aGlzOiBSZXN1bHQ8VCwgRT4sIG1hdGNoZXI6IE1hdGNoZXI8VCwgRSwgVT4pOiBVO1xuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQubWFwRXJyYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI21hcGVycikgKi9cbiAgbWFwRXJyPEY+KHRoaXM6IFJlc3VsdDxULCBFPiwgbWFwRXJyRm46IChlOiBFKSA9PiBGKTogUmVzdWx0PFQsIEY+O1xuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQub3JgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjb3IpICovXG4gIG9yPEY+KHRoaXM6IFJlc3VsdDxULCBFPiwgb3JSZXN1bHQ6IFJlc3VsdDxULCBGPik6IFJlc3VsdDxULCBGPjtcblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0Lm9yRWxzZWBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNvcmVsc2UpICovXG4gIG9yRWxzZTxGPih0aGlzOiBSZXN1bHQ8VCwgRT4sIG9yRWxzZUZuOiAoZXJyOiBFKSA9PiBSZXN1bHQ8VCwgRj4pOiBSZXN1bHQ8VCwgRj47XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5hbmRgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjYW5kKSAqL1xuICBhbmQ8VT4odGhpczogUmVzdWx0PFQsIEU+LCBtQW5kOiBSZXN1bHQ8VSwgRT4pOiBSZXN1bHQ8VSwgRT47XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5hbmRUaGVuYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI2FuZHRoZW4pICovXG4gIGFuZFRoZW48VT4odGhpczogUmVzdWx0PFQsIEU+LCBhbmRUaGVuRm46ICh0OiBUKSA9PiBSZXN1bHQ8VSwgRT4pOiBSZXN1bHQ8VSwgRT47XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5jaGFpbmBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNjaGFpbikgKi9cbiAgY2hhaW48VT4odGhpczogUmVzdWx0PFQsIEU+LCBjaGFpbkZuOiAodDogVCkgPT4gUmVzdWx0PFUsIEU+KTogUmVzdWx0PFUsIEU+O1xuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQuZmxhdE1hcGBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNmbGF0bWFwKSAqL1xuICBmbGF0TWFwPFU+KHRoaXM6IFJlc3VsdDxULCBFPiwgY2hhaW5GbjogKHQ6IFQpID0+IFJlc3VsdDxVLCBFPik6IFJlc3VsdDxVLCBFPjtcblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LnVud3JhcGBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCN1bndyYXApICovXG4gIHVuc2FmZWx5VW53cmFwKCk6IFQgfCBuZXZlcjtcblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LnVud3JhcEVycmBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCN1bndyYXBlcnIpICovXG4gIHVuc2FmZWx5VW53cmFwRXJyKCk6IEUgfCBuZXZlcjtcblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LnVud3JhcE9yYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI3Vud3JhcG9yKSAqL1xuICB1bndyYXBPcih0aGlzOiBSZXN1bHQ8VCwgRT4sIGRlZmF1bHRWYWx1ZTogVCk6IFQ7XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC51bndyYXBPckVsc2VgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjdW53cmFwT3JFbHNlKSAqL1xuICB1bndyYXBPckVsc2UodGhpczogUmVzdWx0PFQsIEU+LCBlbHNlRm46IChlcnJvcjogRSkgPT4gVCk6IFQ7XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC50b01heWJlYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI3RvbWF5YmUpICovXG4gIHRvTWF5YmUodGhpczogUmVzdWx0PFQsIEU+KTogTWF5YmU8VD47XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC50b1N0cmluZ2BdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCN0b3N0cmluZykgKi9cbiAgdG9TdHJpbmcodGhpczogUmVzdWx0PFQsIEU+KTogc3RyaW5nO1xuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQuZXF1YWxzYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI2VxdWFscykgKi9cbiAgZXF1YWxzKHRoaXM6IFJlc3VsdDxULCBFPiwgY29tcGFyaXNvbjogUmVzdWx0PFQsIEU+KTogYm9vbGVhbjtcblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LmFwYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI2FwKSAqL1xuICBhcDxBLCBCPih0aGlzOiBSZXN1bHQ8KGE6IEEpID0+IEIsIEU+LCByOiBSZXN1bHQ8QSwgRT4pOiBSZXN1bHQ8QiwgRT47XG59XG5cbi8qKlxuICBBbiBgT2tgIGluc3RhbmNlIGlzIHRoZSAqc3VjY2Vzc2Z1bCogdmFyaWFudCBpbnN0YW5jZSBvZiB0aGVcbiAgW2BSZXN1bHRgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjcmVzdWx0KSB0eXBlLCByZXByZXNlbnRpbmcgYSBzdWNjZXNzZnVsXG4gIG91dGNvbWUgZnJvbSBhbiBvcGVyYXRpb24gd2hpY2ggbWF5IGZhaWwuIEZvciBhIGZ1bGwgZGlzY3Vzc2lvbiwgc2VlIFt0aGVcbiAgbW9kdWxlIGRvY3NdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCkuXG5cbiAgQHR5cGVwYXJhbSBUIFRoZSB0eXBlIHdyYXBwZWQgaW4gdGhpcyBgT2tgIHZhcmlhbnQgb2YgYFJlc3VsdGAuXG4gIEB0eXBlcGFyYW0gRSBUaGUgdHlwZSB3aGljaCB3b3VsZCBiZSB3cmFwcGVkIGluIGFuIGBFcnJgIHZhcmlhbnQgb2YgYFJlc3VsdGAuXG4gKi9cbmV4cG9ydCBjbGFzcyBPazxULCBFPiBpbXBsZW1lbnRzIFJlc3VsdFNoYXBlPFQsIEU+IHtcbiAgLyoqXG4gICAgVW53cmFwIHRoZSBjb250YWluZWQgdmFsdWUuIEEgY29udmVuaWVuY2UgbWV0aG9kIGZvciBmdW5jdGlvbmFsIGlkaW9tcy5cblxuICAgIEEgY29tbW9uIHNjZW5hcmlvIHdoZXJlIHlvdSBtaWdodCB3YW50IHRvIHVzZSB0aGlzIGlzIGluIGEgcGlwZWxpbmUgb2ZcbiAgICBmdW5jdGlvbnM6XG5cbiAgICBgYGB0c1xuICAgIGltcG9ydCBSZXN1bHQsIHsgT2sgfSBmcm9tICd0cnVlLW15dGgvcmVzdWx0JztcblxuICAgIGZ1bmN0aW9uIGdldExlbmd0aHMocmVzdWx0czogQXJyYXk8UmVzdWx0PHN0cmluZywgc3RyaW5nPj4pOiBBcnJheTxudW1iZXI+IHtcbiAgICAgIHJldHVybiByZXN1bHRzXG4gICAgICAgIC5maWx0ZXIoUmVzdWx0LmlzT2spXG4gICAgICAgIC5tYXAoT2sudW53cmFwKVxuICAgICAgICAubWFwKHMgPT4gcy5sZW5ndGgpO1xuICAgIH1cbiAgICBgYGBcbiAgICovXG4gIHN0YXRpYyB1bndyYXA8Tz4odGhlT2s6IE9rPE8sIGFueT4pOiBPIHtcbiAgICByZXR1cm4gdGhlT2sudmFsdWU7XG4gIH1cblxuICAvKiogYE9rYCBpcyBhbHdheXMgW2BWYXJpYW50Lk9rYF0oLi4vZW51bXMvX3Jlc3VsdF8udmFyaWFudCNvaykuICovXG4gIHJlYWRvbmx5IHZhcmlhbnQ6IFZhcmlhbnQuT2sgPSBWYXJpYW50Lk9rO1xuXG4gIC8qKiBUaGUgd3JhcHBlZCB2YWx1ZS4gKi9cbiAgcmVhZG9ubHkgdmFsdWU6IFQ7XG5cbiAgLyoqXG4gICAgQ3JlYXRlIGFuIGluc3RhbmNlIG9mIGBSZXN1bHQuT2tgIHdpdGggYG5ld2AuXG5cbiAgICBOb3RlOiBXaGlsZSB5b3UgKm1heSogY3JlYXRlIHRoZSBgUmVzdWx0YCB0eXBlIHZpYSBub3JtYWxcbiAgICBKYXZhU2NyaXB0IGNsYXNzIGNvbnN0cnVjdGlvbiwgaXQgaXMgbm90IHJlY29tbWVuZGVkIGZvciB0aGUgZnVuY3Rpb25hbFxuICAgIHN0eWxlIGZvciB3aGljaCB0aGUgbGlicmFyeSBpcyBpbnRlbmRlZC4gSW5zdGVhZCwgdXNlIFtgUmVzdWx0Lm9rYF0uXG5cbiAgICBbYFJlc3VsdC5va2BdOiAuLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjb2tcblxuICAgIGBgYHRzXG4gICAgLy8gQXZvaWQ6XG4gICAgY29uc3QgYVN0cmluZyA9IG5ldyBSZXN1bHQuT2soJ2NoYXJhY3RlcnMnKTtcblxuICAgIC8vIFByZWZlcjpcbiAgICBjb25zdCBhU3RyaW5nID0gUmVzdWx0Lm9rKCdjaGFyYWN0ZXJzKTtcbiAgICBgYGBcblxuICAgIE5vdGUgdGhhdCB5b3UgbWF5IGV4cGxpY2l0bHkgcGFzcyBgVW5pdGAgdG8gdGhlIGBPa2AgY29uc3RydWN0b3IgdG8gY3JlYXRlXG4gICAgYSBgUmVzdWx0PFVuaXQsIEU+YC4gSG93ZXZlciwgeW91IG1heSAqbm90KiBjYWxsIHRoZSBgT2tgIGNvbnN0cnVjdG9yIHdpdGhcbiAgICBgbnVsbGAgb3IgYHVuZGVmaW5lZGAgdG8gZ2V0IHRoYXQgcmVzdWx0ICh0aGUgdHlwZSBzeXN0ZW0gd29uJ3QgYWxsb3cgeW91IHRvXG4gICAgY29uc3RydWN0IGl0IHRoYXQgd2F5KS4gSW5zdGVhZCwgZm9yIGNvbnZlbmllbmNlLCB5b3UgY2FuIHNpbXBseSBjYWxsXG4gICAgYFJlc3VsdC5vaygpYCwgd2hpY2ggd2lsbCBjb25zdHJ1Y3QgdGhlIHR5cGUgY29ycmVjdGx5LlxuXG4gICAgQHBhcmFtIHZhbHVlXG4gICAgVGhlIHZhbHVlIHRvIHdyYXAgaW4gYSBgUmVzdWx0Lk9rYC5cblxuICAgIE5vdGU6IGBudWxsYCBhbmQgYHVuZGVmaW5lZGAgYXJlIGFsbG93ZWQgYnkgdGhlIHR5cGUgc2lnbmF0dXJlIHNvIHRoYXQgdGhlXG4gICAgY29uc3RydWN0b3IgbWF5IGB0aHJvd2Agb24gdGhvc2UgcmF0aGVyIHRoYW4gY29uc3RydWN0aW5nIGEgdHlwZSBsaWtlXG4gICAgYFJlc3VsdDx1bmRlZmluZWQ+YC5cblxuICAgIEB0aHJvd3MgSWYgeW91IHBhc3MgYG51bGxgLlxuICAgKi9cbiAgY29uc3RydWN0b3IodmFsdWU/OiBUIHwgbnVsbCkge1xuICAgIGlmIChpc1ZvaWQodmFsdWUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdUcmllZCB0byBjb25zdHJ1Y3QgYE9rYCB3aXRoIGBudWxsYCBvciBgdW5kZWZpbmVkYC4gTWF5YmUgeW91IHdhbnQgYE1heWJlLk5vdGhpbmdgPydcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5pc09rYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI2lzb2spICovXG4gIGlzT2sodGhpczogUmVzdWx0PFQsIEU+KTogdGhpcyBpcyBPazxULCBFPiB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LmlzRXJyYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI2lzZXJyKSAqL1xuICBpc0Vycih0aGlzOiBSZXN1bHQ8VCwgRT4pOiB0aGlzIGlzIEVycjxULCBFPiB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5tYXBgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjbWFwKSAqL1xuICBtYXA8VT4odGhpczogUmVzdWx0PFQsIEU+LCBtYXBGbjogKHQ6IFQpID0+IFUpOiBSZXN1bHQ8VSwgRT4ge1xuICAgIHJldHVybiBtYXAobWFwRm4sIHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5tYXBPcmBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNtYXBvcikgKi9cbiAgbWFwT3I8VT4odGhpczogUmVzdWx0PFQsIEU+LCBvclU6IFUsIG1hcEZuOiAodDogVCkgPT4gVSk6IFUge1xuICAgIHJldHVybiBtYXBPcihvclUsIG1hcEZuLCB0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQubWFwT3JFbHNlYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI21hcG9yZWxzZSkgKi9cbiAgbWFwT3JFbHNlPFU+KHRoaXM6IFJlc3VsdDxULCBFPiwgb3JFbHNlRm46IChlcnI6IEUpID0+IFUsIG1hcEZuOiAodDogVCkgPT4gVSk6IFUge1xuICAgIHJldHVybiBtYXBPckVsc2Uob3JFbHNlRm4sIG1hcEZuLCB0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQubWF0Y2hgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjbWF0Y2gpICovXG4gIG1hdGNoPFU+KHRoaXM6IFJlc3VsdDxULCBFPiwgbWF0Y2hlcjogTWF0Y2hlcjxULCBFLCBVPik6IFUge1xuICAgIHJldHVybiBtYXRjaChtYXRjaGVyLCB0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQubWFwRXJyYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI21hcGVycikgKi9cbiAgbWFwRXJyPEY+KHRoaXM6IFJlc3VsdDxULCBFPiwgbWFwRXJyRm46IChlOiBFKSA9PiBGKTogUmVzdWx0PFQsIEY+IHtcbiAgICByZXR1cm4gbWFwRXJyKG1hcEVyckZuLCB0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQub3JgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjb3IpICovXG4gIG9yPEY+KHRoaXM6IFJlc3VsdDxULCBFPiwgb3JSZXN1bHQ6IFJlc3VsdDxULCBGPik6IFJlc3VsdDxULCBGPiB7XG4gICAgcmV0dXJuIG9yKG9yUmVzdWx0LCB0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQub3JFbHNlYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI29yZWxzZSkgKi9cbiAgb3JFbHNlPEY+KHRoaXM6IFJlc3VsdDxULCBFPiwgb3JFbHNlRm46IChlcnI6IEUpID0+IFJlc3VsdDxULCBGPik6IFJlc3VsdDxULCBGPiB7XG4gICAgcmV0dXJuIG9yRWxzZShvckVsc2VGbiwgdGhpcyk7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LmFuZGBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNhbmQpICovXG4gIGFuZDxVPih0aGlzOiBSZXN1bHQ8VCwgRT4sIG1BbmQ6IFJlc3VsdDxVLCBFPik6IFJlc3VsdDxVLCBFPiB7XG4gICAgcmV0dXJuIGFuZChtQW5kLCB0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQuYW5kVGhlbmBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNhbmR0aGVuKSAqL1xuICBhbmRUaGVuPFU+KHRoaXM6IFJlc3VsdDxULCBFPiwgYW5kVGhlbkZuOiAodDogVCkgPT4gUmVzdWx0PFUsIEU+KTogUmVzdWx0PFUsIEU+IHtcbiAgICByZXR1cm4gYW5kVGhlbihhbmRUaGVuRm4sIHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5jaGFpbmBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNjaGFpbikgKi9cbiAgY2hhaW48VT4odGhpczogUmVzdWx0PFQsIEU+LCBjaGFpbkZuOiAodDogVCkgPT4gUmVzdWx0PFUsIEU+KTogUmVzdWx0PFUsIEU+IHtcbiAgICByZXR1cm4gY2hhaW4oY2hhaW5GbiwgdGhpcyk7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LmZsYXRNYXBgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjZmxhdG1hcCkgKi9cbiAgZmxhdE1hcDxVPih0aGlzOiBSZXN1bHQ8VCwgRT4sIGZsYXRNYXBGbjogKHQ6IFQpID0+IFJlc3VsdDxVLCBFPik6IFJlc3VsdDxVLCBFPiB7XG4gICAgcmV0dXJuIGZsYXRNYXAoZmxhdE1hcEZuLCB0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQudW53cmFwYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI3Vud3JhcCkgKi9cbiAgdW5zYWZlbHlVbndyYXAoKTogVCB7XG4gICAgcmV0dXJuIHRoaXMudmFsdWU7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LnVud3JhcEVycmBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCN1bndyYXBlcnIpICovXG4gIHVuc2FmZWx5VW53cmFwRXJyKCk6IG5ldmVyIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1RyaWVkIHRvIGB1bnNhZmVseVVud3JhcEVycmAgYW4gYE9rYCcpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC51bndyYXBPcmBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCN1bndyYXBvcikgKi9cbiAgdW53cmFwT3IodGhpczogUmVzdWx0PFQsIEU+LCBkZWZhdWx0VmFsdWU6IFQpOiBUIHtcbiAgICByZXR1cm4gdW53cmFwT3IoZGVmYXVsdFZhbHVlLCB0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQudW53cmFwT3JFbHNlYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI3Vud3JhcE9yRWxzZSkgKi9cbiAgdW53cmFwT3JFbHNlKHRoaXM6IFJlc3VsdDxULCBFPiwgZWxzZUZuOiAoZXJyb3I6IEUpID0+IFQpOiBUIHtcbiAgICByZXR1cm4gdW53cmFwT3JFbHNlKGVsc2VGbiwgdGhpcyk7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LnRvTWF5YmVgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjdG9tYXliZSkgKi9cbiAgdG9NYXliZSh0aGlzOiBSZXN1bHQ8VCwgRT4pOiBNYXliZTxUPiB7XG4gICAgcmV0dXJuIHRvTWF5YmUodGhpcyk7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LnRvU3RyaW5nYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI3Rvc3RyaW5nKSAqL1xuICB0b1N0cmluZyh0aGlzOiBSZXN1bHQ8VCwgRT4pOiBzdHJpbmcge1xuICAgIHJldHVybiB0b1N0cmluZyh0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQuZXF1YWxzYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI2VxdWFscykgKi9cbiAgZXF1YWxzKHRoaXM6IFJlc3VsdDxULCBFPiwgY29tcGFyaXNvbjogUmVzdWx0PFQsIEU+KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGVxdWFscyhjb21wYXJpc29uLCB0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQuYXBgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjYXApICovXG4gIGFwPEEsIEI+KHRoaXM6IFJlc3VsdDwoYTogQSkgPT4gQiwgRT4sIHI6IFJlc3VsdDxBLCBFPik6IFJlc3VsdDxCLCBFPiB7XG4gICAgcmV0dXJuIGFwKHRoaXMsIHIpO1xuICB9XG59XG5cbi8qKlxuICBBbiBgRXJyYCBpbnN0YW5jZSBpcyB0aGUgKmZhaWx1cmUqIHZhcmlhbnQgaW5zdGFuY2Ugb2YgdGhlXG4gIFtgUmVzdWx0YF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI3Jlc3VsdCkgdHlwZSwgcmVwcmVzZW50aW5nIGEgZmFpbHVyZVxuICBvdXRjb21lIGZyb20gYW4gb3BlcmF0aW9uIHdoaWNoIG1heSBmYWlsLiBGb3IgYSBmdWxsIGRpc2N1c3Npb24sIHNlZSBbdGhlXG4gIG1vZHVsZSBkb2NzXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwpLlxuXG4gIEB0eXBlcGFyYW0gVCBUaGUgdHlwZSB3aGljaCB3b3VsZCBiZSB3cmFwcGVkIGluIGFuIGBPa2AgdmFyaWFudCBvZiBgUmVzdWx0YC5cbiAgQHR5cGVwYXJhbSBFIFRoZSB0eXBlIHdyYXBwZWQgaW4gdGhpcyBgRXJyYCB2YXJpYW50IG9mIGBSZXN1bHRgLlxuICAqL1xuZXhwb3J0IGNsYXNzIEVycjxULCBFPiBpbXBsZW1lbnRzIFJlc3VsdFNoYXBlPFQsIEU+IHtcbiAgLyoqXG4gICAgVW53cmFwIHRoZSBjb250YWluZWQgZXJyb3IgLiBBIGNvbnZlbmllbmNlIG1ldGhvZCBmb3IgZnVuY3Rpb25hbCBpZGlvbXMuXG5cbiAgICBBIGNvbW1vbiBzY2VuYXJpbyB3aGVyZSB5b3UgbWlnaHQgd2FudCB0byB1c2UgdGhpcyBpcyBpbiBhIHBpcGVsaW5lIG9mXG4gICAgZnVuY3Rpb25zOlxuXG4gICAgYGBgdHNcbiAgICBpbXBvcnQgUmVzdWx0LCB7IE9rIH0gZnJvbSAndHJ1ZS1teXRoL3Jlc3VsdCc7XG5cbiAgICBmdW5jdGlvbiBnZXRNZXNzYWdlcyhyZXN1bHRzOiBBcnJheTxSZXN1bHQ8c3RyaW5nLCBFcnJvcj4+KTogQXJyYXk8bnVtYmVyPiB7XG4gICAgICByZXR1cm4gbWF5YmVTdHJpbmdzXG4gICAgICAgIC5maWx0ZXIoUmVzdWx0LmlzRXJyKVxuICAgICAgICAubWFwKEVyci51bndyYXBFcnIpXG4gICAgICAgIC5tYXAoZSA9PiBlLm1lc3NhZ2UpO1xuICAgIH1cbiAgICBgYGBcbiAgICovXG4gIHN0YXRpYyB1bndyYXBFcnI8Rj4odGhlRXJyOiBFcnI8RiwgYW55Pik6IEYge1xuICAgIHJldHVybiB0aGVFcnIuZXJyb3I7XG4gIH1cblxuICAvKiogYEVycmAgaXMgYWx3YXlzIFtgVmFyaWFudC5FcnJgXSguLi9lbnVtcy9fcmVzdWx0Xy52YXJpYW50I2VycikuICovXG4gIHJlYWRvbmx5IHZhcmlhbnQ6IFZhcmlhbnQuRXJyID0gVmFyaWFudC5FcnI7XG5cbiAgLyoqIFRoZSB3cmFwcGVkIGVycm9yIHZhbHVlLiAqL1xuICByZWFkb25seSBlcnJvcjogRTtcblxuICAvKipcbiAgICBDcmVhdGUgYW4gaW5zdGFuY2Ugb2YgYFJlc3VsdC5FcnJgIHdpdGggYG5ld2AuXG5cbiAgICBOb3RlOiBXaGlsZSB5b3UgKm1heSogY3JlYXRlIHRoZSBgUmVzdWx0YCB0eXBlIHZpYSBub3JtYWxcbiAgICBKYXZhU2NyaXB0IGNsYXNzIGNvbnN0cnVjdGlvbiwgaXQgaXMgbm90IHJlY29tbWVuZGVkIGZvciB0aGUgZnVuY3Rpb25hbFxuICAgIHN0eWxlIGZvciB3aGljaCB0aGUgbGlicmFyeSBpcyBpbnRlbmRlZC4gSW5zdGVhZCwgdXNlIFtgUmVzdWx0LmVycmBdLlxuXG4gICAgW2BSZXN1bHQuZXJyYF06IC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNlcnJcblxuICAgIGBgYHRzXG4gICAgLy8gQXZvaWQ6XG4gICAgY29uc3QgYW5FcnIgPSBuZXcgUmVzdWx0LkVycignYWxhcywgZmFpbHVyZScpO1xuXG4gICAgLy8gUHJlZmVyOlxuICAgIGNvbnN0IGFuRXJyID0gUmVzdWx0LmVycignYWxhcywgZmFpbHVyZScpO1xuICAgIGBgYFxuXG4gICAgTm90ZSB0aGF0IHlvdSBtYXkgZXhwbGljaXRseSBwYXNzIGBVbml0YCB0byB0aGUgYEVycmAgY29uc3RydWN0b3IgdG8gY3JlYXRlXG4gICAgYSBgUmVzdWx0PFQsIFVuaXQ+YC4gSG93ZXZlciwgeW91IG1heSAqbm90KiBjYWxsIHRoZSBgRXJyYCBjb25zdHJ1Y3RvciB3aXRoXG4gICAgYG51bGxgIG9yIGB1bmRlZmluZWRgIHRvIGdldCB0aGF0IHJlc3VsdCAodGhlIHR5cGUgc3lzdGVtIHdvbid0IGFsbG93IHlvdSB0b1xuICAgIGNvbnN0cnVjdCBpdCB0aGF0IHdheSkuIEluc3RlYWQsIGZvciBjb252ZW5pZW5jZSwgeW91IGNhbiBzaW1wbHkgY2FsbFxuICAgIGBSZXN1bHQuZXJyKClgLCB3aGljaCB3aWxsIGNvbnN0cnVjdCB0aGUgdHlwZSBjb3JyZWN0bHkuXG5cbiAgICBAcGFyYW0gZXJyb3JcbiAgICBUaGUgdmFsdWUgdG8gd3JhcCBpbiBhIGBSZXN1bHQuRXJyYC5cblxuICAgIGBOb3RlOiBudWxsYCBhbmQgYHVuZGVmaW5lZGAgYXJlIGFsbG93ZWQgYnkgdGhlIHR5cGUgc2lnbmF0dXJlIHNvIHRoYXQgdGhlXG4gICAgY29uc3RydWN0b3IgbWF5IGB0aHJvd2Agb24gdGhvc2UgcmF0aGVyIHRoYW4gY29uc3RydWN0aW5nIGEgdHlwZSBsaWtlXG4gICAgYFJlc3VsdDxudW1iZXIsIHVuZGVmaW5lZD5gLlxuXG4gICAgQHRocm93cyBJZiB5b3UgcGFzcyBgbnVsbGAgb3IgYHVuZGVmaW5lZGAuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihlcnJvcjogRSB8IG51bGwpIHtcbiAgICBpZiAoaXNWb2lkKGVycm9yKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnVHJpZWQgdG8gY29uc3RydWN0IGBFcnJgIHdpdGggYG51bGxgIG9yIGB1bmRlZmluZWRgLiBNYXliZSB5b3Ugd2FudCBgTWF5YmUuTm90aGluZ2A/J1xuICAgICAgKTtcbiAgICB9XG5cbiAgICB0aGlzLmVycm9yID0gZXJyb3I7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LmlzT2tgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjaXNvaykgKi9cbiAgaXNPayh0aGlzOiBSZXN1bHQ8VCwgRT4pOiB0aGlzIGlzIE9rPFQsIEU+IHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LmlzRXJyYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI2lzZXJyKSAqL1xuICBpc0Vycih0aGlzOiBSZXN1bHQ8VCwgRT4pOiB0aGlzIGlzIEVycjxULCBFPiB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0Lm1hcGBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNtYXApICovXG4gIG1hcDxVPih0aGlzOiBSZXN1bHQ8VCwgRT4sIG1hcEZuOiAodDogVCkgPT4gVSk6IFJlc3VsdDxVLCBFPiB7XG4gICAgcmV0dXJuIG1hcChtYXBGbiwgdGhpcyk7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0Lm1hcE9yYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI21hcG9yKSAqL1xuICBtYXBPcjxVPih0aGlzOiBSZXN1bHQ8VCwgRT4sIG9yVTogVSwgbWFwRm46ICh0OiBUKSA9PiBVKTogVSB7XG4gICAgcmV0dXJuIG1hcE9yKG9yVSwgbWFwRm4sIHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5tYXBPckVsc2VgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjbWFwb3JlbHNlKSAqL1xuICBtYXBPckVsc2U8VT4odGhpczogUmVzdWx0PFQsIEU+LCBvckVsc2VGbjogKGVycjogRSkgPT4gVSwgbWFwRm46ICh0OiBUKSA9PiBVKTogVSB7XG4gICAgcmV0dXJuIG1hcE9yRWxzZShvckVsc2VGbiwgbWFwRm4sIHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5tYXRjaGBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNtYXRjaCkgKi9cbiAgbWF0Y2g8VT4odGhpczogUmVzdWx0PFQsIEU+LCBtYXRjaE9iajogTWF0Y2hlcjxULCBFLCBVPik6IFUge1xuICAgIHJldHVybiBtYXRjaChtYXRjaE9iaiwgdGhpcyk7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0Lm1hcEVycmBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNtYXBlcnIpICovXG4gIG1hcEVycjxGPih0aGlzOiBSZXN1bHQ8VCwgRT4sIG1hcEVyckZuOiAoZTogRSkgPT4gRik6IFJlc3VsdDxULCBGPiB7XG4gICAgcmV0dXJuIG1hcEVycihtYXBFcnJGbiwgdGhpcyk7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0Lm9yYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI29yKSAqL1xuICBvcjxGPih0aGlzOiBSZXN1bHQ8VCwgRT4sIG9yUmVzdWx0OiBSZXN1bHQ8VCwgRj4pOiBSZXN1bHQ8VCwgRj4ge1xuICAgIHJldHVybiBvcihvclJlc3VsdCwgdGhpcyk7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0Lm9yRWxzZWBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNvcmVsc2UpICovXG4gIG9yRWxzZTxGPih0aGlzOiBSZXN1bHQ8VCwgRT4sIG9yRWxzZUZuOiAoZXJyOiBFKSA9PiBSZXN1bHQ8VCwgRj4pOiBSZXN1bHQ8VCwgRj4ge1xuICAgIHJldHVybiBvckVsc2Uob3JFbHNlRm4sIHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5hbmRgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjYW5kKSAqL1xuICBhbmQ8VT4odGhpczogUmVzdWx0PFQsIEU+LCBtQW5kOiBSZXN1bHQ8VSwgRT4pOiBSZXN1bHQ8VSwgRT4ge1xuICAgIHJldHVybiBhbmQobUFuZCwgdGhpcyk7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LmFuZFRoZW5gXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjYW5kdGhlbikgKi9cbiAgYW5kVGhlbjxVPih0aGlzOiBSZXN1bHQ8VCwgRT4sIGFuZFRoZW5GbjogKHQ6IFQpID0+IFJlc3VsdDxVLCBFPik6IFJlc3VsdDxVLCBFPiB7XG4gICAgcmV0dXJuIGFuZFRoZW4oYW5kVGhlbkZuLCB0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQuY2hhaW5gXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjY2hhaW4pICovXG4gIGNoYWluPFU+KHRoaXM6IFJlc3VsdDxULCBFPiwgY2hhaW5GbjogKHQ6IFQpID0+IFJlc3VsdDxVLCBFPik6IFJlc3VsdDxVLCBFPiB7XG4gICAgcmV0dXJuIHRoaXMuYW5kVGhlbihjaGFpbkZuKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQuZmxhdE1hcGBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNmbGF0bWFwKSAqL1xuICBmbGF0TWFwPFU+KHRoaXM6IFJlc3VsdDxULCBFPiwgZmxhdE1hcEZuOiAodDogVCkgPT4gUmVzdWx0PFUsIEU+KTogUmVzdWx0PFUsIEU+IHtcbiAgICByZXR1cm4gdGhpcy5hbmRUaGVuKGZsYXRNYXBGbik7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LnVuc2FmZWx5VW53cmFwYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI3Vuc2FmZWx5dW53cmFwKSAqL1xuICB1bnNhZmVseVVud3JhcCgpOiBuZXZlciB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdUcmllZCB0byBgdW5zYWZlbHlVbndyYXAgYW4gRXJyYCcpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC51bnNhZmVseVVud3JhcEVycmBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCN1bnNhZmVseXVud3JhcGVycikgKi9cbiAgdW5zYWZlbHlVbndyYXBFcnIoKTogRSB7XG4gICAgcmV0dXJuIHRoaXMuZXJyb3I7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LnVud3JhcE9yYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI3Vud3JhcG9yKSAqL1xuICB1bndyYXBPcih0aGlzOiBSZXN1bHQ8VCwgRT4sIGRlZmF1bHRWYWx1ZTogVCk6IFQge1xuICAgIHJldHVybiB1bndyYXBPcihkZWZhdWx0VmFsdWUsIHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC51bndyYXBPckVsc2VgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjdW53cmFwb3JlbHNlKSAqL1xuICB1bndyYXBPckVsc2UodGhpczogUmVzdWx0PFQsIEU+LCBlbHNlRm46IChlcnJvcjogRSkgPT4gVCk6IFQge1xuICAgIHJldHVybiB1bndyYXBPckVsc2UoZWxzZUZuLCB0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQudG9NYXliZWBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCN0b21heWJlKSAqL1xuICB0b01heWJlKHRoaXM6IFJlc3VsdDxULCBFPik6IE1heWJlPFQ+IHtcbiAgICByZXR1cm4gdG9NYXliZSh0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQudG9TdHJpbmdgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjdG9zdHJpbmcpICovXG4gIHRvU3RyaW5nKHRoaXM6IFJlc3VsdDxULCBFPik6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRvU3RyaW5nKHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5lcXVhbHNgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjZXF1YWxzKSAqL1xuICBlcXVhbHModGhpczogUmVzdWx0PFQsIEU+LCBjb21wYXJpc29uOiBSZXN1bHQ8VCwgRT4pOiBib29sZWFuIHtcbiAgICByZXR1cm4gZXF1YWxzKGNvbXBhcmlzb24sIHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5hcGBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNhcCkgKi9cbiAgYXA8QSwgQj4odGhpczogUmVzdWx0PChhOiBBKSA9PiBCLCBFPiwgcjogUmVzdWx0PEEsIEU+KTogUmVzdWx0PEIsIEU+IHtcbiAgICByZXR1cm4gYXAodGhpcywgcik7XG4gIH1cbn1cblxuLyoqXG4gIElzIHRoaXMgYFJlc3VsdGAgYW4gYE9rYCBpbnN0YW5jZT9cblxuICBJbiBUeXBlU2NyaXB0LCBuYXJyb3dzIHRoZSB0eXBlIGZyb20gYFJlc3VsdDxULCBFPmAgdG8gYE9rPFQsIEU+YC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzT2s8VCwgRT4ocmVzdWx0OiBSZXN1bHQ8VCwgRT4pOiByZXN1bHQgaXMgT2s8VCwgRT4ge1xuICByZXR1cm4gcmVzdWx0LnZhcmlhbnQgPT09IFZhcmlhbnQuT2s7XG59XG5cbi8qKlxuICBJcyB0aGlzIGBSZXN1bHRgIGFuIGBFcnJgIGluc3RhbmNlP1xuXG4gIEluIFR5cGVTY3JpcHQsIG5hcnJvd3MgdGhlIHR5cGUgZnJvbSBgUmVzdWx0PFQsIEU+YCB0byBgRXJyPFQsIEU+YC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzRXJyPFQsIEU+KHJlc3VsdDogUmVzdWx0PFQsIEU+KTogcmVzdWx0IGlzIEVycjxULCBFPiB7XG4gIHJldHVybiByZXN1bHQudmFyaWFudCA9PT0gVmFyaWFudC5FcnI7XG59XG5cbi8qKlxuICBDcmVhdGUgYW4gaW5zdGFuY2Ugb2YgYFJlc3VsdC5Pa2AuXG5cbiAgSWYgeW91IG5lZWQgdG8gY3JlYXRlIGFuIGluc3RhbmNlIHdpdGggYSBzcGVjaWZpYyB0eXBlIChhcyB5b3UgZG8gd2hlbmV2ZXIgeW91XG4gIGFyZSBub3QgY29uc3RydWN0aW5nIGltbWVkaWF0ZWx5IGZvciBhIGZ1bmN0aW9uIHJldHVybiBvciBhcyBhbiBhcmd1bWVudCB0byBhXG4gIGZ1bmN0aW9uKSwgeW91IGNhbiB1c2UgYSB0eXBlIHBhcmFtZXRlcjpcblxuICBgYGB0c1xuICBjb25zdCB5YXlOdW1iZXIgPSBSZXN1bHQub2s8bnVtYmVyLCBzdHJpbmc+KDEyKTtcbiAgYGBgXG5cbiAgTm90ZTogYG51bGxgIGlzIGFsbG93ZWQgYnkgdGhlIHR5cGUgc2lnbmF0dXJlIHNvIHRoYXQgc28gdGhhdCB0aGUgZnVuY3Rpb25cbiAgbWF5IGJlIHVzZWQgdG8gIGB0aHJvd2Agb24gcGFzc2luZyBgbnVsbGAgcmF0aGVyIHRoYW4gY29uc3RydWN0aW5nIGEgdHlwZSBsaWtlXG4gIGBSZXN1bHQ8bnVsbCwgc3RyaW5nPmAuIGB1bmRlZmluZWRgIGlzIGFsbG93ZWQgYXMgYSBjb252ZW5pZW5jZSBtZXRob2QgZm9yXG4gIGNvbnN0cnVjdGluZyBhIGBSZXN1bHQ8VW5pdCwgRT5gLlxuXG4gIGBgYHRzXG4gIGNvbnN0IG5vcm1hbFJlc3VsdCA9IFJlc3VsdC5vazxudW1iZXIsIHN0cmluZz4oNDIpO1xuICBjb25zdCBleHBsaWNpdFVuaXQgPSBSZXN1bHQub2s8VW5pdCwgc3RyaW5nPihVbml0KTtcbiAgY29uc3QgaW1wbGljaXRVbml0ID0gUmVzdWx0Lm9rPFVuaXQsIHN0cmluZz4oKTtcbiAgYGBgXG5cbiAgSW4gdGhlIGNvbnRleHQgb2YgYW4gaW1tZWRpYXRlIGZ1bmN0aW9uIHJldHVybiwgb3IgYW4gYXJyb3cgZnVuY3Rpb24gd2l0aCBhXG4gIHNpbmdsZSBleHByZXNzaW9uIHZhbHVlLCB5b3UgZG8gbm90IGhhdmUgdG8gc3BlY2lmeSB0aGUgdHlwZXMsIHNvIHRoaXMgY2FuIGJlXG4gIHF1aXRlIGNvbnZlbmllbnQuXG5cbiAgYGBgdHNcbiAgdHlwZSBTb21lRGF0YSA9IHtcbiAgICAvLy4uLlxuICB9O1xuXG4gIGNvbnN0IGlzVmFsaWQgPSAoZGF0YTogU29tZURhdGEpOiBib29sZWFuID0+IHtcbiAgICAvLyB0cnVlIG9yIGZhbHNlLi4uXG4gIH1cblxuICBjb25zdCBhcnJvd1ZhbGlkYXRlID0gKGRhdGE6IFNvbWVEYXRhKTogUmVzdWx0PFVuaXQsIHN0cmluZz4gPT5cbiAgICBpc1ZhbGlkKGRhdGEpID8gUmVzdWx0Lm9rKCkgOiBSZXN1bHQuZXJyKCdzb21ldGhpbmcgd2FzIHdyb25nIScpO1xuXG4gIGZ1bmN0aW9uIGZuVmFsaWRhdGUoZGF0YTogc29tZURhdGEpOiBSZXN1bHQ8VW5pdCwgc3RyaW5nPiB7XG4gICAgcmV0dXJuIGlzVmFsaWQoZGF0YSkgPyBSZXN1bHQub2soKSA6IFJlc3VsdC5lcnIoJ3NvbWV0aGluZyB3YXMgd3JvbmcnKTtcbiAgfVxuICBgYGBcblxuICBAdHlwZXBhcmFtIFQgVGhlIHR5cGUgb2YgdGhlIGl0ZW0gY29udGFpbmVkIGluIHRoZSBgUmVzdWx0YC5cbiAgQHBhcmFtIHZhbHVlIFRoZSB2YWx1ZSB0byB3cmFwIGluIGEgYFJlc3VsdC5Pa2AuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBvazxULCBFPigpOiBSZXN1bHQ8VW5pdCwgRT47XG5leHBvcnQgZnVuY3Rpb24gb2s8VCwgRT4odmFsdWU6IFQpOiBSZXN1bHQ8VCwgRT47XG5leHBvcnQgZnVuY3Rpb24gb2s8VCwgRT4odmFsdWU/OiBUKTogUmVzdWx0PFVuaXQsIEU+IHwgUmVzdWx0PFQsIEU+IHtcbiAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPyBuZXcgT2soVW5pdCkgOiBuZXcgT2sodmFsdWUpO1xufVxuXG4vKiogYFJlc3VsdC5vZmAgaXMgYW4gYWxpYXMgZm9yIGBSZXN1bHQub2tgLiAqL1xuZXhwb3J0IGNvbnN0IG9mID0gb2s7XG5cbi8qKlxuICBDcmVhdGUgYW4gaW5zdGFuY2Ugb2YgYFJlc3VsdC5FcnJvcmAuXG5cbiAgSWYgeW91IG5lZWQgdG8gY3JlYXRlIGFuIGluc3RhbmNlIHdpdGggYSBzcGVjaWZpYyB0eXBlIChhcyB5b3UgZG8gd2hlbmV2ZXIgeW91XG4gIGFyZSBub3QgY29uc3RydWN0aW5nIGltbWVkaWF0ZWx5IGZvciBhIGZ1bmN0aW9uIHJldHVybiBvciBhcyBhbiBhcmd1bWVudCB0byBhXG4gIGZ1bmN0aW9uKSwgeW91IGNhbiB1c2UgYSB0eXBlIHBhcmFtZXRlcjpcblxuICBgYGB0c1xuICBjb25zdCBub3RTdHJpbmcgPSBSZXN1bHQuZXJyPG51bWJlciwgc3RyaW5nPignc29tZXRoaW5nIHdlbnQgd3JvbmcnKTtcbiAgYGBgXG5cbiAgTm90ZTogYG51bGxgIGlzIGFsbG93ZWQgYnkgdGhlIHR5cGUgc2lnbmF0dXJlIHNvIHRoYXQgc28gdGhhdCB0aGUgZnVuY3Rpb25cbiAgbWF5IGJlIHVzZWQgdG8gIGB0aHJvd2Agb24gcGFzc2luZyBgbnVsbGAgcmF0aGVyIHRoYW4gY29uc3RydWN0aW5nIGEgdHlwZSBsaWtlXG4gIGBSZXN1bHQ8bnVsbCwgc3RyaW5nPmAuIGB1bmRlZmluZWRgIGlzIGFsbG93ZWQgYXMgYSBjb252ZW5pZW5jZSBtZXRob2QgZm9yXG4gIGNvbnN0cnVjdGluZyBhIGBSZXN1bHQ8VW5pdCwgRT5gLlxuXG4gIGBgYHRzXG4gIGNvbnN0IG5vcm1hbFJlc3VsdCA9IFJlc3VsdC5lcnI8bnVtYmVyLCBzdHJpbmc+KCdvaCBubycpO1xuICBjb25zdCBleHBsaWNpdFVuaXQgPSBSZXN1bHQuZXJyPG51bWJlciwgVW5pdD4oVW5pdCk7XG4gIGNvbnN0IGltcGxpY2l0VW5pdCA9IFJlc3VsdC5lcnI8bnVtYmVyLCBVbml0PigpO1xuICBgYGBcblxuICBJbiB0aGUgY29udGV4dCBvZiBhbiBpbW1lZGlhdGUgZnVuY3Rpb24gcmV0dXJuLCBvciBhbiBhcnJvdyBmdW5jdGlvbiB3aXRoIGFcbiAgc2luZ2xlIGV4cHJlc3Npb24gdmFsdWUsIHlvdSBkbyBub3QgaGF2ZSB0byBzcGVjaWZ5IHRoZSB0eXBlcywgc28gdGhpcyBjYW4gYmVcbiAgcXVpdGUgY29udmVuaWVudC5cblxuICBgYGB0c1xuICB0eXBlIFNvbWVEYXRhID0ge1xuICAgIC8vLi4uXG4gIH07XG5cbiAgY29uc3QgaXNWYWxpZCA9IChkYXRhOiBTb21lRGF0YSk6IGJvb2xlYW4gPT4ge1xuICAgIC8vIHRydWUgb3IgZmFsc2UuLi5cbiAgfVxuXG4gIGNvbnN0IGFycm93VmFsaWRhdGUgPSAoZGF0YTogU29tZURhdGEpOiBSZXN1bHQ8bnVtYmVyLCBVbml0PiA9PlxuICAgIGlzVmFsaWQoZGF0YSkgPyBSZXN1bHQub2soNDIpIDogUmVzdWx0LmVycigpO1xuXG4gIGZ1bmN0aW9uIGZuVmFsaWRhdGUoZGF0YTogc29tZURhdGEpOiBSZXN1bHQ8bnVtYmVyLCBVbml0PiB7XG4gICAgcmV0dXJuIGlzVmFsaWQoZGF0YSkgPyBSZXN1bHQub2soNDIpIDogUmVzdWx0LmVycigpO1xuICB9XG4gIGBgYFxuXG4gIEB0eXBlcGFyYW0gVCBUaGUgdHlwZSBvZiB0aGUgaXRlbSBjb250YWluZWQgaW4gdGhlIGBSZXN1bHRgLlxuICBAcGFyYW0gRSBUaGUgZXJyb3IgdmFsdWUgdG8gd3JhcCBpbiBhIGBSZXN1bHQuRXJyYC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGVycjxULCBFPigpOiBSZXN1bHQ8VCwgVW5pdD47XG5leHBvcnQgZnVuY3Rpb24gZXJyPFQsIEU+KGVycm9yOiBFKTogUmVzdWx0PFQsIEU+O1xuZXhwb3J0IGZ1bmN0aW9uIGVycjxULCBFPihlcnJvcj86IEUpOiBSZXN1bHQ8VCwgVW5pdD4gfCBSZXN1bHQ8VCwgRT4ge1xuICByZXR1cm4gaXNWb2lkKGVycm9yKSA/IG5ldyBFcnIoVW5pdCkgOiBuZXcgRXJyKGVycm9yKTtcbn1cblxuLyoqXG4gIE1hcCBvdmVyIGEgYFJlc3VsdGAgaW5zdGFuY2U6IGFwcGx5IHRoZSBmdW5jdGlvbiB0byB0aGUgd3JhcHBlZCB2YWx1ZSBpZiB0aGVcbiAgaW5zdGFuY2UgaXMgYE9rYCwgYW5kIHJldHVybiB0aGUgd3JhcHBlZCBlcnJvciB2YWx1ZSB3cmFwcGVkIGFzIGEgbmV3IGBFcnJgIG9mXG4gIHRoZSBjb3JyZWN0IHR5cGUgKGBSZXN1bHQ8VSwgRT5gKSBpZiB0aGUgaW5zdGFuY2UgaXMgYEVycmAuXG5cbiAgYFJlc3VsdC5tYXBgIHdvcmtzIGEgbG90IGxpa2UgYEFycmF5LnByb3RvdHlwZS5tYXBgLCBidXQgd2l0aCBvbmUgaW1wb3J0YW50XG4gIGRpZmZlcmVuY2UuIEJvdGggYFJlc3VsdGAgYW5kIGBBcnJheWAgYXJlIGNvbnRhaW5lcnMgZm9yIG90aGVyIGtpbmRzIG9mIGl0ZW1zLFxuICBidXQgd2hlcmUgYEFycmF5LnByb3RvdHlwZS5tYXBgIGhhcyAwIHRvIF9uXyBpdGVtcywgYSBgUmVzdWx0YCBhbHdheXMgaGFzXG4gIGV4YWN0bHkgb25lIGl0ZW0sIHdoaWNoIGlzICplaXRoZXIqIGEgc3VjY2VzcyBvciBhbiBlcnJvciBpbnN0YW5jZS5cblxuICBXaGVyZSBgQXJyYXkucHJvdG90eXBlLm1hcGAgd2lsbCBhcHBseSB0aGUgbWFwcGluZyBmdW5jdGlvbiB0byBldmVyeSBpdGVtIGluXG4gIHRoZSBhcnJheSAoaWYgdGhlcmUgYXJlIGFueSksIGBSZXN1bHQubWFwYCB3aWxsIG9ubHkgYXBwbHkgdGhlIG1hcHBpbmdcbiAgZnVuY3Rpb24gdG8gdGhlIChzaW5nbGUpIGVsZW1lbnQgaWYgYW4gYE9rYCBpbnN0YW5jZSwgaWYgdGhlcmUgaXMgb25lLlxuXG4gIElmIHlvdSBoYXZlIG5vIGl0ZW1zIGluIGFuIGFycmF5IG9mXG4gIG51bWJlcnMgbmFtZWQgYGZvb2AgYW5kIGNhbGwgYGZvby5tYXAoeCA9PiB4ICsgMSlgLCB5b3UnbGwgc3RpbGwgc29tZSBoYXZlIGFuXG4gIGFycmF5IHdpdGggbm90aGluZyBpbiBpdC4gQnV0IGlmIHlvdSBoYXZlIGFueSBpdGVtcyBpbiB0aGUgYXJyYXkgKGBbMiwgM11gKSxcbiAgYW5kIHlvdSBjYWxsIGBmb28ubWFwKHggPT4geCArIDEpYCBvbiBpdCwgeW91J2xsIGdldCBhIG5ldyBhcnJheSB3aXRoIGVhY2ggb2ZcbiAgdGhvc2UgaXRlbXMgaW5zaWRlIHRoZSBhcnJheSBcImNvbnRhaW5lclwiIHRyYW5zZm9ybWVkIChgWzMsIDRdYCkuXG5cbiAgV2l0aCBgUmVzdWx0Lm1hcGAsIHRoZSBgRXJyYCB2YXJpYW50IGlzIHRyZWF0ZWQgKmJ5IHRoZSBgbWFwYCBmdW5jdGlvbioga2luZFxuICBvZiB0aGUgc2FtZSB3YXkgYXMgdGhlIGVtcHR5IGFycmF5IGNhc2U6IGl0J3MganVzdCBpZ25vcmVkLCBhbmQgeW91IGdldCBiYWNrIGFcbiAgbmV3IGBSZXN1bHRgIHRoYXQgaXMgc3RpbGwganVzdCB0aGUgc2FtZSBgRXJyYCBpbnN0YW5jZS4gQnV0IGlmIHlvdSBoYXZlIGFuXG4gIGBPa2AgdmFyaWFudCwgdGhlIG1hcCBmdW5jdGlvbiBpcyBhcHBsaWVkIHRvIGl0LCBhbmQgeW91IGdldCBiYWNrIGEgbmV3XG4gIGBSZXN1bHRgIHdpdGggdGhlIHZhbHVlIHRyYW5zZm9ybWVkLCBhbmQgc3RpbGwgd3JhcHBlZCBpbiBhbiBgT2tgLlxuXG4gICMjIyMgRXhhbXBsZXNcblxuICBgYGB0c1xuICBpbXBvcnQgeyBvaywgZXJyLCBtYXAsIHRvU3RyaW5nIH0gZnJvbSAndHJ1ZS1teXRoL3Jlc3VsdCc7XG4gIGNvbnN0IGRvdWJsZSA9IG4gPT4gbiAqIDI7XG5cbiAgY29uc3QgYW5PayA9IG9rKDEyKTtcbiAgY29uc3QgbWFwcGVkT2sgPSBtYXAoZG91YmxlLCBhbk9rKTtcbiAgY29uc29sZS5sb2codG9TdHJpbmcobWFwcGVkT2spKTsgLy8gT2soMjQpXG5cbiAgY29uc3QgYW5FcnIgPSBlcnIoXCJub3RoaW5nIGhlcmUhXCIpO1xuICBjb25zdCBtYXBwZWRFcnIgPSBtYXAoZG91YmxlLCBhbkVycik7XG4gIGNvbnNvbGUubG9nKHRvU3RyaW5nKG1hcHBlZE9rKSk7IC8vIEVycihub3RoaW5nIGhlcmUhKVxuICBgYGBcblxuICBAdHlwZXBhcmFtIFQgIFRoZSB0eXBlIG9mIHRoZSB2YWx1ZSB3cmFwcGVkIGluIGFuIGBPa2AgaW5zdGFuY2UsIGFuZCB0YWtlbiBhc1xuICAgICAgICAgICAgICAgIHRoZSBhcmd1bWVudCB0byB0aGUgYG1hcEZuYC5cbiAgQHR5cGVwYXJhbSBVICBUaGUgdHlwZSBvZiB0aGUgdmFsdWUgd3JhcHBlZCBpbiB0aGUgbmV3IGBPa2AgaW5zdGFuY2UgYWZ0ZXJcbiAgICAgICAgICAgICAgICBhcHBseWluZyBgbWFwRm5gLCB0aGF0IGlzLCB0aGUgdHlwZSByZXR1cm5lZCBieSBgbWFwRm5gLlxuICBAdHlwZXBhcmFtIEUgIFRoZSB0eXBlIG9mIHRoZSB2YWx1ZSB3cmFwcGVkIGluIGFuIGBFcnJgIGluc3RhbmNlLlxuICBAcGFyYW0gbWFwRm4gIFRoZSBmdW5jdGlvbiB0byBhcHBseSB0aGUgdmFsdWUgdG8gaWYgYHJlc3VsdGAgaXMgYE9rYC5cbiAgQHBhcmFtIHJlc3VsdCBUaGUgYFJlc3VsdGAgaW5zdGFuY2UgdG8gbWFwIG92ZXIuXG4gIEByZXR1cm5zICAgICAgQSBuZXcgYFJlc3VsdGAgd2l0aCB0aGUgcmVzdWx0IG9mIGFwcGx5aW5nIGBtYXBGbmAgdG8gdGhlIHZhbHVlXG4gICAgICAgICAgICAgICAgaW4gYW4gYE9rYCwgb3IgZWxzZSB0aGUgb3JpZ2luYWwgYEVycmAgdmFsdWUgd3JhcHBlZCBpbiB0aGUgbmV3XG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtYXA8VCwgVSwgRT4obWFwRm46ICh0OiBUKSA9PiBVLCByZXN1bHQ6IFJlc3VsdDxULCBFPik6IFJlc3VsdDxVLCBFPjtcbmV4cG9ydCBmdW5jdGlvbiBtYXA8VCwgVSwgRT4obWFwRm46ICh0OiBUKSA9PiBVKTogKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBSZXN1bHQ8VSwgRT47XG5leHBvcnQgZnVuY3Rpb24gbWFwPFQsIFUsIEU+KFxuICBtYXBGbjogKHQ6IFQpID0+IFUsXG4gIHJlc3VsdD86IFJlc3VsdDxULCBFPlxuKTogUmVzdWx0PFUsIEU+IHwgKChyZXN1bHQ6IFJlc3VsdDxULCBFPikgPT4gUmVzdWx0PFUsIEU+KSB7XG4gIGNvbnN0IG9wID0gKHI6IFJlc3VsdDxULCBFPikgPT4gKGlzT2socikgPyBvayhtYXBGbihyLnZhbHVlKSkgOiByKSBhcyBSZXN1bHQ8VSwgRT47XG4gIHJldHVybiBjdXJyeTEob3AsIHJlc3VsdCk7XG59XG5cbi8qKlxuICBNYXAgb3ZlciBhIGBSZXN1bHRgIGluc3RhbmNlIGFzIGluIFtgbWFwYF0oI21hcCkgYW5kIGdldCBvdXQgdGhlIHZhbHVlXG4gIGlmIGByZXN1bHRgIGlzIGFuIGBPa2AsIG9yIHJldHVybiBhIGRlZmF1bHQgdmFsdWUgaWYgYHJlc3VsdGAgaXMgYW4gYEVycmAuXG5cbiAgIyMjIyBFeGFtcGxlc1xuXG4gIGBgYHRzXG4gIGltcG9ydCB7IG9rLCBlcnIsIG1hcE9yIH0gZnJvbSAndHJ1ZS1teXRoL3Jlc3VsdCc7XG5cbiAgY29uc3QgbGVuZ3RoID0gKHM6IHN0cmluZykgPT4gcy5sZW5ndGg7XG5cbiAgY29uc3QgYW5Pa1N0cmluZyA9IG9rKCdhIHN0cmluZycpO1xuICBjb25zdCB0aGVTdHJpbmdMZW5ndGggPSBtYXBPcigwLCBhbk9rU3RyaW5nKTtcbiAgY29uc29sZS5sb2codGhlU3RyaW5nTGVuZ3RoKTsgIC8vIDhcblxuICBjb25zdCBhbkVyciA9IGVycigndWggb2gnKTtcbiAgY29uc3QgYW5FcnJNYXBwZWQgPSBtYXBPcigwLCBhbkVycik7XG4gIGNvbnNvbGUubG9nKGFuRXJyTWFwcGVkKTsgIC8vIDBcbiAgYGBgXG5cbiAgQHBhcmFtIG9yVSBUaGUgZGVmYXVsdCB2YWx1ZSB0byB1c2UgaWYgYHJlc3VsdGAgaXMgYW4gYEVycmAuXG4gIEBwYXJhbSBtYXBGbiBUaGUgZnVuY3Rpb24gdG8gYXBwbHkgdGhlIHZhbHVlIHRvIGlmIGByZXN1bHRgIGlzIGFuIGBPa2AuXG4gIEBwYXJhbSByZXN1bHQgVGhlIGBSZXN1bHRgIGluc3RhbmNlIHRvIG1hcCBvdmVyLlxuICovXG5leHBvcnQgZnVuY3Rpb24gbWFwT3I8VCwgVSwgRT4ob3JVOiBVLCBtYXBGbjogKHQ6IFQpID0+IFUsIHJlc3VsdDogUmVzdWx0PFQsIEU+KTogVTtcbmV4cG9ydCBmdW5jdGlvbiBtYXBPcjxULCBVLCBFPihvclU6IFUsIG1hcEZuOiAodDogVCkgPT4gVSk6IChyZXN1bHQ6IFJlc3VsdDxULCBFPikgPT4gVTtcbmV4cG9ydCBmdW5jdGlvbiBtYXBPcjxULCBVLCBFPihvclU6IFUpOiAobWFwRm46ICh0OiBUKSA9PiBVKSA9PiAocmVzdWx0OiBSZXN1bHQ8VCwgRT4pID0+IFU7XG5leHBvcnQgZnVuY3Rpb24gbWFwT3I8VCwgVSwgRT4oXG4gIG9yVTogVSxcbiAgbWFwRm4/OiAodDogVCkgPT4gVSxcbiAgcmVzdWx0PzogUmVzdWx0PFQsIEU+XG4pOiBVIHwgKChyZXN1bHQ6IFJlc3VsdDxULCBFPikgPT4gVSkgfCAoKG1hcEZuOiAodDogVCkgPT4gVSkgPT4gKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBVKSB7XG4gIGZ1bmN0aW9uIGZ1bGxPcChmbjogKHQ6IFQpID0+IFUsIHI6IFJlc3VsdDxULCBFPik6IFUge1xuICAgIHJldHVybiBpc09rKHIpID8gZm4oci52YWx1ZSkgOiBvclU7XG4gIH1cblxuICBmdW5jdGlvbiBwYXJ0aWFsT3AoZm46ICh0OiBUKSA9PiBVKTogKG1heWJlOiBSZXN1bHQ8VCwgRT4pID0+IFU7XG4gIGZ1bmN0aW9uIHBhcnRpYWxPcChmbjogKHQ6IFQpID0+IFUsIGN1cnJpZWRSZXN1bHQ6IFJlc3VsdDxULCBFPik6IFU7XG4gIGZ1bmN0aW9uIHBhcnRpYWxPcChcbiAgICBmbjogKHQ6IFQpID0+IFUsXG4gICAgY3VycmllZFJlc3VsdD86IFJlc3VsdDxULCBFPlxuICApOiBVIHwgKChtYXliZTogUmVzdWx0PFQsIEU+KSA9PiBVKSB7XG4gICAgcmV0dXJuIGN1cnJpZWRSZXN1bHQgIT09IHVuZGVmaW5lZFxuICAgICAgPyBmdWxsT3AoZm4sIGN1cnJpZWRSZXN1bHQpXG4gICAgICA6IChleHRyYUN1cnJpZWRSZXN1bHQ6IFJlc3VsdDxULCBFPikgPT4gZnVsbE9wKGZuLCBleHRyYUN1cnJpZWRSZXN1bHQpO1xuICB9XG5cbiAgcmV0dXJuIG1hcEZuID09PSB1bmRlZmluZWRcbiAgICA/IHBhcnRpYWxPcFxuICAgIDogcmVzdWx0ID09PSB1bmRlZmluZWRcbiAgICAgID8gcGFydGlhbE9wKG1hcEZuKVxuICAgICAgOiBwYXJ0aWFsT3AobWFwRm4sIHJlc3VsdCk7XG59XG5cbi8qKlxuICBNYXAgb3ZlciBhIGBSZXN1bHRgIGluc3RhbmNlIGFzIGluIFtgbWFwYF0oI21hcCkgYW5kIGdldCBvdXQgdGhlIHZhbHVlIGlmXG4gIGByZXN1bHRgIGlzIGBPa2AsIG9yIGFwcGx5IGEgZnVuY3Rpb24gKGBvckVsc2VGbmApIHRvIHRoZSB2YWx1ZSB3cmFwcGVkIGluXG4gIHRoZSBgRXJyYCB0byBnZXQgYSBkZWZhdWx0IHZhbHVlLlxuXG4gIExpa2UgW2BtYXBPcmBdKCNtYXBvcikgYnV0IHVzaW5nIGEgZnVuY3Rpb24gdG8gdHJhbnNmb3JtIHRoZSBlcnJvciBpbnRvIGFcbiAgdXNhYmxlIHZhbHVlIGluc3RlYWQgb2Ygc2ltcGx5IHVzaW5nIGEgZGVmYXVsdCB2YWx1ZS5cblxuICAjIyMjIEV4YW1wbGVzXG5cbiAgYGBgdHNcbiAgaW1wb3J0IHsgb2ssIGVyciwgbWFwT3JFbHNlIH0gZnJvbSAndHJ1ZS1teXRoL3Jlc3VsdCc7XG5cbiAgY29uc3Qgc3VtbWFyaXplID0gKHM6IHN0cmluZykgPT4gYFRoZSByZXNwb25zZSB3YXM6ICcke3N9J2A7XG4gIGNvbnN0IGdldFJlYXNvbiA9IChlcnI6IHsgY29kZTogbnVtYmVyLCByZWFzb246IHN0cmluZyB9KSA9PiBlcnIucmVhc29uO1xuXG4gIGNvbnN0IG9rUmVzcG9uc2UgPSBvayhcIlRoaW5ncyBhcmUgZ3JhbmQgaGVyZS5cIik7XG4gIGNvbnN0IG1hcHBlZE9rQW5kVW53cmFwcGVkID0gbWFwT3JFbHNlKGdldFJlYXNvbiwgc3VtbWFyaXplLCBva1Jlc3BvbnNlKTtcbiAgY29uc29sZS5sb2cobWFwcGVkT2tBbmRVbndyYXBwZWQpOyAgLy8gVGhlIHJlc3BvbnNlIHdhczogJ1RoaW5ncyBhcmUgZ3JhbmQgaGVyZS4nXG5cbiAgY29uc3QgZXJyUmVzcG9uc2UgPSBlcnIoeyBjb2RlOiA1MDAsIHJlYXNvbjogJ05vdGhpbmcgYXQgdGhpcyBlbmRwb2ludCEnIH0pO1xuICBjb25zdCBtYXBwZWRFcnJBbmRVbndyYXBwZWQgPSBtYXBPckVsc2UoZ2V0UmVhc29uLCBzdW1tYXJpemUsIGVyclJlc3BvbnNlKTtcbiAgY29uc29sZS5sb2cobWFwcGVkRXJyQW5kVW53cmFwcGVkKTsgIC8vIE5vdGhpbmcgYXQgdGhpcyBlbmRwb2ludCFcbiAgYGBgXG5cbiAgQHR5cGVwYXJhbSBUICAgIFRoZSB0eXBlIG9mIHRoZSB3cmFwcGVkIGBPa2AgdmFsdWUuXG4gIEB0eXBlcGFyYW0gVSAgICBUaGUgdHlwZSBvZiB0aGUgcmVzdWx0aW5nIHZhbHVlIGZyb20gYXBwbHlpbmcgYG1hcEZuYCB0byB0aGVcbiAgICAgICAgICAgICAgICAgIGBPa2AgdmFsdWUgb3IgYG9yRWxzZUZuYCB0byB0aGUgYEVycmAgdmFsdWUuXG4gIEB0eXBlcGFyYW0gRSAgICBUaGUgdHlwZSBvZiB0aGUgd3JhcHBlZCBgRXJyYCB2YWx1ZS5cbiAgQHBhcmFtIG9yRWxzZUZuIFRoZSBmdW5jdGlvbiB0byBhcHBseSB0byB0aGUgd3JhcHBlZCBgRXJyYCB2YWx1ZSB0byBnZXQgYVxuICAgICAgICAgICAgICAgICAgdXNhYmxlIHZhbHVlIGlmIGByZXN1bHRgIGlzIGFuIGBFcnJgLlxuICBAcGFyYW0gbWFwRm4gICAgVGhlIGZ1bmN0aW9uIHRvIGFwcGx5IHRvIHRoZSB3cmFwcGVkIGBPa2AgdmFsdWUgaWYgYHJlc3VsdGAgaXNcbiAgICAgICAgICAgICAgICAgIGFuIGBPa2AuXG4gIEBwYXJhbSByZXN1bHQgICBUaGUgYFJlc3VsdGAgaW5zdGFuY2UgdG8gbWFwIG92ZXIuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtYXBPckVsc2U8VCwgVSwgRT4oXG4gIG9yRWxzZUZuOiAoZXJyOiBFKSA9PiBVLFxuICBtYXBGbjogKHQ6IFQpID0+IFUsXG4gIHJlc3VsdDogUmVzdWx0PFQsIEU+XG4pOiBVO1xuZXhwb3J0IGZ1bmN0aW9uIG1hcE9yRWxzZTxULCBVLCBFPihcbiAgb3JFbHNlRm46IChlcnI6IEUpID0+IFUsXG4gIG1hcEZuOiAodDogVCkgPT4gVVxuKTogKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBVO1xuZXhwb3J0IGZ1bmN0aW9uIG1hcE9yRWxzZTxULCBVLCBFPihcbiAgb3JFbHNlRm46IChlcnI6IEUpID0+IFVcbik6IChtYXBGbjogKHQ6IFQpID0+IFUpID0+IChyZXN1bHQ6IFJlc3VsdDxULCBFPikgPT4gVTtcbmV4cG9ydCBmdW5jdGlvbiBtYXBPckVsc2U8VCwgVSwgRT4oXG4gIG9yRWxzZUZuOiAoZXJyOiBFKSA9PiBVLFxuICBtYXBGbj86ICh0OiBUKSA9PiBVLFxuICByZXN1bHQ/OiBSZXN1bHQ8VCwgRT5cbik6IFUgfCAoKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBVKSB8ICgobWFwRm46ICh0OiBUKSA9PiBVKSA9PiAocmVzdWx0OiBSZXN1bHQ8VCwgRT4pID0+IFUpIHtcbiAgZnVuY3Rpb24gZnVsbE9wKGZuOiAodDogVCkgPT4gVSwgcjogUmVzdWx0PFQsIEU+KSB7XG4gICAgcmV0dXJuIGlzT2socikgPyBmbihyLnZhbHVlKSA6IG9yRWxzZUZuKHIuZXJyb3IpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGFydGlhbE9wKGZuOiAodDogVCkgPT4gVSk6IChtYXliZTogUmVzdWx0PFQsIEU+KSA9PiBVO1xuICBmdW5jdGlvbiBwYXJ0aWFsT3AoZm46ICh0OiBUKSA9PiBVLCBjdXJyaWVkUmVzdWx0OiBSZXN1bHQ8VCwgRT4pOiBVO1xuICBmdW5jdGlvbiBwYXJ0aWFsT3AoXG4gICAgZm46ICh0OiBUKSA9PiBVLFxuICAgIGN1cnJpZWRSZXN1bHQ/OiBSZXN1bHQ8VCwgRT5cbiAgKTogVSB8ICgobWF5YmU6IFJlc3VsdDxULCBFPikgPT4gVSkge1xuICAgIHJldHVybiBjdXJyaWVkUmVzdWx0ICE9PSB1bmRlZmluZWRcbiAgICAgID8gZnVsbE9wKGZuLCBjdXJyaWVkUmVzdWx0KVxuICAgICAgOiAoZXh0cmFDdXJyaWVkUmVzdWx0OiBSZXN1bHQ8VCwgRT4pID0+IGZ1bGxPcChmbiwgZXh0cmFDdXJyaWVkUmVzdWx0KTtcbiAgfVxuXG4gIHJldHVybiBtYXBGbiA9PT0gdW5kZWZpbmVkXG4gICAgPyBwYXJ0aWFsT3BcbiAgICA6IHJlc3VsdCA9PT0gdW5kZWZpbmVkXG4gICAgICA/IHBhcnRpYWxPcChtYXBGbilcbiAgICAgIDogcGFydGlhbE9wKG1hcEZuLCByZXN1bHQpO1xufVxuXG4vKipcbiAgTWFwIG92ZXIgYSBgUmVzdWx0YCwgZXhhY3RseSBhcyBpbiBbYG1hcGBdKCNtYXApLCBidXQgb3BlcmF0aW5nIG9uIHRoZSB2YWx1ZVxuICB3cmFwcGVkIGluIGFuIGBFcnJgIGluc3RlYWQgb2YgdGhlIHZhbHVlIHdyYXBwZWQgaW4gdGhlIGBPa2AuIFRoaXMgaXMgaGFuZHlcbiAgZm9yIHdoZW4geW91IG5lZWQgdG8gbGluZSB1cCBhIGJ1bmNoIG9mIGRpZmZlcmVudCB0eXBlcyBvZiBlcnJvcnMsIG9yIGlmIHlvdVxuICBuZWVkIGFuIGVycm9yIG9mIG9uZSBzaGFwZSB0byBiZSBpbiBhIGRpZmZlcmVudCBzaGFwZSB0byB1c2Ugc29tZXdoZXJlIGVsc2UgaW5cbiAgeW91ciBjb2RlYmFzZS5cblxuICAjIyMjIEV4YW1wbGVzXG5cbiAgYGBgdHNcbiAgaW1wb3J0IHsgb2ssIGVyciwgbWFwRXJyLCB0b1N0cmluZyB9IGZyb20gJ3RydWUtbXl0aC9yZXN1bHQnO1xuXG4gIGNvbnN0IHJlYXNvbiA9IChlcnI6IHsgY29kZTogbnVtYmVyLCByZWFzb246IHN0cmluZyB9KSA9PiBlcnIucmVhc29uO1xuXG4gIGNvbnN0IGFuT2sgPSBvaygxMik7XG4gIGNvbnN0IG1hcHBlZE9rID0gbWFwRXJyKHJlYXNvbiwgYW5Payk7XG4gIGNvbnNvbGUubG9nKHRvU3RyaW5nKG1hcHBlZE9rKSk7ICAvLyBPaygxMilcblxuICBjb25zdCBhbkVyciA9IGVycih7IGNvZGU6IDEwMSwgcmVhc29uOiAnYmFkIGZpbGUnIH0pO1xuICBjb25zdCBtYXBwZWRFcnIgPSBtYXBFcnIocmVhc29uLCBhbkVycik7XG4gIGNvbnNvbGUubG9nKHRvU3RyaW5nKG1hcHBlZEVycikpOyAgLy8gRXJyKGJhZCBmaWxlKVxuICBgYGBcblxuICBAdHlwZXBhcmFtIFQgICAgVGhlIHR5cGUgb2YgdGhlIHZhbHVlIHdyYXBwZWQgaW4gdGhlIGBPa2Agb2YgdGhlIGBSZXN1bHRgLlxuICBAdHlwZXBhcmFtIEUgICAgVGhlIHR5cGUgb2YgdGhlIHZhbHVlIHdyYXBwZWQgaW4gdGhlIGBFcnJgIG9mIHRoZSBgUmVzdWx0YC5cbiAgQHR5cGVwYXJhbSBGICAgIFRoZSB0eXBlIG9mIHRoZSB2YWx1ZSB3cmFwcGVkIGluIHRoZSBgRXJyYCBvZiBhIG5ldyBgUmVzdWx0YCxcbiAgICAgICAgICAgICAgICAgIHJldHVybmVkIGJ5IHRoZSBgbWFwRXJyRm5gLlxuICBAcGFyYW0gbWFwRXJyRm4gVGhlIGZ1bmN0aW9uIHRvIGFwcGx5IHRvIHRoZSB2YWx1ZSB3cmFwcGVkIGluIGBFcnJgIGlmIGByZXN1bHRgIGlzIGFuIGBFcnJgLlxuICBAcGFyYW0gcmVzdWx0ICAgVGhlIGBSZXN1bHRgIGluc3RhbmNlIHRvIG1hcCBvdmVyIGFuIGVycm9yIGNhc2UgZm9yLlxuICovXG5leHBvcnQgZnVuY3Rpb24gbWFwRXJyPFQsIEUsIEY+KG1hcEVyckZuOiAoZTogRSkgPT4gRiwgcmVzdWx0OiBSZXN1bHQ8VCwgRT4pOiBSZXN1bHQ8VCwgRj47XG5leHBvcnQgZnVuY3Rpb24gbWFwRXJyPFQsIEUsIEY+KG1hcEVyckZuOiAoZTogRSkgPT4gRik6IChyZXN1bHQ6IFJlc3VsdDxULCBFPikgPT4gUmVzdWx0PFQsIEY+O1xuZXhwb3J0IGZ1bmN0aW9uIG1hcEVycjxULCBFLCBGPihcbiAgbWFwRXJyRm46IChlOiBFKSA9PiBGLFxuICByZXN1bHQ/OiBSZXN1bHQ8VCwgRT5cbik6IFJlc3VsdDxULCBGPiB8ICgocmVzdWx0OiBSZXN1bHQ8VCwgRT4pID0+IFJlc3VsdDxULCBGPikge1xuICBjb25zdCBvcCA9IChyOiBSZXN1bHQ8VCwgRT4pID0+IChpc09rKHIpID8gciA6IGVycihtYXBFcnJGbihyLmVycm9yKSkpIGFzIFJlc3VsdDxULCBGPjtcbiAgcmV0dXJuIGN1cnJ5MShvcCwgcmVzdWx0KTtcbn1cblxuLyoqXG4gIFlvdSBjYW4gdGhpbmsgb2YgdGhpcyBsaWtlIGEgc2hvcnQtY2lyY3VpdGluZyBsb2dpY2FsIFwiYW5kXCIgb3BlcmF0aW9uIG9uIGFcbiAgYFJlc3VsdGAgdHlwZS4gSWYgYHJlc3VsdGAgaXMgYE9rYCwgdGhlbiB0aGUgcmVzdWx0IGlzIHRoZSBgYW5kUmVzdWx0YC4gSWZcbiAgYHJlc3VsdGAgaXMgYEVycmAsIHRoZSByZXN1bHQgaXMgdGhlIGBFcnJgLlxuXG4gIFRoaXMgaXMgdXNlZnVsIHdoZW4geW91IGhhdmUgYW5vdGhlciBgUmVzdWx0YCB2YWx1ZSB5b3Ugd2FudCB0byBwcm92aWRlIGlmXG4gIGFuZCAqb25seSBpZiogeW91IGhhdmUgYW4gYE9rYCDigJMgdGhhdCBpcywgd2hlbiB5b3UgbmVlZCB0byBtYWtlIHN1cmUgdGhhdCBpZiB5b3VcbiAgYEVycmAsIHdoYXRldmVyIGVsc2UgeW91J3JlIGhhbmRpbmcgYSBgUmVzdWx0YCB0byAqYWxzbyogZ2V0cyB0aGF0IGBFcnJgLlxuXG4gIE5vdGljZSB0aGF0LCB1bmxpa2UgaW4gW2BtYXBgXSgjbWFwKSBvciBpdHMgdmFyaWFudHMsIHRoZSBvcmlnaW5hbCBgcmVzdWx0YCBpc1xuICBub3QgaW52b2x2ZWQgaW4gY29uc3RydWN0aW5nIHRoZSBuZXcgYFJlc3VsdGAuXG5cbiAgIyMjIyBFeGFtcGxlc1xuXG4gIGBgYHRzXG4gIGltcG9ydCB7IGFuZCwgb2ssIGVyciwgdG9TdHJpbmcgfSBmcm9tICd0cnVlLW15dGgvcmVzdWx0JztcblxuICBjb25zdCBva0EgPSBvaygnQScpO1xuICBjb25zdCBva0IgPSBvaygnQicpO1xuICBjb25zdCBhbkVyciA9IGVycih7IHNvOiAnYmFkJyB9KTtcblxuICBjb25zb2xlLmxvZyh0b1N0cmluZyhhbmQob2tCLCBva0EpKSk7ICAvLyBPayhCKVxuICBjb25zb2xlLmxvZyh0b1N0cmluZyhhbmQob2tCLCBhbkVycikpKTsgIC8vIEVycihbb2JqZWN0IE9iamVjdF0pXG4gIGNvbnNvbGUubG9nKHRvU3RyaW5nKGFuZChhbkVyciwgb2tBKSkpOyAgLy8gRXJyKFtvYmplY3QgT2JqZWN0XSlcbiAgY29uc29sZS5sb2codG9TdHJpbmcoYW5kKGFuRXJyLCBhbkVycikpKTsgIC8vIEVycihbb2JqZWN0IE9iamVjdF0pXG4gIGBgYFxuXG4gIEB0eXBlcGFyYW0gVCAgICAgVGhlIHR5cGUgb2YgdGhlIHZhbHVlIHdyYXBwZWQgaW4gdGhlIGBPa2Agb2YgdGhlIGBSZXN1bHRgLlxuICBAdHlwZXBhcmFtIFUgICAgIFRoZSB0eXBlIG9mIHRoZSB2YWx1ZSB3cmFwcGVkIGluIHRoZSBgT2tgIG9mIHRoZSBgYW5kUmVzdWx0YCxcbiAgICAgICAgICAgICAgICAgICBpLmUuIHRoZSBzdWNjZXNzIHR5cGUgb2YgdGhlIGBSZXN1bHRgIHByZXNlbnQgaWYgdGhlIGNoZWNrZWRcbiAgICAgICAgICAgICAgICAgICBgUmVzdWx0YCBpcyBgT2tgLlxuICBAdHlwZXBhcmFtIEUgICAgIFRoZSB0eXBlIG9mIHRoZSB2YWx1ZSB3cmFwcGVkIGluIHRoZSBgRXJyYCBvZiB0aGUgYFJlc3VsdGAuXG4gIEBwYXJhbSBhbmRSZXN1bHQgVGhlIGBSZXN1bHRgIGluc3RhbmNlIHRvIHJldHVybiBpZiBgcmVzdWx0YCBpcyBgRXJyYC5cbiAgQHBhcmFtIHJlc3VsdCAgICBUaGUgYFJlc3VsdGAgaW5zdGFuY2UgdG8gY2hlY2suXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhbmQ8VCwgVSwgRT4oYW5kUmVzdWx0OiBSZXN1bHQ8VSwgRT4sIHJlc3VsdDogUmVzdWx0PFQsIEU+KTogUmVzdWx0PFUsIEU+O1xuZXhwb3J0IGZ1bmN0aW9uIGFuZDxULCBVLCBFPihhbmRSZXN1bHQ6IFJlc3VsdDxVLCBFPik6IChyZXN1bHQ6IFJlc3VsdDxULCBFPikgPT4gUmVzdWx0PFUsIEU+O1xuZXhwb3J0IGZ1bmN0aW9uIGFuZDxULCBVLCBFPihcbiAgYW5kUmVzdWx0OiBSZXN1bHQ8VSwgRT4sXG4gIHJlc3VsdD86IFJlc3VsdDxULCBFPlxuKTogUmVzdWx0PFUsIEU+IHwgKChyZXN1bHQ6IFJlc3VsdDxULCBFPikgPT4gUmVzdWx0PFUsIEU+KSB7XG4gIGNvbnN0IG9wID0gKHI6IFJlc3VsdDxULCBFPikgPT4gKGlzT2socikgPyBhbmRSZXN1bHQgOiAociBhcyBFcnI8YW55LCBFPikpO1xuICByZXR1cm4gY3VycnkxKG9wLCByZXN1bHQpO1xufVxuXG4vKipcbiAgQXBwbHkgYSBmdW5jdGlvbiB0byB0aGUgd3JhcHBlZCB2YWx1ZSBpZiBgT2tgIGFuZCByZXR1cm4gYSBuZXcgYE9rYFxuICBjb250YWluaW5nIHRoZSByZXN1bHRpbmcgdmFsdWU7IG9yIGlmIGl0IGlzIGBFcnJgIHJldHVybiBpdCB1bm1vZGlmaWVkLlxuXG4gIFRoaXMgZGlmZmVycyBmcm9tIGBtYXBgIGluIHRoYXQgYHRoZW5GbmAgcmV0dXJucyBhbm90aGVyIGBSZXN1bHRgLiBZb3UgY2FuIHVzZVxuICBgYW5kVGhlbmAgdG8gY29tYmluZSB0d28gZnVuY3Rpb25zIHdoaWNoICpib3RoKiBjcmVhdGUgYSBgUmVzdWx0YCBmcm9tIGFuXG4gIHVud3JhcHBlZCB0eXBlLlxuXG4gIFlvdSBtYXkgZmluZCB0aGUgYC50aGVuYCBtZXRob2Qgb24gYW4gRVM2IGBQcm9taXNlYCBoZWxwZnVsIGZvciBjb21wYXJpc29uOiBpZlxuICB5b3UgaGF2ZSBhIGBQcm9taXNlYCwgeW91IGNhbiBwYXNzIGl0cyBgdGhlbmAgbWV0aG9kIGEgY2FsbGJhY2sgd2hpY2hcbiAgcmV0dXJucyBhbm90aGVyIGBQcm9taXNlYCwgYW5kIHRoZSByZXN1bHQgd2lsbCBub3QgYmUgYSAqbmVzdGVkKiBwcm9taXNlLCBidXRcbiAgYSBzaW5nbGUgYFByb21pc2VgLiBUaGUgZGlmZmVyZW5jZSBpcyB0aGF0IGBQcm9taXNlI3RoZW5gIHVud3JhcHMgKmFsbCpcbiAgbGF5ZXJzIHRvIG9ubHkgZXZlciByZXR1cm4gYSBzaW5nbGUgYFByb21pc2VgIHZhbHVlLCB3aGVyZWFzIGBSZXN1bHQuYW5kVGhlbmBcbiAgd2lsbCBub3QgdW53cmFwIG5lc3RlZCBgUmVzdWx0YHMuXG5cbiAgVGhpcyBpcyBhbHNvIGNvbW1vbmx5IGtub3duIGFzIChhbmQgdGhlcmVmb3JlIGFsaWFzZWQgYXMpIFtgZmxhdE1hcGBdIG9yXG4gIFtgY2hhaW5gXS4gSXQgaXMgc29tZXRpbWVzIGFsc28ga25vd24gYXMgYGJpbmRgLCBidXQgKm5vdCogYWxpYXNlZCBhcyBzdWNoXG4gIGJlY2F1c2UgW2BiaW5kYCBhbHJlYWR5IG1lYW5zIHNvbWV0aGluZyBpbiBKYXZhU2NyaXB0XVtiaW5kXS5cblxuICBbYGZsYXRNYXBgXTogI2ZsYXRtYXBcbiAgW2BjaGFpbmBdOiAjY2hhaW5cbiAgW2JpbmRdOiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9GdW5jdGlvbi9iaW5kXG5cbiAgIyMjIyBFeGFtcGxlc1xuXG4gIGBgYHRzXG4gIGltcG9ydCB7IG9rLCBlcnIsIGFuZFRoZW4sIHRvU3RyaW5nIH0gZnJvbSAndHJ1ZS1teXRoL3Jlc3VsdCc7XG5cbiAgY29uc3QgdG9MZW5ndGhBc1Jlc3VsdCA9IChzOiBzdHJpbmcpID0+IG9rKHMubGVuZ3RoKTtcblxuICBjb25zdCBhbk9rID0gb2soJ2p1c3QgYSBzdHJpbmcnKTtcbiAgY29uc3QgbGVuZ3RoQXNSZXN1bHQgPSBhbmRUaGVuKHRvTGVuZ3RoQXNSZXN1bHQsIGFuT2spO1xuICBjb25zb2xlLmxvZyh0b1N0cmluZyhsZW5ndGhBc1Jlc3VsdCkpOyAgLy8gT2soMTMpXG5cbiAgY29uc3QgYW5FcnIgPSBlcnIoWydzcnNseScsICd3aGF0ZXZlciddKTtcbiAgY29uc3Qgbm90TGVuZ3RoQXNSZXN1bHQgPSBhbmRUaGVuKHRvTGVuZ3RoQXNSZXN1bHQsIGFuRXJyKTtcbiAgY29uc29sZS5sb2codG9TdHJpbmcobm90TGVuZ3RoQXNSZXN1bHQpKTsgIC8vIEVycihzcnNseSx3aGF0ZXZlcilcbiAgYGBgXG5cbiAgQHR5cGVwYXJhbSBUICAgVGhlIHR5cGUgb2YgdGhlIHZhbHVlIHdyYXBwZWQgaW4gdGhlIGBPa2Agb2YgdGhlIGBSZXN1bHRgLlxuICBAdHlwZXBhcmFtIFUgICBUaGUgdHlwZSBvZiB0aGUgdmFsdWUgd3JhcHBlZCBpbiB0aGUgYE9rYCBvZiB0aGUgYFJlc3VsdGBcbiAgICAgICAgICAgICAgICAgcmV0dXJuZWQgYnkgdGhlIGB0aGVuRm5gLlxuICBAdHlwZXBhcmFtIEUgICBUaGUgdHlwZSBvZiB0aGUgdmFsdWUgd3JhcHBlZCBpbiB0aGUgYEVycmAgb2YgdGhlIGBSZXN1bHRgLlxuICBAcGFyYW0gdGhlbkZuICBUaGUgZnVuY3Rpb24gdG8gYXBwbHkgdG8gdGhlIHdyYXBwZWQgYFRgIGlmIGBtYXliZWAgaXMgYEp1c3RgLlxuICBAcGFyYW0gcmVzdWx0ICBUaGUgYE1heWJlYCB0byBldmFsdWF0ZSBhbmQgcG9zc2libHkgYXBwbHkgYSBmdW5jdGlvbiB0by5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFuZFRoZW48VCwgVSwgRT4oXG4gIHRoZW5GbjogKHQ6IFQpID0+IFJlc3VsdDxVLCBFPixcbiAgcmVzdWx0OiBSZXN1bHQ8VCwgRT5cbik6IFJlc3VsdDxVLCBFPjtcbmV4cG9ydCBmdW5jdGlvbiBhbmRUaGVuPFQsIFUsIEU+KFxuICB0aGVuRm46ICh0OiBUKSA9PiBSZXN1bHQ8VSwgRT5cbik6IChyZXN1bHQ6IFJlc3VsdDxULCBFPikgPT4gUmVzdWx0PFUsIEU+O1xuZXhwb3J0IGZ1bmN0aW9uIGFuZFRoZW48VCwgVSwgRT4oXG4gIHRoZW5GbjogKHQ6IFQpID0+IFJlc3VsdDxVLCBFPixcbiAgcmVzdWx0PzogUmVzdWx0PFQsIEU+XG4pOiBSZXN1bHQ8VSwgRT4gfCAoKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBSZXN1bHQ8VSwgRT4pIHtcbiAgY29uc3Qgb3AgPSAocjogUmVzdWx0PFQsIEU+KSA9PiAoaXNPayhyKSA/IHRoZW5GbihyLnZhbHVlKSA6IChyIGFzIEVycjxhbnksIEU+KSk7XG4gIHJldHVybiBjdXJyeTEob3AsIHJlc3VsdCk7XG59XG5cbi8qKiBBbGlhcyBmb3IgW2BhbmRUaGVuYF0oI2FuZHRoZW4pLiAqL1xuZXhwb3J0IGNvbnN0IGNoYWluID0gYW5kVGhlbjtcblxuLyoqIEFsaWFzIGZvciBbYGFuZFRoZW5gXSgjYW5kdGhlbikuICovXG5leHBvcnQgY29uc3QgZmxhdE1hcCA9IGFuZFRoZW47XG5cbi8qKlxuICBQcm92aWRlIGEgZmFsbGJhY2sgZm9yIGEgZ2l2ZW4gYFJlc3VsdGAuIEJlaGF2ZXMgbGlrZSBhIGxvZ2ljYWwgYG9yYDogaWYgdGhlXG4gIGByZXN1bHRgIHZhbHVlIGlzIGFuIGBPa2AsIHJldHVybnMgdGhhdCBgcmVzdWx0YDsgb3RoZXJ3aXNlLCByZXR1cm5zIHRoZVxuICBgZGVmYXVsdFJlc3VsdGAgdmFsdWUuXG5cbiAgVGhpcyBpcyB1c2VmdWwgd2hlbiB5b3Ugd2FudCB0byBtYWtlIHN1cmUgdGhhdCBzb21ldGhpbmcgd2hpY2ggdGFrZXMgYVxuICBgUmVzdWx0YCBhbHdheXMgZW5kcyB1cCBnZXR0aW5nIGFuIGBPa2AgdmFyaWFudCwgYnkgc3VwcGx5aW5nIGEgZGVmYXVsdCB2YWx1ZVxuICBmb3IgdGhlIGNhc2UgdGhhdCB5b3UgY3VycmVudGx5IGhhdmUgYW4gYEVycmAuXG5cbiAgYGBgdHNcbiAgaW1wb3J0IHsgb2ssIGVyciwgUmVzdWx0LCBvciB9IGZyb20gJ3RydWUtdXRpbHMvcmVzdWx0JztcblxuICBjb25zdCBva0EgPSBvazxzdHJpbmcsIHN0cmluZz4oJ2EnKTtcbiAgY29uc3Qgb2tCID0gb2s8c3RyaW5nLCBzdHJpbmc+KCdiJyk7XG4gIGNvbnN0IGFuRXJyID0gZXJyPHN0cmluZywgc3RyaW5nPignOndhdDonKTtcbiAgY29uc3QgYW5vdGhlckVyciA9IGVycjxzdHJpbmcsIHN0cmluZz4oJzpoZWFkZGVzazonKTtcblxuICBjb25zb2xlLmxvZyhvcihva0IsIG9rQSkudG9TdHJpbmcoKSk7ICAvLyBPayhBKVxuICBjb25zb2xlLmxvZyhvcihhbkVyciwgb2tBKS50b1N0cmluZygpKTsgIC8vIE9rKEEpXG4gIGNvbnNvbGUubG9nKG9yKG9rQiwgYW5FcnIpLnRvU3RyaW5nKCkpOyAgLy8gT2soQilcbiAgY29uc29sZS5sb2cob3IoYW5vdGhlckVyciwgYW5FcnIpLnRvU3RyaW5nKCkpOyAgLy8gRXJyKDpoZWFkZGVzazopXG4gIGBgYFxuXG4gIEB0eXBlcGFyYW0gVCAgICAgICAgICBUaGUgdHlwZSB3cmFwcGVkIGluIHRoZSBgT2tgIGNhc2Ugb2YgYHJlc3VsdGAuXG4gIEB0eXBlcGFyYW0gRSAgICAgICAgICBUaGUgdHlwZSB3cmFwcGVkIGluIHRoZSBgRXJyYCBjYXNlIG9mIGByZXN1bHRgLlxuICBAdHlwZXBhcmFtIEYgICAgICAgICAgVGhlIHR5cGUgd3JhcHBlZCBpbiB0aGUgYEVycmAgY2FzZSBvZiBgZGVmYXVsdFJlc3VsdGAuXG4gIEBwYXJhbSBkZWZhdWx0UmVzdWx0ICBUaGUgYFJlc3VsdGAgdG8gdXNlIGlmIGByZXN1bHRgIGlzIGFuIGBFcnJgLlxuICBAcGFyYW0gcmVzdWx0ICAgICAgICAgVGhlIGBSZXN1bHRgIGluc3RhbmNlIHRvIGNoZWNrLlxuICBAcmV0dXJucyAgICAgICAgICAgICAgYHJlc3VsdGAgaWYgaXQgaXMgYW4gYE9rYCwgb3RoZXJ3aXNlIGBkZWZhdWx0UmVzdWx0YC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG9yPFQsIEUsIEY+KGRlZmF1bHRSZXN1bHQ6IFJlc3VsdDxULCBGPiwgcmVzdWx0OiBSZXN1bHQ8VCwgRT4pOiBSZXN1bHQ8VCwgRj47XG5leHBvcnQgZnVuY3Rpb24gb3I8VCwgRSwgRj4oZGVmYXVsdFJlc3VsdDogUmVzdWx0PFQsIEY+KTogKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBSZXN1bHQ8VCwgRj47XG5leHBvcnQgZnVuY3Rpb24gb3I8VCwgRSwgRj4oXG4gIGRlZmF1bHRSZXN1bHQ6IFJlc3VsdDxULCBGPixcbiAgcmVzdWx0PzogUmVzdWx0PFQsIEU+XG4pOiBSZXN1bHQ8VCwgRj4gfCAoKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBSZXN1bHQ8VCwgRj4pIHtcbiAgY29uc3Qgb3AgPSAocjogUmVzdWx0PFQsIEU+KSA9PiAoaXNPayhyKSA/IChyIGFzIE9rPFQsIGFueT4pIDogZGVmYXVsdFJlc3VsdCk7XG4gIHJldHVybiBjdXJyeTEob3AsIHJlc3VsdCk7XG59XG5cbi8qKlxuICBMaWtlIGBvcmAsIGJ1dCB1c2luZyBhIGZ1bmN0aW9uIHRvIGNvbnN0cnVjdCB0aGUgYWx0ZXJuYXRpdmUgYFJlc3VsdGAuXG5cbiAgU29tZXRpbWVzIHlvdSBuZWVkIHRvIHBlcmZvcm0gYW4gb3BlcmF0aW9uIHVzaW5nIG90aGVyIGRhdGEgaW4gdGhlIGVudmlyb25tZW50XG4gIHRvIGNvbnN0cnVjdCB0aGUgZmFsbGJhY2sgdmFsdWUuIEluIHRoZXNlIHNpdHVhdGlvbnMsIHlvdSBjYW4gcGFzcyBhIGZ1bmN0aW9uXG4gICh3aGljaCBtYXkgYmUgYSBjbG9zdXJlKSBhcyB0aGUgYGVsc2VGbmAgdG8gZ2VuZXJhdGUgdGhlIGZhbGxiYWNrIGBSZXN1bHQ8VD5gLlxuICBJdCBjYW4gdGhlbiB0cmFuc2Zvcm0gdGhlIGRhdGEgaW4gdGhlIGBFcnJgIHRvIHNvbWV0aGluZyB1c2FibGUgYXMgYW4gYE9rYCwgb3JcbiAgZ2VuZXJhdGUgYSBuZXcgYEVycmAgaW5zdGFuY2UgYXMgYXBwcm9wcmlhdGUuXG5cbiAgVXNlZnVsIGZvciB0cmFuc2Zvcm1pbmcgZmFpbHVyZXMgdG8gdXNhYmxlIGRhdGEuXG5cbiAgQHBhcmFtIGVsc2VGbiBUaGUgZnVuY3Rpb24gdG8gYXBwbHkgdG8gdGhlIGNvbnRlbnRzIG9mIHRoZSBgRXJyYCBpZiBgcmVzdWx0YFxuICAgICAgICAgICAgICAgIGlzIGFuIGBFcnJgLCB0byBjcmVhdGUgYSBuZXcgYFJlc3VsdGAuXG4gIEBwYXJhbSByZXN1bHQgVGhlIGBSZXN1bHRgIHRvIHVzZSBpZiBpdCBpcyBhbiBgT2tgLlxuICBAcmV0dXJucyAgICAgIFRoZSBgcmVzdWx0YCBpZiBpdCBpcyBgT2tgLCBvciB0aGUgYFJlc3VsdGAgcmV0dXJuZWQgYnkgYGVsc2VGbmBcbiAgICAgICAgICAgICAgICBpZiBgcmVzdWx0YCBpcyBhbiBgRXJyLlxuICovXG5leHBvcnQgZnVuY3Rpb24gb3JFbHNlPFQsIEUsIEY+KFxuICBlbHNlRm46IChlcnI6IEUpID0+IFJlc3VsdDxULCBGPixcbiAgcmVzdWx0OiBSZXN1bHQ8VCwgRT5cbik6IFJlc3VsdDxULCBGPjtcbmV4cG9ydCBmdW5jdGlvbiBvckVsc2U8VCwgRSwgRj4oXG4gIGVsc2VGbjogKGVycjogRSkgPT4gUmVzdWx0PFQsIEY+XG4pOiAocmVzdWx0OiBSZXN1bHQ8VCwgRT4pID0+IFJlc3VsdDxULCBGPjtcbmV4cG9ydCBmdW5jdGlvbiBvckVsc2U8VCwgRSwgRj4oXG4gIGVsc2VGbjogKGVycjogRSkgPT4gUmVzdWx0PFQsIEY+LFxuICByZXN1bHQ/OiBSZXN1bHQ8VCwgRT5cbik6IFJlc3VsdDxULCBGPiB8ICgocmVzdWx0OiBSZXN1bHQ8VCwgRT4pID0+IFJlc3VsdDxULCBGPikge1xuICBjb25zdCBvcCA9IChyOiBSZXN1bHQ8VCwgRT4pID0+IChpc09rKHIpID8gKHIgYXMgT2s8VCwgYW55PikgOiBlbHNlRm4oci51bnNhZmVseVVud3JhcEVycigpKSk7XG4gIHJldHVybiBjdXJyeTEob3AsIHJlc3VsdCk7XG59XG5cbi8qKlxuICBHZXQgdGhlIHZhbHVlIG91dCBvZiB0aGUgYFJlc3VsdGAuXG5cbiAgUmV0dXJucyB0aGUgY29udGVudCBvZiBhbiBgT2tgLCBidXQgKip0aHJvd3MgaWYgdGhlIGBSZXN1bHRgIGlzIGBFcnJgLioqXG4gIFByZWZlciB0byB1c2UgW2B1bndyYXBPcmBdKCN1bndyYXBvcikgb3IgW2B1bndyYXBPckVsc2VgXSgjdW53cmFwb3JlbHNlKS5cblxuICBAdGhyb3dzIElmIHRoZSBgUmVzdWx0YCBpbnN0YW5jZSBpcyBgTm90aGluZ2AuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1bnNhZmVseVVud3JhcDxULCBFPihyZXN1bHQ6IFJlc3VsdDxULCBFPik6IFQge1xuICByZXR1cm4gcmVzdWx0LnVuc2FmZWx5VW53cmFwKCk7XG59XG5cbi8qKiBBbGlhcyBmb3IgW2B1bnNhZmVseVVud3JhcGBdKCN1bnNhZmVseXVud3JhcCkgKi9cbmV4cG9ydCBjb25zdCB1bnNhZmVseUdldCA9IHVuc2FmZWx5VW53cmFwO1xuXG4vKiogQWxpYXMgZm9yIFtgdW5zYWZlbHlVbndyYXBgXSgjdW5zYWZlbHl1bndyYXApICovXG5leHBvcnQgY29uc3QgdW5zYWZlR2V0ID0gdW5zYWZlbHlVbndyYXA7XG5cbi8qKlxuICBHZXQgdGhlIGVycm9yIHZhbHVlIG91dCBvZiB0aGUgW2BSZXN1bHRgXSgjcmVzdWx0KS5cblxuICBSZXR1cm5zIHRoZSBjb250ZW50IG9mIGFuIGBFcnJgLCBidXQgKip0aHJvd3MgaWYgdGhlIGBSZXN1bHRgIGlzIGBPa2AqKi5cbiAgUHJlZmVyIHRvIHVzZSBbYHVud3JhcE9yRWxzZWBdKCN1bndyYXBvcmVsc2UpLlxuXG4gIEBwYXJhbSByZXN1bHRcbiAgQHRocm93cyBFcnJvciBJZiB0aGUgYFJlc3VsdGAgaW5zdGFuY2UgaXMgYE5vdGhpbmdgLlxuICovXG5leHBvcnQgZnVuY3Rpb24gdW5zYWZlbHlVbndyYXBFcnI8VCwgRT4ocmVzdWx0OiBSZXN1bHQ8VCwgRT4pOiBFIHtcbiAgcmV0dXJuIHJlc3VsdC51bnNhZmVseVVud3JhcEVycigpO1xufVxuXG4vKiogQWxpYXMgZm9yIFtgdW5zYWZlbHlVbndyYXBFcnJgXSgjdW5zYWZlbHl1bndyYXBlcnIpICovXG5leHBvcnQgY29uc3QgdW5zYWZlbHlHZXRFcnIgPSB1bnNhZmVseVVud3JhcEVycjtcblxuLyoqXG4gIFNhZmVseSBnZXQgdGhlIHZhbHVlIG91dCBvZiB0aGUgYE9rYCB2YXJpYW50IG9mIGEgW2BSZXN1bHRgXSgjcmVzdWx0KS5cblxuICBUaGlzIGlzIHRoZSByZWNvbW1lbmRlZCB3YXkgdG8gZ2V0IGEgdmFsdWUgb3V0IG9mIGEgYFJlc3VsdGAgbW9zdCBvZiB0aGUgdGltZS5cblxuICBgYGB0c1xuICBpbXBvcnQgeyBvaywgZXJyLCB1bndyYXBPciB9IGZyb20gJ3RydWUtbXl0aC9yZXN1bHQnO1xuXG4gIGNvbnN0IGFuT2sgPSBvazxudW1iZXIsIHN0cmluZz4oMTIpO1xuICBjb25zb2xlLmxvZyh1bndyYXBPcigwLCBhbk9rKSk7ICAvLyAxMlxuXG4gIGNvbnN0IGFuRXJyID0gZXJyPG51bWJlciwgc3RyaW5nPignbm9vb29vJyk7XG4gIGNvbnNvbGUubG9nKHVud3JhcE9yKDAsIGFuRXJyKSk7ICAvLyAwXG4gIGBgYFxuXG4gIEB0eXBlcGFyYW0gVCAgICAgICAgVGhlIHZhbHVlIHdyYXBwZWQgaW4gdGhlIGBPa2AuXG4gIEB0eXBlcGFyYW0gRSAgICAgICAgVGhlIHZhbHVlIHdyYXBwZWQgaW4gdGhlIGBFcnJgLlxuICBAcGFyYW0gZGVmYXVsdFZhbHVlIFRoZSB2YWx1ZSB0byB1c2UgaWYgYHJlc3VsdGAgaXMgYW4gYEVycmAuXG4gIEBwYXJhbSByZXN1bHQgICAgICAgVGhlIGBSZXN1bHRgIGluc3RhbmNlIHRvIHVud3JhcCBpZiBpdCBpcyBhbiBgT2tgLlxuICBAcmV0dXJucyAgICAgICAgICAgIFRoZSBjb250ZW50IG9mIGByZXN1bHRgIGlmIGl0IGlzIGFuIGBPa2AsIG90aGVyd2lzZVxuICAgICAgICAgICAgICAgICAgICAgIGBkZWZhdWx0VmFsdWVgLlxuICovXG5leHBvcnQgZnVuY3Rpb24gdW53cmFwT3I8VCwgRT4oZGVmYXVsdFZhbHVlOiBULCByZXN1bHQ6IFJlc3VsdDxULCBFPik6IFQ7XG5leHBvcnQgZnVuY3Rpb24gdW53cmFwT3I8VCwgRT4oZGVmYXVsdFZhbHVlOiBUKTogKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBUO1xuZXhwb3J0IGZ1bmN0aW9uIHVud3JhcE9yPFQsIEU+KFxuICBkZWZhdWx0VmFsdWU6IFQsXG4gIHJlc3VsdD86IFJlc3VsdDxULCBFPlxuKTogVCB8ICgocmVzdWx0OiBSZXN1bHQ8VCwgRT4pID0+IFQpIHtcbiAgY29uc3Qgb3AgPSAocjogUmVzdWx0PFQsIEU+KSA9PiAoaXNPayhyKSA/IHIudmFsdWUgOiBkZWZhdWx0VmFsdWUpO1xuICByZXR1cm4gY3VycnkxKG9wLCByZXN1bHQpO1xufVxuXG4vKiogQWxpYXMgZm9yIFtgdW53cmFwT3JgXSgjdW53cmFwb3IpICovXG5leHBvcnQgY29uc3QgZ2V0T3IgPSB1bndyYXBPcjtcblxuLyoqXG4gIFNhZmVseSBnZXQgdGhlIHZhbHVlIG91dCBvZiBhIFtgUmVzdWx0YF0oI3Jlc3VsdCkgYnkgcmV0dXJuaW5nIHRoZSB3cmFwcGVkXG4gIHZhbHVlIGlmIGl0IGlzIGBPa2AsIG9yIGJ5IGFwcGx5aW5nIGBvckVsc2VGbmAgdG8gdGhlIHZhbHVlIGluIHRoZSBgRXJyYC5cblxuICBUaGlzIGlzIHVzZWZ1bCB3aGVuIHlvdSBuZWVkIHRvICpnZW5lcmF0ZSogYSB2YWx1ZSAoZS5nLiBieSB1c2luZyBjdXJyZW50XG4gIHZhbHVlcyBpbiB0aGUgZW52aXJvbm1lbnQg4oCTIHdoZXRoZXIgcHJlbG9hZGVkIG9yIGJ5IGxvY2FsIGNsb3N1cmUpIGluc3RlYWQgb2ZcbiAgaGF2aW5nIGEgc2luZ2xlIGRlZmF1bHQgdmFsdWUgYXZhaWxhYmxlIChhcyBpbiBbYHVud3JhcE9yYF0oI3Vud3JhcG9yKSkuXG5cbiAgYGBgdHNcbiAgaW1wb3J0IHsgb2ssIGVyciwgdW53cmFwT3JFbHNlIH0gZnJvbSAndHJ1ZS1teXRoL3Jlc3VsdCc7XG5cbiAgLy8gWW91IGNhbiBpbWFnaW5lIHRoYXQgc29tZU90aGVyVmFsdWUgbWlnaHQgYmUgZHluYW1pYy5cbiAgY29uc3Qgc29tZU90aGVyVmFsdWUgPSAyO1xuICBjb25zdCBoYW5kbGVFcnIgPSAoZXJyVmFsdWU6IHN0cmluZykgPT4gZXJyVmFsdWUubGVuZ3RoICsgc29tZU90aGVyVmFsdWU7XG5cbiAgY29uc3QgYW5PayA9IG9rPG51bWJlciwgc3RyaW5nPig0Mik7XG4gIGNvbnNvbGUubG9nKHVud3JhcE9yRWxzZShoYW5kbGVFcnIsIGFuT2spKTsgIC8vIDQyXG5cbiAgY29uc3QgYW5FcnIgPSBlcnI8bnVtYmVyLCBzdHJpbmc+KCdvaCB0ZWggbm9lcycpO1xuICBjb25zb2xlLmxvZyh1bndyYXBPckVsc2UoaGFuZGxlRXJyLCBhbkVycikpOyAgLy8gMTNcbiAgYGBgXG5cbiAgQHR5cGVwYXJhbSBUICAgIFRoZSB2YWx1ZSB3cmFwcGVkIGluIHRoZSBgT2tgLlxuICBAdHlwZXBhcmFtIEUgICAgVGhlIHZhbHVlIHdyYXBwZWQgaW4gdGhlIGBFcnJgLlxuICBAcGFyYW0gb3JFbHNlRm4gQSBmdW5jdGlvbiBhcHBsaWVkIHRvIHRoZSB2YWx1ZSB3cmFwcGVkIGluIGByZXN1bHRgIGlmIGl0IGlzXG4gICAgICAgICAgICAgICAgICBhbiBgRXJyYCwgdG8gZ2VuZXJhdGUgdGhlIGZpbmFsIHZhbHVlLlxuICBAcGFyYW0gcmVzdWx0ICAgVGhlIGByZXN1bHRgIHRvIHVud3JhcCBpZiBpdCBpcyBhbiBgT2tgLlxuICBAcmV0dXJucyAgICAgICAgVGhlIHZhbHVlIHdyYXBwZWQgaW4gYHJlc3VsdGAgaWYgaXQgaXMgYE9rYCBvciB0aGUgdmFsdWVcbiAgICAgICAgICAgICAgICAgIHJldHVybmVkIGJ5IGBvckVsc2VGbmAgYXBwbGllZCB0byB0aGUgdmFsdWUgaW4gYEVycmAuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1bndyYXBPckVsc2U8VCwgRT4ob3JFbHNlRm46IChlcnJvcjogRSkgPT4gVCwgcmVzdWx0OiBSZXN1bHQ8VCwgRT4pOiBUO1xuZXhwb3J0IGZ1bmN0aW9uIHVud3JhcE9yRWxzZTxULCBFPihvckVsc2VGbjogKGVycm9yOiBFKSA9PiBUKTogKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBUO1xuZXhwb3J0IGZ1bmN0aW9uIHVud3JhcE9yRWxzZTxULCBFPihcbiAgb3JFbHNlRm46IChlcnJvcjogRSkgPT4gVCxcbiAgcmVzdWx0PzogUmVzdWx0PFQsIEU+XG4pOiBUIHwgKChyZXN1bHQ6IFJlc3VsdDxULCBFPikgPT4gVCkge1xuICBjb25zdCBvcCA9IChyOiBSZXN1bHQ8VCwgRT4pID0+IChpc09rKHIpID8gci52YWx1ZSA6IG9yRWxzZUZuKHIuZXJyb3IpKTtcbiAgcmV0dXJuIGN1cnJ5MShvcCwgcmVzdWx0KTtcbn1cblxuLyoqIEFsaWFzIGZvciBbYHVud3JhcE9yRWxzZWBdKCN1bndyYXBvcmVsc2UpICovXG5leHBvcnQgY29uc3QgZ2V0T3JFbHNlID0gdW53cmFwT3JFbHNlO1xuXG4vKipcbiAgQ29udmVydCBhIFtgUmVzdWx0YF0oI3Jlc3VsdCkgdG8gYSBbYE1heWJlYF0oLi4vbW9kdWxlcy9fbWF5YmVfLmh0bWwjbWF5YmUpLlxuXG4gIFRoZSBjb252ZXJ0ZWQgdHlwZSB3aWxsIGJlIFtgSnVzdGBdIGlmIHRoZSBgUmVzdWx0YCBpcyBbYE9rYF0gb3IgW2BOb3RoaW5nYF1cbiAgaWYgdGhlIGBSZXN1bHRgIGlzIFtgRXJyYF07IHRoZSB3cmFwcGVkIGVycm9yIHZhbHVlIHdpbGwgYmUgZGlzY2FyZGVkLlxuXG4gIFtgSnVzdGBdOiAuLi9jbGFzc2VzL19tYXliZV8uanVzdC5odG1sXG4gIFtgTm90aGluZ2BdOiAuLi9jbGFzc2VzL19tYXliZV8ubm90aGluZy5odG1sXG4gIFtgT2tgXTogLi4vY2xhc3Nlcy9fcmVzdWx0Xy5vay5odG1sXG4gIFtgRXJyYF06IC4uL2NsYXNzZXMvX3Jlc3VsdF8uZXJyLmh0bWxcblxuICBAcGFyYW0gcmVzdWx0IFRoZSBgUmVzdWx0YCB0byBjb252ZXJ0IHRvIGEgYE1heWJlYFxuICBAcmV0dXJucyAgICAgIGBKdXN0YCB0aGUgdmFsdWUgaW4gYHJlc3VsdGAgaWYgaXQgaXMgYE9rYDsgb3RoZXJ3aXNlIGBOb3RoaW5nYFxuICovXG5leHBvcnQgZnVuY3Rpb24gdG9NYXliZTxUPihyZXN1bHQ6IFJlc3VsdDxULCBhbnk+KTogTWF5YmU8VD4ge1xuICByZXR1cm4gaXNPayhyZXN1bHQpID8ganVzdChyZXN1bHQudmFsdWUpIDogbm90aGluZygpO1xufVxuXG4vKipcbiAgVHJhbnNmb3JtIGEgW2BNYXliZWBdKC4uL21vZHVsZXMvX21heWJlXy5odG1sI21heWJlKSBpbnRvIGEgW2BSZXN1bHRgXSgjcmVzdWx0KS5cblxuICBJZiB0aGUgYE1heWJlYCBpcyBhIFtgSnVzdGBdLCBpdHMgdmFsdWUgd2lsbCBiZSB3cmFwcGVkIGluIHRoZSBbYE9rYF0gdmFyaWFudDtcbiAgaWYgaXQgaXMgYSBbYE5vdGhpbmdgXSB0aGUgYGVyclZhbHVlYCB3aWxsIGJlIHdyYXBwZWQgaW4gdGhlIFtgRXJyYF0gdmFyaWFudC5cblxuICBbYEp1c3RgXTogLi4vY2xhc3Nlcy9fbWF5YmVfLmp1c3QuaHRtbFxuICBbYE5vdGhpbmdgXTogLi4vY2xhc3Nlcy9fbWF5YmVfLm5vdGhpbmcuaHRtbFxuICBbYE9rYF06IC4uL2NsYXNzZXMvX3Jlc3VsdF8ub2suaHRtbFxuICBbYEVycmBdOiAuLi9jbGFzc2VzL19yZXN1bHRfLmVyci5odG1sXG5cbiAgQHBhcmFtIGVyclZhbHVlIEEgdmFsdWUgdG8gd3JhcCBpbiBhbiBgRXJyYCBpZiBgbWF5YmVgIGlzIGEgYE5vdGhpbmdgLlxuICBAcGFyYW0gbWF5YmUgICAgVGhlIGBNYXliZWAgdG8gY29udmVydCB0byBhIGBSZXN1bHRgLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZnJvbU1heWJlPFQsIEU+KGVyclZhbHVlOiBFLCBtYXliZTogTWF5YmU8VD4pOiBSZXN1bHQ8VCwgRT47XG5leHBvcnQgZnVuY3Rpb24gZnJvbU1heWJlPFQsIEU+KGVyclZhbHVlOiBFKTogKG1heWJlOiBNYXliZTxUPikgPT4gUmVzdWx0PFQsIEU+O1xuZXhwb3J0IGZ1bmN0aW9uIGZyb21NYXliZTxULCBFPihcbiAgZXJyVmFsdWU6IEUsXG4gIG1heWJlPzogTWF5YmU8VD5cbik6IFJlc3VsdDxULCBFPiB8ICgobWF5YmU6IE1heWJlPFQ+KSA9PiBSZXN1bHQ8VCwgRT4pIHtcbiAgY29uc3Qgb3AgPSAobTogTWF5YmU8VD4pID0+IChpc0p1c3QobSkgPyBvazxULCBFPihNYXliZS51bnNhZmVseVVud3JhcChtKSkgOiBlcnI8VCwgRT4oZXJyVmFsdWUpKTtcbiAgcmV0dXJuIGN1cnJ5MShvcCwgbWF5YmUpO1xufVxuXG4vKipcbiAgQ3JlYXRlIGEgYFN0cmluZ2AgcmVwcmVzZW50YXRpb24gb2YgYSBgcmVzdWx0YCBpbnN0YW5jZS5cblxuICBBbiBgT2tgIGluc3RhbmNlIHdpbGwgYmUgcHJpbnRlZCBhcyBgT2soPHJlcHJlc2VudGF0aW9uIG9mIHRoZSB2YWx1ZT4pYCwgYW5kXG4gIGFuIGBFcnJgIGluc3RhbmNlIHdpbGwgYmUgcHJpbnRlZCBhcyBgRXJyKDxyZXByZXNlbnRhdGlvbiBvZiB0aGUgZXJyb3I+KWAsXG4gIHdoZXJlIHRoZSByZXByZXNlbnRhdGlvbiBvZiB0aGUgdmFsdWUgb3IgZXJyb3IgaXMgc2ltcGx5IHRoZSB2YWx1ZSBvciBlcnJvcidzXG4gIG93biBgdG9TdHJpbmdgIHJlcHJlc2VudGF0aW9uLiBGb3IgZXhhbXBsZTpcblxuICAgICAgICAgICAgICAgIGNhbGwgICAgICAgICAgICAgICAgfCAgICAgICAgIG91dHB1dFxuICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gfCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGB0b1N0cmluZyhvayg0MikpYCAgICAgICAgICAgICAgICB8IGBPayg0MilgXG4gIGB0b1N0cmluZyhvayhbMSwgMiwgM10pKWAgICAgICAgICB8IGBPaygxLDIsMylgXG4gIGB0b1N0cmluZyhvayh7IGFuOiAnb2JqZWN0JyB9KSlgICB8IGBPayhbb2JqZWN0IE9iamVjdF0pYG5cbiAgYHRvU3RyaW5nKGVycig0MikpYCAgICAgICAgICAgICAgIHwgYEVycig0MilgXG4gIGB0b1N0cmluZyhlcnIoWzEsIDIsIDNdKSlgICAgICAgICB8IGBFcnIoMSwyLDMpYFxuICBgdG9TdHJpbmcoZXJyKHsgYW46ICdvYmplY3QnIH0pKWAgfCBgRXJyKFtvYmplY3QgT2JqZWN0XSlgXG5cbiAgQHR5cGVwYXJhbSBUIFRoZSB0eXBlIG9mIHRoZSB3cmFwcGVkIHZhbHVlOyBpdHMgb3duIGAudG9TdHJpbmdgIHdpbGwgYmUgdXNlZFxuICAgICAgICAgICAgICAgdG8gcHJpbnQgdGhlIGludGVyaW9yIGNvbnRlbnRzIG9mIHRoZSBgSnVzdGAgdmFyaWFudC5cbiAgQHBhcmFtIG1heWJlIFRoZSB2YWx1ZSB0byBjb252ZXJ0IHRvIGEgc3RyaW5nLlxuICBAcmV0dXJucyAgICAgVGhlIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgYE1heWJlYC5cbiAqL1xuZXhwb3J0IGNvbnN0IHRvU3RyaW5nID0gPFQsIEU+KHJlc3VsdDogUmVzdWx0PFQsIEU+KTogc3RyaW5nID0+IHtcbiAgY29uc3QgYm9keSA9IChpc09rKHJlc3VsdCkgPyByZXN1bHQudmFsdWUgOiByZXN1bHQuZXJyb3IpLnRvU3RyaW5nKCk7XG4gIHJldHVybiBgJHtyZXN1bHQudmFyaWFudC50b1N0cmluZygpfSgke2JvZHl9KWA7XG59O1xuXG4vKiogQSBsaWdodHdlaWdodCBvYmplY3QgZGVmaW5pbmcgaG93IHRvIGhhbmRsZSBlYWNoIHZhcmlhbnQgb2YgYSBNYXliZS4gKi9cbmV4cG9ydCB0eXBlIE1hdGNoZXI8VCwgRSwgQT4gPSB7XG4gIE9rOiAodmFsdWU6IFQpID0+IEE7XG4gIEVycjogKGVycm9yOiBFKSA9PiBBO1xufTtcblxuLyoqXG4gIFBlcmZvcm1zIHRoZSBzYW1lIGJhc2ljIGZ1bmN0aW9uYWxpdHkgYXMgYGdldE9yRWxzZWAsIGJ1dCBpbnN0ZWFkIG9mIHNpbXBseVxuICB1bndyYXBwaW5nIHRoZSB2YWx1ZSBpZiBpdCBpcyBgT2tgIGFuZCBhcHBseWluZyBhIHZhbHVlIHRvIGdlbmVyYXRlIHRoZSBzYW1lXG4gIGRlZmF1bHQgdHlwZSBpZiBpdCBpcyBgTm90aGluZ2AsIGxldHMgeW91IHN1cHBseSBmdW5jdGlvbnMgd2hpY2ggbWF5IHRyYW5zZm9ybVxuICB0aGUgd3JhcHBlZCB0eXBlIGlmIGl0IGlzIGBPa2Agb3IgZ2V0IGEgZGVmYXVsdCB2YWx1ZSBmb3IgYE5vdGhpbmdgLlxuXG4gIFRoaXMgaXMga2luZCBvZiBsaWtlIGEgcG9vciBtYW4ncyB2ZXJzaW9uIG9mIHBhdHRlcm4gbWF0Y2hpbmcsIHdoaWNoXG4gIEphdmFTY3JpcHQgY3VycmVudGx5IGxhY2tzLlxuXG4gIEluc3RlYWQgb2YgY29kZSBsaWtlIHRoaXM6XG5cbiAgYGBgdHNcbiAgaW1wb3J0IHsgUmVzdWx0LCBpc09rLCBtYXRjaCB9IGZyb20gJ3RydWUtbXl0aC9yZXN1bHQnO1xuXG4gIGNvbnN0IGxvZ1ZhbHVlID0gKG1pZ2h0QmVBTnVtYmVyOiBSZXN1bHQ8bnVtYmVyLCBzdHJpbmc+KSA9PiB7XG4gICAgY29uc29sZS5sb2coXG4gICAgICBpc09rKG1pZ2h0QmVBTnVtYmVyKVxuICAgICAgICA/IHVuc2FmZWx5VW53cmFwKG1pZ2h0QmVBTnVtYmVyKS50b1N0cmluZygpXG4gICAgICAgIDogYFRoZXJlIHdhcyBhbiBlcnJvcjogJHt1bnNhZmVseUdldEVycihtaWdodEJlQU51bWJlcil9YFxuICAgICk7XG4gIH07XG4gIGBgYFxuXG4gIC4uLndlIGNhbiB3cml0ZSBjb2RlIGxpa2UgdGhpczpcblxuICBgYGB0c1xuICBpbXBvcnQgeyBSZXN1bHQsIG1hdGNoIH0gZnJvbSAndHJ1ZS1teXRoL3Jlc3VsdCc7XG5cbiAgY29uc3QgbG9nVmFsdWUgPSAobWlnaHRCZUFOdW1iZXI6IFJlc3VsdDxudW1iZXIsIHN0cmluZz4pID0+IHtcbiAgICBjb25zdCB2YWx1ZSA9IG1hdGNoKFxuICAgICAge1xuICAgICAgICBPazogbiA9PiBuLnRvU3RyaW5nKCksXG4gICAgICAgIEVycjogZSA9PiBgVGhlcmUgd2FzIGFuIGVycm9yOiAke2V9YCxcbiAgICAgIH0sXG4gICAgICBtaWdodEJlQU51bWJlclxuICAgICk7XG4gICAgY29uc29sZS5sb2codmFsdWUpO1xuICB9O1xuICBgYGBcblxuICBUaGlzIGlzIHNsaWdodGx5IGxvbmdlciB0byB3cml0ZSwgYnV0IGNsZWFyZXI6IHRoZSBtb3JlIGNvbXBsZXggdGhlIHJlc3VsdGluZ1xuICBleHByZXNzaW9uLCB0aGUgaGFpcmVyIGl0IGlzIHRvIHVuZGVyc3RhbmQgdGhlIHRlcm5hcnkuIFRodXMsIHRoaXMgaXNcbiAgZXNwZWNpYWxseSBjb252ZW5pZW50IGZvciB0aW1lcyB3aGVuIHRoZXJlIGlzIGEgY29tcGxleCByZXN1bHQsIGUuZy4gd2hlblxuICByZW5kZXJpbmcgcGFydCBvZiBhIFJlYWN0IGNvbXBvbmVudCBpbmxpbmUgaW4gSlNYL1RTWC5cblxuICBAcGFyYW0gbWF0Y2hlciBBIGxpZ2h0d2VpZ2h0IG9iamVjdCBkZWZpbmluZyB3aGF0IHRvIGRvIGluIHRoZSBjYXNlIG9mIGVhY2hcbiAgICAgICAgICAgICAgICAgdmFyaWFudC5cbiAgQHBhcmFtIG1heWJlICAgVGhlIGBtYXliZWAgaW5zdGFuY2UgdG8gY2hlY2suXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtYXRjaDxULCBFLCBBPihtYXRjaGVyOiBNYXRjaGVyPFQsIEUsIEE+LCByZXN1bHQ6IFJlc3VsdDxULCBFPik6IEE7XG5leHBvcnQgZnVuY3Rpb24gbWF0Y2g8VCwgRSwgQT4obWF0Y2hlcjogTWF0Y2hlcjxULCBFLCBBPik6IChyZXN1bHQ6IFJlc3VsdDxULCBFPikgPT4gQTtcbmV4cG9ydCBmdW5jdGlvbiBtYXRjaDxULCBFLCBBPihcbiAgbWF0Y2hlcjogTWF0Y2hlcjxULCBFLCBBPixcbiAgcmVzdWx0PzogUmVzdWx0PFQsIEU+XG4pOiBBIHwgKChyZXN1bHQ6IFJlc3VsdDxULCBFPikgPT4gQSkge1xuICBjb25zdCBvcCA9IChyOiBSZXN1bHQ8VCwgRT4pID0+IG1hcE9yRWxzZShtYXRjaGVyLkVyciwgbWF0Y2hlci5Paywgcik7XG4gIHJldHVybiBjdXJyeTEob3AsIHJlc3VsdCk7XG59XG5cbi8qKiBBbGlhcyBmb3IgW2BtYXRjaGBdKCNtYXRjaCkgKi9cbmV4cG9ydCBjb25zdCBjYXRhID0gbWF0Y2g7XG5cbi8qKlxuICBBbGxvd3MgcXVpY2sgdHJpcGxlLWVxdWFsIGVxdWFsaXR5IGNoZWNrIGJldHdlZW4gdGhlIHZhbHVlcyBpbnNpZGUgdHdvIGByZXN1bHRgc1xuICB3aXRob3V0IGhhdmluZyB0byB1bndyYXAgdGhlbSBmaXJzdC5cblxuICBgYGB0c1xuICBjb25zdCBhID0gUmVzdWx0Lm9mKDMpXG4gIGNvbnN0IGIgPSBSZXN1bHQub2YoMylcbiAgY29uc3QgYyA9IFJlc3VsdC5vZihudWxsKVxuICBjb25zdCBkID0gUmVzdWx0Lm5vdGhpbmcoKVxuXG4gIFJlc3VsdC5lcXVhbHMoYSwgYikgLy8gdHJ1ZVxuICBSZXN1bHQuZXF1YWxzKGEsIGMpIC8vIGZhbHNlXG4gIFJlc3VsdC5lcXVhbHMoYywgZCkgLy8gdHJ1ZVxuICBgYGBcblxuICBAcGFyYW0gcmVzdWx0QiBBIGBtYXliZWAgdG8gY29tcGFyZSB0by5cbiAgQHBhcmFtIHJlc3VsdEEgQSBgbWF5YmVgIGluc3RhbmNlIHRvIGNoZWNrLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZXF1YWxzPFQsIEU+KHJlc3VsdEI6IFJlc3VsdDxULCBFPiwgcmVzdWx0QTogUmVzdWx0PFQsIEU+KTogYm9vbGVhbjtcbmV4cG9ydCBmdW5jdGlvbiBlcXVhbHM8VCwgRT4ocmVzdWx0QjogUmVzdWx0PFQsIEU+KTogKHJlc3VsdEE6IFJlc3VsdDxULCBFPikgPT4gYm9vbGVhbjtcbmV4cG9ydCBmdW5jdGlvbiBlcXVhbHM8VCwgRT4oXG4gIHJlc3VsdEI6IFJlc3VsdDxULCBFPixcbiAgcmVzdWx0QT86IFJlc3VsdDxULCBFPlxuKTogYm9vbGVhbiB8ICgoYTogUmVzdWx0PFQsIEU+KSA9PiBib29sZWFuKSB7XG4gIHJldHVybiByZXN1bHRBICE9PSB1bmRlZmluZWRcbiAgICA/IHJlc3VsdEEubWF0Y2goe1xuICAgICAgICBFcnI6ICgpID0+IGlzRXJyKHJlc3VsdEIpLFxuICAgICAgICBPazogYSA9PiBpc09rKHJlc3VsdEIpICYmIHJlc3VsdEIudW5zYWZlbHlVbndyYXAoKSA9PT0gYSxcbiAgICAgIH0pXG4gICAgOiAoY3VycmllZFJlc3VsdEE6IFJlc3VsdDxULCBFPikgPT5cbiAgICAgICAgY3VycmllZFJlc3VsdEEubWF0Y2goe1xuICAgICAgICAgIEVycjogKCkgPT4gaXNFcnIocmVzdWx0QiksXG4gICAgICAgICAgT2s6IGEgPT4gaXNPayhyZXN1bHRCKSAmJiByZXN1bHRCLnVuc2FmZWx5VW53cmFwKCkgPT09IGEsXG4gICAgICAgIH0pO1xufVxuXG4vKipcbiAgQWxsb3dzIHlvdSB0byAqYXBwbHkqICh0aHVzIGBhcGApIGEgdmFsdWUgdG8gYSBmdW5jdGlvbiB3aXRob3V0IGhhdmluZyB0b1xuICB0YWtlIGVpdGhlciBvdXQgb2YgdGhlIGNvbnRleHQgb2YgdGhlaXIgYFJlc3VsdGBzLiBUaGlzIGRvZXMgbWVhbiB0aGF0IHRoZVxuICB0cmFuc2Zvcm1pbmcgZnVuY3Rpb24gaXMgaXRzZWxmIHdpdGhpbiBhIGBSZXN1bHRgLCB3aGljaCBjYW4gYmUgaGFyZCB0byBncm9rXG4gIGF0IGZpcnN0IGJ1dCBsZXRzIHlvdSBkbyBzb21lIHZlcnkgZWxlZ2FudCB0aGluZ3MuIEZvciBleGFtcGxlLCBgYXBgIGFsbG93c1xuICB5b3UgdG8gZG8gdGhpczpcblxuICBgYGB0c1xuICBpbXBvcnQgUmVzdWx0IGZyb20gJ3RydWUtbXl0aC9yZXN1bHQnO1xuXG4gIGNvbnN0IG9uZSA9IFJlc3VsdC5vazxudW1iZXIsIHN0cmluZz4oMSk7XG4gIGNvbnN0IGZpdmUgPSBSZXN1bHQub2s8bnVtYmVyLCBzdHJpbmc+KDUpO1xuICBjb25zdCB3aG9vcHMgPSBSZXN1bHQuZXJyPG51bWJlciwgc3RyaW5nPignb2ggbm8nKTtcblxuICBjb25zdCBhZGQgPSAoYTogbnVtYmVyKSA9PiAoYjogbnVtYmVyKSA9PiBhICsgYjtcbiAgY29uc3QgcmVzdWx0QWRkID0gUmVzdWx0Lm9rPHR5cGVvZiBhZGQsIHN0cmluZz4oYWRkKTtcblxuICByZXN1bHRBZGQuYXAob25lKS5hcChmaXZlKTsgLy8gT2soNilcbiAgcmVzdWx0QWRkLmFwKG9uZSkuYXAod2hvb3BzKTsgLy8gRXJyKCdvaCBubycpXG4gIHJlc3VsdEFkZC5hcCh3aG9vcHMpLmFwKGZpdmUpIC8vIEVycignb2ggbm8nKVxuICBgYGBcblxuICBXaXRob3V0IGBSZXN1bHQuYXBgLCB5b3UnZCBuZWVkIHRvIGRvIHNvbWV0aGluZyBsaWtlIGEgbmVzdGVkIGBSZXN1bHQubWF0Y2hgOlxuXG4gIGBgYHRzXG4gIGltcG9ydCB7IG9rLCBlcnIgfSBmcm9tICd0cnVlLW15dGgvcmVzdWx0JztcblxuICBjb25zdCBvbmUgPSBvazxudW1iZXIsIHN0cmluZz4oMSk7XG4gIGNvbnN0IGZpdmUgPSBvazxudW1iZXIsIHN0cmluZz4oNSk7XG4gIGNvbnN0IHdob29wcyA9IGVycjxudW1iZXIsIHN0cmluZz4oJ29oIG5vJyk7XG5cbiAgb25lLm1hdGNoKHtcbiAgICBPazogbiA9PiBmaXZlLm1hdGNoKHtcbiAgICAgIE9rOiBvID0+IG9rPG51bWJlciwgc3RyaW5nPihuICsgbyksXG4gICAgICBFcnI6IGUgPT4gZXJyPG51bWJlciwgc3RyaW5nPihlKSxcbiAgICB9KSxcbiAgICBFcnI6IGUgID0+IGVycjxudW1iZXIsIHN0cmluZz4oZSksXG4gIH0pOyAvLyBPayg2KVxuXG4gIG9uZS5tYXRjaCh7XG4gICAgT2s6IG4gPT4gd2hvb3BzLm1hdGNoKHtcbiAgICAgIE9rOiBvID0+IG9rPG51bWJlciwgc3RyaW5nPihuICsgbyksXG4gICAgICBFcnI6IGUgPT4gZXJyPG51bWJlciwgc3RyaW5nPihlKSxcbiAgICB9KSxcbiAgICBFcnI6IGUgID0+IGVycjxudW1iZXIsIHN0cmluZz4oZSksXG4gIH0pOyAvLyBFcnIoJ29oIG5vJylcblxuICB3aG9vcHMubWF0Y2goe1xuICAgIE9rOiBuID0+IGZpdmUubWF0Y2goe1xuICAgICAgT2s6IG8gPT4gb2sobiArIG8pLFxuICAgICAgRXJyOiBlID0+IGVycihlKSxcbiAgICB9KSxcbiAgICBFcnI6IGUgID0+IGVycihlKSxcbiAgfSk7IC8vIEVycignb2ggbm8nKVxuICBgYGBcblxuICBBbmQgdGhpcyBraW5kIG9mIHRoaW5nIGNvbWVzIHVwIHF1aXRlIG9mdGVuIG9uY2UgeW91J3JlIHVzaW5nIGBNYXliZWAgdG9cbiAgaGFuZGxlIG9wdGlvbmFsaXR5IHRocm91Z2hvdXQgeW91ciBhcHBsaWNhdGlvbi5cblxuICBGb3IgYW5vdGhlciBleGFtcGxlLCBpbWFnaW5lIHlvdSBuZWVkIHRvIGNvbXBhcmUgdGhlIGVxdWFsaXR5IG9mIHR3b1xuICBJbW11dGFibGVKUyBkYXRhIHN0cnVjdHVyZXMsIHdoZXJlIGEgYD09PWAgY29tcGFyaXNvbiB3b24ndCB3b3JrLiBXaXRoIGBhcGAsXG4gIHRoYXQncyBhcyBzaW1wbGUgYXMgdGhpczpcblxuICBgYGB0c1xuICBpbXBvcnQgeyBvayB9IGZyb20gJ3RydWUtbXl0aC9yZXN1bHQnO1xuICBpbXBvcnQgSW1tdXRhYmxlIGZyb20gJ2ltbXV0YWJsZSc7XG4gIGltcG9ydCB7IGN1cnJ5IH0gZnJvbSAnbG9kYXNoJ1xuXG4gIGNvbnN0IGlzID0gY3VycnkoSW1tdXRhYmxlLmlzKTtcblxuICBjb25zdCB4ID0gb2soSW1tdXRhYmxlLlNldC5vZigxLCAyLCAzKSk7XG4gIGNvbnN0IHkgPSBvayhJbW11dGFibGUuU2V0Lm9mKDIsIDMsIDQpKTtcblxuICBvayhpcykuYXAoeCkuYXAoeSk7IC8vIE9rKGZhbHNlKVxuICBgYGBcblxuICBXaXRob3V0IGBhcGAsIHdlJ3JlIGJhY2sgdG8gdGhhdCBnbmFybHkgbmVzdGVkIGBtYXRjaGA6XG5cbiAgYGBgdHNcbiAgICogaW1wb3J0IFJlc3VsdCwgeyBvaywgZXJyIH0gZnJvbSAndHJ1ZS1teXRoL3Jlc3VsdCc7XG4gIGltcG9ydCBJbW11dGFibGUgZnJvbSAnaW1tdXRhYmxlJztcbiAgaW1wb3J0IHsgY3VycnkgfSBmcm9tICdsb2Rhc2gnXG5cbiAgY29uc3QgaXMgPSBjdXJyeShJbW11dGFibGUuaXMpO1xuXG4gIGNvbnN0IHggPSBvayhJbW11dGFibGUuU2V0Lm9mKDEsIDIsIDMpKTtcbiAgY29uc3QgeSA9IG9rKEltbXV0YWJsZS5TZXQub2YoMiwgMywgNCkpO1xuXG4gIHgubWF0Y2goe1xuICAgIE9rOiBpWCA9PiB5Lm1hdGNoKHtcbiAgICAgIE9rOiBpWSA9PiBSZXN1bHQub2YoSW1tdXRhYmxlLmlzKGlYLCBpWSkpLFxuICAgICAgRXJyOiAoZSkgPT4gb2soZmFsc2UpLFxuICAgIH0pXG4gICAgRXJyOiAoZSkgPT4gb2soZmFsc2UpLFxuICB9KTsgLy8gT2soZmFsc2UpXG4gIGBgYFxuXG4gIEluIHN1bW1hcnk6IGFueXdoZXJlIHlvdSBoYXZlIHR3byBgTWF5YmVgIGluc3RhbmNlcyBhbmQgbmVlZCB0byBwZXJmb3JtIGFuXG4gIG9wZXJhdGlvbiB0aGF0IHVzZXMgYm90aCBvZiB0aGVtLCBgYXBgIGlzIHlvdXIgZnJpZW5kLlxuXG4gIFR3byB0aGluZ3MgdG8gbm90ZSwgYm90aCByZWdhcmRpbmcgKmN1cnJ5aW5nKjpcblxuICAxLiAgQWxsIGZ1bmN0aW9ucyBwYXNzZWQgdG8gYGFwYCBtdXN0IGJlIGN1cnJpZWQuIFRoYXQgaXMsIHRoZXkgbXVzdCBiZSBvZiB0aGVcbiAgICAgIGZvcm0gKGZvciBhZGQpIGAoYTogbnVtYmVyKSA9PiAoYjogbnVtYmVyKSA9PiBhICsgYmAsICpub3QqIHRoZSBtb3JlIHVzdWFsXG4gICAgICBgKGE6IG51bWJlciwgYjogbnVtYmVyKSA9PiBhICsgYmAgeW91IHNlZSBpbiBKYXZhU2NyaXB0IG1vcmUgZ2VuZXJhbGx5LlxuXG4gICAgICBGb3IgY29udmVuaWVuY2UsIHlvdSBtYXkgd2FudCB0byBsb29rIGF0IExvZGFzaCdzIGBfLmN1cnJ5YCBvciBSYW1kYSdzXG4gICAgICBgUi5jdXJyeWAsIHdoaWNoIGFsbG93IHlvdSB0byBjcmVhdGUgY3VycmllZCB2ZXJzaW9ucyBvZiBmdW5jdGlvbnNcbiAgICAgIHdoZW5ldmVyIHlvdSB3YW50OlxuXG4gICAgICBgYGBcbiAgICAgIGltcG9ydCBSZXN1bHQgZnJvbSAndHJ1ZS1teXRoL3Jlc3VsdCc7XG4gICAgICBpbXBvcnQgeyBjdXJyeSB9IGZyb20gJ2xvZGFzaCc7XG5cbiAgICAgIGNvbnN0IG5vcm1hbEFkZCA9IChhOiBudW1iZXIsIGI6IG51bWJlcikgPT4gYSArIGI7XG4gICAgICBjb25zdCBjdXJyaWVkQWRkID0gY3Vycnkobm9ybWFsQWRkKTsgLy8gKGE6IG51bWJlcikgPT4gKGI6IG51bWJlcikgPT4gYSArIGI7XG5cbiAgICAgIFJlc3VsdC5vZihjdXJyaWVkQWRkKS5hcChSZXN1bHQub2YoMSkpLmFwKFJlc3VsdC5vZig1KSk7IC8vIE9rKDYpXG4gICAgICBgYGBcblxuICAyLiAgWW91IHdpbGwgbmVlZCB0byBjYWxsIGBhcGAgYXMgbWFueSB0aW1lcyBhcyB0aGVyZSBhcmUgYXJndW1lbnRzIHRvIHRoZVxuICAgICAgZnVuY3Rpb24geW91J3JlIGRlYWxpbmcgd2l0aC4gU28gaW4gdGhlIGNhc2Ugb2YgYGFkZGAsIHdoaWNoIGhhcyB0aGVcbiAgICAgIFwiYXJpdHlcIiAoZnVuY3Rpb24gYXJndW1lbnQgY291bnQpIG9mIDIgKGBhYCBhbmQgYGJgKSwgeW91J2xsIG5lZWQgdG8gY2FsbFxuICAgICAgYGFwYCB0d2ljZTogb25jZSBmb3IgYGFgLCBhbmQgb25jZSBmb3IgYGJgLiBUbyBzZWUgd2h5LCBsZXQncyBsb29rIGF0IHdoYXRcbiAgICAgIHRoZSByZXN1bHQgaW4gZWFjaCBwaGFzZSBpczpcblxuICAgICAgYGBgdHNcbiAgICAgIGNvbnN0IGFkZCA9IChhOiBudW1iZXIpID0+IChiOiBudW1iZXIpID0+IGEgKyBiO1xuXG4gICAgICBjb25zdCBtYXliZUFkZCA9IFJlc3VsdC5vZihhZGQpOyAvLyBPaygoYTogbnVtYmVyKSA9PiAoYjogbnVtYmVyKSA9PiBhICsgYilcbiAgICAgIGNvbnN0IG1heWJlQWRkMSA9IG1heWJlQWRkLmFwKFJlc3VsdC5vZigxKSk7IC8vIE9rKChiOiBudW1iZXIpID0+IDEgKyBiKVxuICAgICAgY29uc3QgZmluYWwgPSBtYXliZUFkZDEuYXAoUmVzdWx0Lm9mKDMpKTsgLy8gT2soNClcbiAgICAgIGBgYFxuXG4gICAgICBTbyBmb3IgYHRvU3RyaW5nYCwgd2hpY2gganVzdCB0YWtlcyBhIHNpbmdsZSBhcmd1bWVudCwgeW91IHdvdWxkIG9ubHkgbmVlZFxuICAgICAgdG8gY2FsbCBgYXBgIG9uY2UuXG5cbiAgICAgIGBgYHRzXG4gICAgICBjb25zdCB0b1N0ciA9ICh2OiB7IHRvU3RyaW5nKCk6IHN0cmluZyB9KSA9PiB2LnRvU3RyaW5nKCk7XG4gICAgICBSZXN1bHQub2YodG9TdHIpLmFwKDEyKTsgLy8gT2soXCIxMlwiKVxuICAgICAgYGBgXG5cbiAgT25lIG90aGVyIHNjZW5hcmlvIHdoaWNoIGRvZXNuJ3QgY29tZSB1cCAqcXVpdGUqIGFzIG9mdGVuIGJ1dCBpcyBjb25jZWl2YWJsZVxuICBpcyB3aGVyZSB5b3UgaGF2ZSBzb21ldGhpbmcgdGhhdCBtYXkgb3IgbWF5IG5vdCBhY3R1YWxseSBjb25zdHJ1Y3QgYSBmdW5jdGlvblxuICBmb3IgaGFuZGxpbmcgYSBzcGVjaWZpYyBgUmVzdWx0YCBzY2VuYXJpby4gSW4gdGhhdCBjYXNlLCB5b3UgY2FuIHdyYXAgdGhlXG4gIHBvc3NpYmx5LXByZXNlbnQgaW4gYGFwYCBhbmQgdGhlbiB3cmFwIHRoZSB2YWx1ZXMgdG8gYXBwbHkgdG8gdGhlIGZ1bmN0aW9uIHRvXG4gIGluIGBSZXN1bHRgIHRoZW1zZWx2ZXMuXG5cbiAgQmVjYXVzZSBgUmVzdWx0YCBvZnRlbiByZXF1aXJlcyB5b3UgdG8gdHlwZSBvdXQgdGhlIGZ1bGwgdHlwZSBwYXJhbWV0ZXJpemF0aW9uXG4gIG9uIGEgcmVndWxhciBiYXNpcywgaXQncyBjb252ZW5pZW50IHRvIHVzZSBUeXBlU2NyaXB0J3MgYHR5cGVvZmAgb3BlcmF0b3IgdG9cbiAgd3JpdGUgb3V0IHRoZSB0eXBlIG9mIGEgY3VycmllZCBmdW5jdGlvbi4gRm9yIGV4YW1wbGUsIGlmIHlvdSBoYWQgYSBmdW5jdGlvblxuICB0aGF0IHNpbXBseSBtZXJnZWQgdGhyZWUgc3RyaW5ncywgeW91IG1pZ2h0IHdyaXRlIGl0IGxpa2UgdGhpczpcblxuICBgYGB0c1xuICBpbXBvcnQgUmVzdWx0IGZyb20gJ3RydWUtbXl0aC9yZXN1bHQnO1xuICBpbXBvcnQgeyBjdXJyeSB9IGZyb20gJ2xvZGFzaCc7XG5cbiAgY29uc3QgbWVyZ2UzU3RycyA9IChhOiBzdHJpbmcsIGI6IHN0cmluZywgYzogc3RyaW5nKSA9PiBzdHJpbmc7XG4gIGNvbnN0IGN1cnJpZWRNZXJnZSA9IGN1cnJ5KG1lcmdlM1N0cnMpO1xuXG4gIGNvbnN0IGZuID0gUmVzdWx0Lm9rPHR5cGVvZiBjdXJyaWVkTWVyZ2UsIHN0cmluZz4oY3VycmllZE1lcmdlKTtcbiAgYGBgXG5cbiAgVGhlIGFsdGVybmF0aXZlIGlzIHdyaXRpbmcgb3V0IHRoZSBmdWxsIHNpZ25hdHVyZSBsb25nLWZvcm06XG5cbiAgYGBgdHNcbiAgY29uc3QgZm4gPSBSZXN1bHQub2s8KGE6IHN0cmluZykgPT4gKGI6IHN0cmluZykgPT4gKGM6IHN0cmluZykgPT4gc3RyaW5nLCBzdHJpbmc+KGN1cnJpZWRNZXJnZSk7XG4gIGBgYFxuXG4gICoqQXNpZGU6KiogYGFwYCBpcyBub3QgbmFtZWQgYGFwcGx5YCBiZWNhdXNlIG9mIHRoZSBvdmVybGFwIHdpdGggSmF2YVNjcmlwdCdzXG4gIGV4aXN0aW5nIFtgYXBwbHlgXSBmdW5jdGlvbiDigJMgYW5kIGFsdGhvdWdoIHN0cmljdGx5IHNwZWFraW5nLCB0aGVyZSBpc24ndCBhbnlcbiAgZGlyZWN0IG92ZXJsYXAgKGBSZXN1bHQuYXBwbHlgIGFuZCBgRnVuY3Rpb24ucHJvdG90eXBlLmFwcGx5YCBkb24ndCBpbnRlcnNlY3RcbiAgYXQgYWxsKSBpdCdzIHVzZWZ1bCB0byBoYXZlIGEgZGlmZmVyZW50IG5hbWUgdG8gYXZvaWQgaW1wbHlpbmcgdGhhdCB0aGV5J3JlXG4gIHRoZSBzYW1lLlxuXG4gIFtgYXBwbHlgXTogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvRnVuY3Rpb24vYXBwbHlcblxuICBAcGFyYW0gcmVzdWx0Rm4gcmVzdWx0IG9mIGEgZnVuY3Rpb24gZnJvbSBUIHRvIFVcbiAgQHBhcmFtIHJlc3VsdCByZXN1bHQgb2YgYSBUIHRvIGFwcGx5IHRvIGBmbmBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFwPFQsIFUsIEU+KHJlc3VsdEZuOiBSZXN1bHQ8KHQ6IFQpID0+IFUsIEU+LCByZXN1bHQ6IFJlc3VsdDxULCBFPik6IFJlc3VsdDxVLCBFPjtcbmV4cG9ydCBmdW5jdGlvbiBhcDxULCBVLCBFPihcbiAgcmVzdWx0Rm46IFJlc3VsdDwodDogVCkgPT4gVSwgRT5cbik6IChyZXN1bHQ6IFJlc3VsdDxULCBFPikgPT4gUmVzdWx0PFUsIEU+O1xuZXhwb3J0IGZ1bmN0aW9uIGFwPFQsIFUsIEU+KFxuICByZXN1bHRGbjogUmVzdWx0PCh2YWw6IFQpID0+IFUsIEU+LFxuICByZXN1bHQ/OiBSZXN1bHQ8VCwgRT5cbik6IFJlc3VsdDxVLCBFPiB8ICgodmFsOiBSZXN1bHQ8VCwgRT4pID0+IFJlc3VsdDxVLCBFPikge1xuICBjb25zdCBvcCA9IChyOiBSZXN1bHQ8VCwgRT4pID0+XG4gICAgci5tYXRjaCh7XG4gICAgICBPazogdmFsID0+IHJlc3VsdEZuLm1hcChmbiA9PiBmbih2YWwpKSxcbiAgICAgIEVycjogZSA9PiBSZXN1bHQuZXJyPFUsIEU+KGUpLFxuICAgIH0pO1xuXG4gIHJldHVybiBjdXJyeTEob3AsIHJlc3VsdCk7XG59XG5cbi8qKlxuICBEZXRlcm1pbmUgd2hldGhlciBhbiBpdGVtIGlzIGFuIGluc3RhbmNlIG9mIGBKdXN0YCBvciBgTm90aGluZ2AuXG5cbiAgQHBhcmFtIGl0ZW0gVGhlIGl0ZW0gdG8gY2hlY2suXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc0luc3RhbmNlPFQgPSBhbnksIEUgPSBhbnk+KGl0ZW06IGFueSk6IGl0ZW0gaXMgUmVzdWx0PFQsIEU+IHtcbiAgcmV0dXJuIGl0ZW0gaW5zdGFuY2VvZiBPayB8fCBpdGVtIGluc3RhbmNlb2YgRXJyO1xufVxuXG4vKipcbiAgQSB2YWx1ZSB3aGljaCBtYXkgKGBPa2ApIG9yIG1heSBub3QgKGBFcnJgKSBiZSBwcmVzZW50LlxuXG4gIFRoZSBiZWhhdmlvciBvZiB0aGlzIHR5cGUgaXMgY2hlY2tlZCBieSBUeXBlU2NyaXB0IGF0IGNvbXBpbGUgdGltZSwgYW5kIGJlYXJzXG4gIG5vIHJ1bnRpbWUgb3ZlcmhlYWQgb3RoZXIgdGhhbiB0aGUgdmVyeSBzbWFsbCBjb3N0IG9mIHRoZSBjb250YWluZXIgb2JqZWN0LlxuICovXG5leHBvcnQgdHlwZSBSZXN1bHQ8VCwgRT4gPSBPazxULCBFPiB8IEVycjxULCBFPjtcbmV4cG9ydCBjb25zdCBSZXN1bHQgPSB7XG4gIFZhcmlhbnQsXG4gIE9rLFxuICBFcnIsXG4gIGlzT2ssXG4gIGlzRXJyLFxuICBvayxcbiAgZXJyLFxuICBtYXAsXG4gIG1hcE9yLFxuICBtYXBPckVsc2UsXG4gIG1hcEVycixcbiAgYW5kLFxuICBhbmRUaGVuLFxuICBjaGFpbixcbiAgZmxhdE1hcCxcbiAgb3IsXG4gIG9yRWxzZSxcbiAgdW5zYWZlbHlVbndyYXAsXG4gIHVuc2FmZWx5R2V0LFxuICB1bnNhZmVHZXQsXG4gIHVuc2FmZWx5VW53cmFwRXJyLFxuICB1bnNhZmVseUdldEVycixcbiAgdW53cmFwT3IsXG4gIGdldE9yLFxuICB1bndyYXBPckVsc2UsXG4gIGdldE9yRWxzZSxcbiAgdG9NYXliZSxcbiAgZnJvbU1heWJlLFxuICB0b1N0cmluZyxcbiAgbWF0Y2gsXG4gIGNhdGEsXG4gIGVxdWFscyxcbiAgYXAsXG4gIGlzSW5zdGFuY2UsXG59O1xuXG5leHBvcnQgZGVmYXVsdCBSZXN1bHQ7XG4iXX0=