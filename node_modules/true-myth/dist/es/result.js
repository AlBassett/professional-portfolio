/** [[include:doc/result.md]] */
/** (keep typedoc from getting confused by the import) */
import Maybe, { isJust, just, nothing } from './maybe';
import Unit from './unit';
import { _Brand, curry1, isVoid } from './utils';
// So that it doesn't appear unused but can be exported.
_Brand; // tslint:disable-line:no-unused-expression
/**
  Discriminant for `Ok` and `Err` variants of `Result` type.

  You can use the discriminant via the `variant` property of `Result` instances
  if you need to match explicitly on it.
 */
export var Variant;
(function (Variant) {
    Variant["Ok"] = "Ok";
    Variant["Err"] = "Err";
})(Variant || (Variant = {}));
/**
  An `Ok` instance is the *successful* variant instance of the
  [`Result`](../modules/_result_.html#result) type, representing a successful
  outcome from an operation which may fail. For a full discussion, see [the
  module docs](../modules/_result_.html).

  @typeparam T The type wrapped in this `Ok` variant of `Result`.
  @typeparam E The type which would be wrapped in an `Err` variant of `Result`.
 */
export class Ok {
    /**
      Create an instance of `Result.Ok` with `new`.
  
      Note: While you *may* create the `Result` type via normal
      JavaScript class construction, it is not recommended for the functional
      style for which the library is intended. Instead, use [`Result.ok`].
  
      [`Result.ok`]: ../modules/_result_.html#ok
  
      ```ts
      // Avoid:
      const aString = new Result.Ok('characters');
  
      // Prefer:
      const aString = Result.ok('characters);
      ```
  
      Note that you may explicitly pass `Unit` to the `Ok` constructor to create
      a `Result<Unit, E>`. However, you may *not* call the `Ok` constructor with
      `null` or `undefined` to get that result (the type system won't allow you to
      construct it that way). Instead, for convenience, you can simply call
      `Result.ok()`, which will construct the type correctly.
  
      @param value
      The value to wrap in a `Result.Ok`.
  
      Note: `null` and `undefined` are allowed by the type signature so that the
      constructor may `throw` on those rather than constructing a type like
      `Result<undefined>`.
  
      @throws If you pass `null`.
     */
    constructor(value) {
        /** `Ok` is always [`Variant.Ok`](../enums/_result_.variant#ok). */
        this.variant = Variant.Ok;
        if (isVoid(value)) {
            throw new Error('Tried to construct `Ok` with `null` or `undefined`. Maybe you want `Maybe.Nothing`?');
        }
        this.value = value;
    }
    /**
      Unwrap the contained value. A convenience method for functional idioms.
  
      A common scenario where you might want to use this is in a pipeline of
      functions:
  
      ```ts
      import Result, { Ok } from 'true-myth/result';
  
      function getLengths(results: Array<Result<string, string>>): Array<number> {
        return results
          .filter(Result.isOk)
          .map(Ok.unwrap)
          .map(s => s.length);
      }
      ```
     */
    static unwrap(theOk) {
        return theOk.value;
    }
    /** Method variant for [`Result.isOk`](../modules/_result_.html#isok) */
    isOk() {
        return true;
    }
    /** Method variant for [`Result.isErr`](../modules/_result_.html#iserr) */
    isErr() {
        return false;
    }
    /** Method variant for [`Result.map`](../modules/_result_.html#map) */
    map(mapFn) {
        return map(mapFn, this);
    }
    /** Method variant for [`Result.mapOr`](../modules/_result_.html#mapor) */
    mapOr(orU, mapFn) {
        return mapOr(orU, mapFn, this);
    }
    /** Method variant for [`Result.mapOrElse`](../modules/_result_.html#maporelse) */
    mapOrElse(orElseFn, mapFn) {
        return mapOrElse(orElseFn, mapFn, this);
    }
    /** Method variant for [`Result.match`](../modules/_result_.html#match) */
    match(matcher) {
        return match(matcher, this);
    }
    /** Method variant for [`Result.mapErr`](../modules/_result_.html#maperr) */
    mapErr(mapErrFn) {
        return mapErr(mapErrFn, this);
    }
    /** Method variant for [`Result.or`](../modules/_result_.html#or) */
    or(orResult) {
        return or(orResult, this);
    }
    /** Method variant for [`Result.orElse`](../modules/_result_.html#orelse) */
    orElse(orElseFn) {
        return orElse(orElseFn, this);
    }
    /** Method variant for [`Result.and`](../modules/_result_.html#and) */
    and(mAnd) {
        return and(mAnd, this);
    }
    /** Method variant for [`Result.andThen`](../modules/_result_.html#andthen) */
    andThen(andThenFn) {
        return andThen(andThenFn, this);
    }
    /** Method variant for [`Result.chain`](../modules/_result_.html#chain) */
    chain(chainFn) {
        return chain(chainFn, this);
    }
    /** Method variant for [`Result.flatMap`](../modules/_result_.html#flatmap) */
    flatMap(flatMapFn) {
        return flatMap(flatMapFn, this);
    }
    /** Method variant for [`Result.unwrap`](../modules/_result_.html#unwrap) */
    unsafelyUnwrap() {
        return this.value;
    }
    /** Method variant for [`Result.unwrapErr`](../modules/_result_.html#unwraperr) */
    unsafelyUnwrapErr() {
        throw new Error('Tried to `unsafelyUnwrapErr` an `Ok`');
    }
    /** Method variant for [`Result.unwrapOr`](../modules/_result_.html#unwrapor) */
    unwrapOr(defaultValue) {
        return unwrapOr(defaultValue, this);
    }
    /** Method variant for [`Result.unwrapOrElse`](../modules/_result_.html#unwrapOrElse) */
    unwrapOrElse(elseFn) {
        return unwrapOrElse(elseFn, this);
    }
    /** Method variant for [`Result.toMaybe`](../modules/_result_.html#tomaybe) */
    toMaybe() {
        return toMaybe(this);
    }
    /** Method variant for [`Result.toString`](../modules/_result_.html#tostring) */
    toString() {
        return toString(this);
    }
    /** Method variant for [`Result.equals`](../modules/_result_.html#equals) */
    equals(comparison) {
        return equals(comparison, this);
    }
    /** Method variant for [`Result.ap`](../modules/_result_.html#ap) */
    ap(r) {
        return ap(this, r);
    }
}
/**
  An `Err` instance is the *failure* variant instance of the
  [`Result`](../modules/_result_.html#result) type, representing a failure
  outcome from an operation which may fail. For a full discussion, see [the
  module docs](../modules/_result_.html).

  @typeparam T The type which would be wrapped in an `Ok` variant of `Result`.
  @typeparam E The type wrapped in this `Err` variant of `Result`.
  */
export class Err {
    /**
      Create an instance of `Result.Err` with `new`.
  
      Note: While you *may* create the `Result` type via normal
      JavaScript class construction, it is not recommended for the functional
      style for which the library is intended. Instead, use [`Result.err`].
  
      [`Result.err`]: ../modules/_result_.html#err
  
      ```ts
      // Avoid:
      const anErr = new Result.Err('alas, failure');
  
      // Prefer:
      const anErr = Result.err('alas, failure');
      ```
  
      Note that you may explicitly pass `Unit` to the `Err` constructor to create
      a `Result<T, Unit>`. However, you may *not* call the `Err` constructor with
      `null` or `undefined` to get that result (the type system won't allow you to
      construct it that way). Instead, for convenience, you can simply call
      `Result.err()`, which will construct the type correctly.
  
      @param error
      The value to wrap in a `Result.Err`.
  
      `Note: null` and `undefined` are allowed by the type signature so that the
      constructor may `throw` on those rather than constructing a type like
      `Result<number, undefined>`.
  
      @throws If you pass `null` or `undefined`.
     */
    constructor(error) {
        /** `Err` is always [`Variant.Err`](../enums/_result_.variant#err). */
        this.variant = Variant.Err;
        if (isVoid(error)) {
            throw new Error('Tried to construct `Err` with `null` or `undefined`. Maybe you want `Maybe.Nothing`?');
        }
        this.error = error;
    }
    /**
      Unwrap the contained error . A convenience method for functional idioms.
  
      A common scenario where you might want to use this is in a pipeline of
      functions:
  
      ```ts
      import Result, { Ok } from 'true-myth/result';
  
      function getMessages(results: Array<Result<string, Error>>): Array<number> {
        return maybeStrings
          .filter(Result.isErr)
          .map(Err.unwrapErr)
          .map(e => e.message);
      }
      ```
     */
    static unwrapErr(theErr) {
        return theErr.error;
    }
    /** Method variant for [`Result.isOk`](../modules/_result_.html#isok) */
    isOk() {
        return false;
    }
    /** Method variant for [`Result.isErr`](../modules/_result_.html#iserr) */
    isErr() {
        return true;
    }
    /** Method variant for [`Result.map`](../modules/_result_.html#map) */
    map(mapFn) {
        return map(mapFn, this);
    }
    /** Method variant for [`Result.mapOr`](../modules/_result_.html#mapor) */
    mapOr(orU, mapFn) {
        return mapOr(orU, mapFn, this);
    }
    /** Method variant for [`Result.mapOrElse`](../modules/_result_.html#maporelse) */
    mapOrElse(orElseFn, mapFn) {
        return mapOrElse(orElseFn, mapFn, this);
    }
    /** Method variant for [`Result.match`](../modules/_result_.html#match) */
    match(matchObj) {
        return match(matchObj, this);
    }
    /** Method variant for [`Result.mapErr`](../modules/_result_.html#maperr) */
    mapErr(mapErrFn) {
        return mapErr(mapErrFn, this);
    }
    /** Method variant for [`Result.or`](../modules/_result_.html#or) */
    or(orResult) {
        return or(orResult, this);
    }
    /** Method variant for [`Result.orElse`](../modules/_result_.html#orelse) */
    orElse(orElseFn) {
        return orElse(orElseFn, this);
    }
    /** Method variant for [`Result.and`](../modules/_result_.html#and) */
    and(mAnd) {
        return and(mAnd, this);
    }
    /** Method variant for [`Result.andThen`](../modules/_result_.html#andthen) */
    andThen(andThenFn) {
        return andThen(andThenFn, this);
    }
    /** Method variant for [`Result.chain`](../modules/_result_.html#chain) */
    chain(chainFn) {
        return this.andThen(chainFn);
    }
    /** Method variant for [`Result.flatMap`](../modules/_result_.html#flatmap) */
    flatMap(flatMapFn) {
        return this.andThen(flatMapFn);
    }
    /** Method variant for [`Result.unsafelyUnwrap`](../modules/_result_.html#unsafelyunwrap) */
    unsafelyUnwrap() {
        throw new Error('Tried to `unsafelyUnwrap an Err`');
    }
    /** Method variant for [`Result.unsafelyUnwrapErr`](../modules/_result_.html#unsafelyunwraperr) */
    unsafelyUnwrapErr() {
        return this.error;
    }
    /** Method variant for [`Result.unwrapOr`](../modules/_result_.html#unwrapor) */
    unwrapOr(defaultValue) {
        return unwrapOr(defaultValue, this);
    }
    /** Method variant for [`Result.unwrapOrElse`](../modules/_result_.html#unwraporelse) */
    unwrapOrElse(elseFn) {
        return unwrapOrElse(elseFn, this);
    }
    /** Method variant for [`Result.toMaybe`](../modules/_result_.html#tomaybe) */
    toMaybe() {
        return toMaybe(this);
    }
    /** Method variant for [`Result.toString`](../modules/_result_.html#tostring) */
    toString() {
        return toString(this);
    }
    /** Method variant for [`Result.equals`](../modules/_result_.html#equals) */
    equals(comparison) {
        return equals(comparison, this);
    }
    /** Method variant for [`Result.ap`](../modules/_result_.html#ap) */
    ap(r) {
        return ap(this, r);
    }
}
/**
  Is this `Result` an `Ok` instance?

  In TypeScript, narrows the type from `Result<T, E>` to `Ok<T, E>`.
 */
export function isOk(result) {
    return result.variant === Variant.Ok;
}
/**
  Is this `Result` an `Err` instance?

  In TypeScript, narrows the type from `Result<T, E>` to `Err<T, E>`.
 */
export function isErr(result) {
    return result.variant === Variant.Err;
}
export function ok(value) {
    return value === undefined ? new Ok(Unit) : new Ok(value);
}
/** `Result.of` is an alias for `Result.ok`. */
export const of = ok;
export function err(error) {
    return isVoid(error) ? new Err(Unit) : new Err(error);
}
export function map(mapFn, result) {
    const op = (r) => (isOk(r) ? ok(mapFn(r.value)) : r);
    return curry1(op, result);
}
export function mapOr(orU, mapFn, result) {
    function fullOp(fn, r) {
        return isOk(r) ? fn(r.value) : orU;
    }
    function partialOp(fn, curriedResult) {
        return curriedResult !== undefined
            ? fullOp(fn, curriedResult)
            : (extraCurriedResult) => fullOp(fn, extraCurriedResult);
    }
    return mapFn === undefined
        ? partialOp
        : result === undefined
            ? partialOp(mapFn)
            : partialOp(mapFn, result);
}
export function mapOrElse(orElseFn, mapFn, result) {
    function fullOp(fn, r) {
        return isOk(r) ? fn(r.value) : orElseFn(r.error);
    }
    function partialOp(fn, curriedResult) {
        return curriedResult !== undefined
            ? fullOp(fn, curriedResult)
            : (extraCurriedResult) => fullOp(fn, extraCurriedResult);
    }
    return mapFn === undefined
        ? partialOp
        : result === undefined
            ? partialOp(mapFn)
            : partialOp(mapFn, result);
}
export function mapErr(mapErrFn, result) {
    const op = (r) => (isOk(r) ? r : err(mapErrFn(r.error)));
    return curry1(op, result);
}
export function and(andResult, result) {
    const op = (r) => (isOk(r) ? andResult : r);
    return curry1(op, result);
}
export function andThen(thenFn, result) {
    const op = (r) => (isOk(r) ? thenFn(r.value) : r);
    return curry1(op, result);
}
/** Alias for [`andThen`](#andthen). */
export const chain = andThen;
/** Alias for [`andThen`](#andthen). */
export const flatMap = andThen;
export function or(defaultResult, result) {
    const op = (r) => (isOk(r) ? r : defaultResult);
    return curry1(op, result);
}
export function orElse(elseFn, result) {
    const op = (r) => (isOk(r) ? r : elseFn(r.unsafelyUnwrapErr()));
    return curry1(op, result);
}
/**
  Get the value out of the `Result`.

  Returns the content of an `Ok`, but **throws if the `Result` is `Err`.**
  Prefer to use [`unwrapOr`](#unwrapor) or [`unwrapOrElse`](#unwraporelse).

  @throws If the `Result` instance is `Nothing`.
 */
export function unsafelyUnwrap(result) {
    return result.unsafelyUnwrap();
}
/** Alias for [`unsafelyUnwrap`](#unsafelyunwrap) */
export const unsafelyGet = unsafelyUnwrap;
/** Alias for [`unsafelyUnwrap`](#unsafelyunwrap) */
export const unsafeGet = unsafelyUnwrap;
/**
  Get the error value out of the [`Result`](#result).

  Returns the content of an `Err`, but **throws if the `Result` is `Ok`**.
  Prefer to use [`unwrapOrElse`](#unwraporelse).

  @param result
  @throws Error If the `Result` instance is `Nothing`.
 */
export function unsafelyUnwrapErr(result) {
    return result.unsafelyUnwrapErr();
}
/** Alias for [`unsafelyUnwrapErr`](#unsafelyunwraperr) */
export const unsafelyGetErr = unsafelyUnwrapErr;
export function unwrapOr(defaultValue, result) {
    const op = (r) => (isOk(r) ? r.value : defaultValue);
    return curry1(op, result);
}
/** Alias for [`unwrapOr`](#unwrapor) */
export const getOr = unwrapOr;
export function unwrapOrElse(orElseFn, result) {
    const op = (r) => (isOk(r) ? r.value : orElseFn(r.error));
    return curry1(op, result);
}
/** Alias for [`unwrapOrElse`](#unwraporelse) */
export const getOrElse = unwrapOrElse;
/**
  Convert a [`Result`](#result) to a [`Maybe`](../modules/_maybe_.html#maybe).

  The converted type will be [`Just`] if the `Result` is [`Ok`] or [`Nothing`]
  if the `Result` is [`Err`]; the wrapped error value will be discarded.

  [`Just`]: ../classes/_maybe_.just.html
  [`Nothing`]: ../classes/_maybe_.nothing.html
  [`Ok`]: ../classes/_result_.ok.html
  [`Err`]: ../classes/_result_.err.html

  @param result The `Result` to convert to a `Maybe`
  @returns      `Just` the value in `result` if it is `Ok`; otherwise `Nothing`
 */
export function toMaybe(result) {
    return isOk(result) ? just(result.value) : nothing();
}
export function fromMaybe(errValue, maybe) {
    const op = (m) => (isJust(m) ? ok(Maybe.unsafelyUnwrap(m)) : err(errValue));
    return curry1(op, maybe);
}
/**
  Create a `String` representation of a `result` instance.

  An `Ok` instance will be printed as `Ok(<representation of the value>)`, and
  an `Err` instance will be printed as `Err(<representation of the error>)`,
  where the representation of the value or error is simply the value or error's
  own `toString` representation. For example:

                call                |         output
  --------------------------------- | ----------------------
  `toString(ok(42))`                | `Ok(42)`
  `toString(ok([1, 2, 3]))`         | `Ok(1,2,3)`
  `toString(ok({ an: 'object' }))`  | `Ok([object Object])`n
  `toString(err(42))`               | `Err(42)`
  `toString(err([1, 2, 3]))`        | `Err(1,2,3)`
  `toString(err({ an: 'object' }))` | `Err([object Object])`

  @typeparam T The type of the wrapped value; its own `.toString` will be used
               to print the interior contents of the `Just` variant.
  @param maybe The value to convert to a string.
  @returns     The string representation of the `Maybe`.
 */
export const toString = (result) => {
    const body = (isOk(result) ? result.value : result.error).toString();
    return `${result.variant.toString()}(${body})`;
};
export function match(matcher, result) {
    const op = (r) => mapOrElse(matcher.Err, matcher.Ok, r);
    return curry1(op, result);
}
/** Alias for [`match`](#match) */
export const cata = match;
export function equals(resultB, resultA) {
    return resultA !== undefined
        ? resultA.match({
            Err: () => isErr(resultB),
            Ok: a => isOk(resultB) && resultB.unsafelyUnwrap() === a,
        })
        : (curriedResultA) => curriedResultA.match({
            Err: () => isErr(resultB),
            Ok: a => isOk(resultB) && resultB.unsafelyUnwrap() === a,
        });
}
export function ap(resultFn, result) {
    const op = (r) => r.match({
        Ok: val => resultFn.map(fn => fn(val)),
        Err: e => Result.err(e),
    });
    return curry1(op, result);
}
/**
  Determine whether an item is an instance of `Just` or `Nothing`.

  @param item The item to check.
 */
export function isInstance(item) {
    return item instanceof Ok || item instanceof Err;
}
export const Result = {
    Variant,
    Ok,
    Err,
    isOk,
    isErr,
    ok,
    err,
    map,
    mapOr,
    mapOrElse,
    mapErr,
    and,
    andThen,
    chain,
    flatMap,
    or,
    orElse,
    unsafelyUnwrap,
    unsafelyGet,
    unsafeGet,
    unsafelyUnwrapErr,
    unsafelyGetErr,
    unwrapOr,
    getOr,
    unwrapOrElse,
    getOrElse,
    toMaybe,
    fromMaybe,
    toString,
    match,
    cata,
    equals,
    ap,
    isInstance,
};
export default Result;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzdWx0LmpzIiwic291cmNlUm9vdCI6Ii4vIiwic291cmNlcyI6WyJyZXN1bHQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsZ0NBQWdDO0FBRWhDLHlEQUF5RDtBQUN6RCxPQUFPLEtBQUssRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQ3ZELE9BQU8sSUFBSSxNQUFNLFFBQVEsQ0FBQztBQUMxQixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFFakQsd0RBQXdEO0FBQ3hELE1BQU0sQ0FBQyxDQUFDLDJDQUEyQztBQUVuRDs7Ozs7R0FLRztBQUNILE1BQU0sQ0FBTixJQUFZLE9BR1g7QUFIRCxXQUFZLE9BQU87SUFDakIsb0JBQVMsQ0FBQTtJQUNULHNCQUFXLENBQUE7QUFDYixDQUFDLEVBSFcsT0FBTyxLQUFQLE9BQU8sUUFHbEI7QUF1RUQ7Ozs7Ozs7O0dBUUc7QUFDSCxNQUFNLE9BQU8sRUFBRTtJQTRCYjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztPQStCRztJQUNILFlBQVksS0FBZ0I7UUF0QzVCLG1FQUFtRTtRQUMxRCxZQUFPLEdBQWUsT0FBTyxDQUFDLEVBQUUsQ0FBQztRQXNDeEMsSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDakIsTUFBTSxJQUFJLEtBQUssQ0FDYixxRkFBcUYsQ0FDdEYsQ0FBQztTQUNIO1FBRUQsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7SUFDckIsQ0FBQztJQW5FRDs7Ozs7Ozs7Ozs7Ozs7OztPQWdCRztJQUNILE1BQU0sQ0FBQyxNQUFNLENBQUksS0FBaUI7UUFDaEMsT0FBTyxLQUFLLENBQUMsS0FBSyxDQUFDO0lBQ3JCLENBQUM7SUFrREQsd0VBQXdFO0lBQ3hFLElBQUk7UUFDRixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCwwRUFBMEU7SUFDMUUs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QyxFQUFFLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3RDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQU8sQ0FBQyxDQUFDO0tBQzlCLENBQUMsQ0FBQztJQUVMLE9BQU8sTUFBTSxDQUFDLEVBQUUsRUFBRSxNQUFNLENBQUMsQ0FBQztBQUM1QixDQUFDO0FBRUQ7Ozs7R0FJRztBQUNILE1BQU0sVUFBVSxVQUFVLENBQW1CLElBQVM7SUFDcEQsT0FBTyxJQUFJLFlBQVksRUFBRSxJQUFJLElBQUksWUFBWSxHQUFHLENBQUM7QUFDbkQsQ0FBQztBQVNELE1BQU0sQ0FBQyxNQUFNLE1BQU0sR0FBRztJQUNwQixPQUFPO0lBQ1AsRUFBRTtJQUNGLEdBQUc7SUFDSCxJQUFJO0lBQ0osS0FBSztJQUNMLEVBQUU7SUFDRixHQUFHO0lBQ0gsR0FBRztJQUNILEtBQUs7SUFDTCxTQUFTO0lBQ1QsTUFBTTtJQUNOLEdBQUc7SUFDSCxPQUFPO0lBQ1AsS0FBSztJQUNMLE9BQU87SUFDUCxFQUFFO0lBQ0YsTUFBTTtJQUNOLGNBQWM7SUFDZCxXQUFXO0lBQ1gsU0FBUztJQUNULGlCQUFpQjtJQUNqQixjQUFjO0lBQ2QsUUFBUTtJQUNSLEtBQUs7SUFDTCxZQUFZO0lBQ1osU0FBUztJQUNULE9BQU87SUFDUCxTQUFTO0lBQ1QsUUFBUTtJQUNSLEtBQUs7SUFDTCxJQUFJO0lBQ0osTUFBTTtJQUNOLEVBQUU7SUFDRixVQUFVO0NBQ1gsQ0FBQztBQUVGLGVBQWUsTUFBTSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqIFtbaW5jbHVkZTpkb2MvcmVzdWx0Lm1kXV0gKi9cblxuLyoqIChrZWVwIHR5cGVkb2MgZnJvbSBnZXR0aW5nIGNvbmZ1c2VkIGJ5IHRoZSBpbXBvcnQpICovXG5pbXBvcnQgTWF5YmUsIHsgaXNKdXN0LCBqdXN0LCBub3RoaW5nIH0gZnJvbSAnLi9tYXliZSc7XG5pbXBvcnQgVW5pdCBmcm9tICcuL3VuaXQnO1xuaW1wb3J0IHsgX0JyYW5kLCBjdXJyeTEsIGlzVm9pZCB9IGZyb20gJy4vdXRpbHMnO1xuXG4vLyBTbyB0aGF0IGl0IGRvZXNuJ3QgYXBwZWFyIHVudXNlZCBidXQgY2FuIGJlIGV4cG9ydGVkLlxuX0JyYW5kOyAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lOm5vLXVudXNlZC1leHByZXNzaW9uXG5cbi8qKlxuICBEaXNjcmltaW5hbnQgZm9yIGBPa2AgYW5kIGBFcnJgIHZhcmlhbnRzIG9mIGBSZXN1bHRgIHR5cGUuXG5cbiAgWW91IGNhbiB1c2UgdGhlIGRpc2NyaW1pbmFudCB2aWEgdGhlIGB2YXJpYW50YCBwcm9wZXJ0eSBvZiBgUmVzdWx0YCBpbnN0YW5jZXNcbiAgaWYgeW91IG5lZWQgdG8gbWF0Y2ggZXhwbGljaXRseSBvbiBpdC5cbiAqL1xuZXhwb3J0IGVudW0gVmFyaWFudCB7XG4gIE9rID0gJ09rJyxcbiAgRXJyID0gJ0VycicsXG59XG5cbi8qKiBTaW1wbHkgZGVmaW5lcyB0aGUgY29tbW9uIHNoYXBlIGZvciBgT2tgIGFuZCBgRXJyYC4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUmVzdWx0U2hhcGU8VCwgRT4ge1xuICAvKiogRGlzdGluZ3Vpc2ggYmV0d2VlbiB0aGUgYE9rYCBhbmQgYEVycmAgdmFyaWFudHMuICovXG4gIHJlYWRvbmx5IHZhcmlhbnQ6IFZhcmlhbnQ7XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5pc09rYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI2lzb2spICovXG4gIGlzT2sodGhpczogUmVzdWx0PFQsIEU+KTogdGhpcyBpcyBPazxULCBFPjtcblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LmlzRXJyYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI2lzZXJyKSAqL1xuICBpc0Vycih0aGlzOiBSZXN1bHQ8VCwgRT4pOiB0aGlzIGlzIEVycjxULCBFPjtcblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0Lm1hcGBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNtYXApICovXG4gIG1hcDxVPih0aGlzOiBSZXN1bHQ8VCwgRT4sIG1hcEZuOiAodDogVCkgPT4gVSk6IFJlc3VsdDxVLCBFPjtcblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0Lm1hcE9yYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI21hcG9yKSAqL1xuICBtYXBPcjxVPih0aGlzOiBSZXN1bHQ8VCwgRT4sIG9yVTogVSwgbWFwRm46ICh0OiBUKSA9PiBVKTogVTtcblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0Lm1hcE9yRWxzZWBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNtYXBvcmVsc2UpICovXG4gIG1hcE9yRWxzZTxVPih0aGlzOiBSZXN1bHQ8VCwgRT4sIG9yRWxzZUZuOiAoZXJyOiBFKSA9PiBVLCBtYXBGbjogKHQ6IFQpID0+IFUpOiBVO1xuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQubWF0Y2hgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjbWF0Y2gpICovXG4gIG1hdGNoPFU+KHRoaXM6IFJlc3VsdDxULCBFPiwgbWF0Y2hlcjogTWF0Y2hlcjxULCBFLCBVPik6IFU7XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5tYXBFcnJgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjbWFwZXJyKSAqL1xuICBtYXBFcnI8Rj4odGhpczogUmVzdWx0PFQsIEU+LCBtYXBFcnJGbjogKGU6IEUpID0+IEYpOiBSZXN1bHQ8VCwgRj47XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5vcmBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNvcikgKi9cbiAgb3I8Rj4odGhpczogUmVzdWx0PFQsIEU+LCBvclJlc3VsdDogUmVzdWx0PFQsIEY+KTogUmVzdWx0PFQsIEY+O1xuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQub3JFbHNlYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI29yZWxzZSkgKi9cbiAgb3JFbHNlPEY+KHRoaXM6IFJlc3VsdDxULCBFPiwgb3JFbHNlRm46IChlcnI6IEUpID0+IFJlc3VsdDxULCBGPik6IFJlc3VsdDxULCBGPjtcblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LmFuZGBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNhbmQpICovXG4gIGFuZDxVPih0aGlzOiBSZXN1bHQ8VCwgRT4sIG1BbmQ6IFJlc3VsdDxVLCBFPik6IFJlc3VsdDxVLCBFPjtcblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LmFuZFRoZW5gXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjYW5kdGhlbikgKi9cbiAgYW5kVGhlbjxVPih0aGlzOiBSZXN1bHQ8VCwgRT4sIGFuZFRoZW5GbjogKHQ6IFQpID0+IFJlc3VsdDxVLCBFPik6IFJlc3VsdDxVLCBFPjtcblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LmNoYWluYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI2NoYWluKSAqL1xuICBjaGFpbjxVPih0aGlzOiBSZXN1bHQ8VCwgRT4sIGNoYWluRm46ICh0OiBUKSA9PiBSZXN1bHQ8VSwgRT4pOiBSZXN1bHQ8VSwgRT47XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5mbGF0TWFwYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI2ZsYXRtYXApICovXG4gIGZsYXRNYXA8VT4odGhpczogUmVzdWx0PFQsIEU+LCBjaGFpbkZuOiAodDogVCkgPT4gUmVzdWx0PFUsIEU+KTogUmVzdWx0PFUsIEU+O1xuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQudW53cmFwYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI3Vud3JhcCkgKi9cbiAgdW5zYWZlbHlVbndyYXAoKTogVCB8IG5ldmVyO1xuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQudW53cmFwRXJyYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI3Vud3JhcGVycikgKi9cbiAgdW5zYWZlbHlVbndyYXBFcnIoKTogRSB8IG5ldmVyO1xuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQudW53cmFwT3JgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjdW53cmFwb3IpICovXG4gIHVud3JhcE9yKHRoaXM6IFJlc3VsdDxULCBFPiwgZGVmYXVsdFZhbHVlOiBUKTogVDtcblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LnVud3JhcE9yRWxzZWBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCN1bndyYXBPckVsc2UpICovXG4gIHVud3JhcE9yRWxzZSh0aGlzOiBSZXN1bHQ8VCwgRT4sIGVsc2VGbjogKGVycm9yOiBFKSA9PiBUKTogVDtcblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LnRvTWF5YmVgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjdG9tYXliZSkgKi9cbiAgdG9NYXliZSh0aGlzOiBSZXN1bHQ8VCwgRT4pOiBNYXliZTxUPjtcblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LnRvU3RyaW5nYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI3Rvc3RyaW5nKSAqL1xuICB0b1N0cmluZyh0aGlzOiBSZXN1bHQ8VCwgRT4pOiBzdHJpbmc7XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5lcXVhbHNgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjZXF1YWxzKSAqL1xuICBlcXVhbHModGhpczogUmVzdWx0PFQsIEU+LCBjb21wYXJpc29uOiBSZXN1bHQ8VCwgRT4pOiBib29sZWFuO1xuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQuYXBgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjYXApICovXG4gIGFwPEEsIEI+KHRoaXM6IFJlc3VsdDwoYTogQSkgPT4gQiwgRT4sIHI6IFJlc3VsdDxBLCBFPik6IFJlc3VsdDxCLCBFPjtcbn1cblxuLyoqXG4gIEFuIGBPa2AgaW5zdGFuY2UgaXMgdGhlICpzdWNjZXNzZnVsKiB2YXJpYW50IGluc3RhbmNlIG9mIHRoZVxuICBbYFJlc3VsdGBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNyZXN1bHQpIHR5cGUsIHJlcHJlc2VudGluZyBhIHN1Y2Nlc3NmdWxcbiAgb3V0Y29tZSBmcm9tIGFuIG9wZXJhdGlvbiB3aGljaCBtYXkgZmFpbC4gRm9yIGEgZnVsbCBkaXNjdXNzaW9uLCBzZWUgW3RoZVxuICBtb2R1bGUgZG9jc10oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sKS5cblxuICBAdHlwZXBhcmFtIFQgVGhlIHR5cGUgd3JhcHBlZCBpbiB0aGlzIGBPa2AgdmFyaWFudCBvZiBgUmVzdWx0YC5cbiAgQHR5cGVwYXJhbSBFIFRoZSB0eXBlIHdoaWNoIHdvdWxkIGJlIHdyYXBwZWQgaW4gYW4gYEVycmAgdmFyaWFudCBvZiBgUmVzdWx0YC5cbiAqL1xuZXhwb3J0IGNsYXNzIE9rPFQsIEU+IGltcGxlbWVudHMgUmVzdWx0U2hhcGU8VCwgRT4ge1xuICAvKipcbiAgICBVbndyYXAgdGhlIGNvbnRhaW5lZCB2YWx1ZS4gQSBjb252ZW5pZW5jZSBtZXRob2QgZm9yIGZ1bmN0aW9uYWwgaWRpb21zLlxuXG4gICAgQSBjb21tb24gc2NlbmFyaW8gd2hlcmUgeW91IG1pZ2h0IHdhbnQgdG8gdXNlIHRoaXMgaXMgaW4gYSBwaXBlbGluZSBvZlxuICAgIGZ1bmN0aW9uczpcblxuICAgIGBgYHRzXG4gICAgaW1wb3J0IFJlc3VsdCwgeyBPayB9IGZyb20gJ3RydWUtbXl0aC9yZXN1bHQnO1xuXG4gICAgZnVuY3Rpb24gZ2V0TGVuZ3RocyhyZXN1bHRzOiBBcnJheTxSZXN1bHQ8c3RyaW5nLCBzdHJpbmc+Pik6IEFycmF5PG51bWJlcj4ge1xuICAgICAgcmV0dXJuIHJlc3VsdHNcbiAgICAgICAgLmZpbHRlcihSZXN1bHQuaXNPaylcbiAgICAgICAgLm1hcChPay51bndyYXApXG4gICAgICAgIC5tYXAocyA9PiBzLmxlbmd0aCk7XG4gICAgfVxuICAgIGBgYFxuICAgKi9cbiAgc3RhdGljIHVud3JhcDxPPih0aGVPazogT2s8TywgYW55Pik6IE8ge1xuICAgIHJldHVybiB0aGVPay52YWx1ZTtcbiAgfVxuXG4gIC8qKiBgT2tgIGlzIGFsd2F5cyBbYFZhcmlhbnQuT2tgXSguLi9lbnVtcy9fcmVzdWx0Xy52YXJpYW50I29rKS4gKi9cbiAgcmVhZG9ubHkgdmFyaWFudDogVmFyaWFudC5PayA9IFZhcmlhbnQuT2s7XG5cbiAgLyoqIFRoZSB3cmFwcGVkIHZhbHVlLiAqL1xuICByZWFkb25seSB2YWx1ZTogVDtcblxuICAvKipcbiAgICBDcmVhdGUgYW4gaW5zdGFuY2Ugb2YgYFJlc3VsdC5Pa2Agd2l0aCBgbmV3YC5cblxuICAgIE5vdGU6IFdoaWxlIHlvdSAqbWF5KiBjcmVhdGUgdGhlIGBSZXN1bHRgIHR5cGUgdmlhIG5vcm1hbFxuICAgIEphdmFTY3JpcHQgY2xhc3MgY29uc3RydWN0aW9uLCBpdCBpcyBub3QgcmVjb21tZW5kZWQgZm9yIHRoZSBmdW5jdGlvbmFsXG4gICAgc3R5bGUgZm9yIHdoaWNoIHRoZSBsaWJyYXJ5IGlzIGludGVuZGVkLiBJbnN0ZWFkLCB1c2UgW2BSZXN1bHQub2tgXS5cblxuICAgIFtgUmVzdWx0Lm9rYF06IC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNva1xuXG4gICAgYGBgdHNcbiAgICAvLyBBdm9pZDpcbiAgICBjb25zdCBhU3RyaW5nID0gbmV3IFJlc3VsdC5PaygnY2hhcmFjdGVycycpO1xuXG4gICAgLy8gUHJlZmVyOlxuICAgIGNvbnN0IGFTdHJpbmcgPSBSZXN1bHQub2soJ2NoYXJhY3RlcnMpO1xuICAgIGBgYFxuXG4gICAgTm90ZSB0aGF0IHlvdSBtYXkgZXhwbGljaXRseSBwYXNzIGBVbml0YCB0byB0aGUgYE9rYCBjb25zdHJ1Y3RvciB0byBjcmVhdGVcbiAgICBhIGBSZXN1bHQ8VW5pdCwgRT5gLiBIb3dldmVyLCB5b3UgbWF5ICpub3QqIGNhbGwgdGhlIGBPa2AgY29uc3RydWN0b3Igd2l0aFxuICAgIGBudWxsYCBvciBgdW5kZWZpbmVkYCB0byBnZXQgdGhhdCByZXN1bHQgKHRoZSB0eXBlIHN5c3RlbSB3b24ndCBhbGxvdyB5b3UgdG9cbiAgICBjb25zdHJ1Y3QgaXQgdGhhdCB3YXkpLiBJbnN0ZWFkLCBmb3IgY29udmVuaWVuY2UsIHlvdSBjYW4gc2ltcGx5IGNhbGxcbiAgICBgUmVzdWx0Lm9rKClgLCB3aGljaCB3aWxsIGNvbnN0cnVjdCB0aGUgdHlwZSBjb3JyZWN0bHkuXG5cbiAgICBAcGFyYW0gdmFsdWVcbiAgICBUaGUgdmFsdWUgdG8gd3JhcCBpbiBhIGBSZXN1bHQuT2tgLlxuXG4gICAgTm90ZTogYG51bGxgIGFuZCBgdW5kZWZpbmVkYCBhcmUgYWxsb3dlZCBieSB0aGUgdHlwZSBzaWduYXR1cmUgc28gdGhhdCB0aGVcbiAgICBjb25zdHJ1Y3RvciBtYXkgYHRocm93YCBvbiB0aG9zZSByYXRoZXIgdGhhbiBjb25zdHJ1Y3RpbmcgYSB0eXBlIGxpa2VcbiAgICBgUmVzdWx0PHVuZGVmaW5lZD5gLlxuXG4gICAgQHRocm93cyBJZiB5b3UgcGFzcyBgbnVsbGAuXG4gICAqL1xuICBjb25zdHJ1Y3Rvcih2YWx1ZT86IFQgfCBudWxsKSB7XG4gICAgaWYgKGlzVm9pZCh2YWx1ZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ1RyaWVkIHRvIGNvbnN0cnVjdCBgT2tgIHdpdGggYG51bGxgIG9yIGB1bmRlZmluZWRgLiBNYXliZSB5b3Ugd2FudCBgTWF5YmUuTm90aGluZ2A/J1xuICAgICAgKTtcbiAgICB9XG5cbiAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LmlzT2tgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjaXNvaykgKi9cbiAgaXNPayh0aGlzOiBSZXN1bHQ8VCwgRT4pOiB0aGlzIGlzIE9rPFQsIEU+IHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQuaXNFcnJgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjaXNlcnIpICovXG4gIGlzRXJyKHRoaXM6IFJlc3VsdDxULCBFPik6IHRoaXMgaXMgRXJyPFQsIEU+IHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0Lm1hcGBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNtYXApICovXG4gIG1hcDxVPih0aGlzOiBSZXN1bHQ8VCwgRT4sIG1hcEZuOiAodDogVCkgPT4gVSk6IFJlc3VsdDxVLCBFPiB7XG4gICAgcmV0dXJuIG1hcChtYXBGbiwgdGhpcyk7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0Lm1hcE9yYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI21hcG9yKSAqL1xuICBtYXBPcjxVPih0aGlzOiBSZXN1bHQ8VCwgRT4sIG9yVTogVSwgbWFwRm46ICh0OiBUKSA9PiBVKTogVSB7XG4gICAgcmV0dXJuIG1hcE9yKG9yVSwgbWFwRm4sIHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5tYXBPckVsc2VgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjbWFwb3JlbHNlKSAqL1xuICBtYXBPckVsc2U8VT4odGhpczogUmVzdWx0PFQsIEU+LCBvckVsc2VGbjogKGVycjogRSkgPT4gVSwgbWFwRm46ICh0OiBUKSA9PiBVKTogVSB7XG4gICAgcmV0dXJuIG1hcE9yRWxzZShvckVsc2VGbiwgbWFwRm4sIHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5tYXRjaGBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNtYXRjaCkgKi9cbiAgbWF0Y2g8VT4odGhpczogUmVzdWx0PFQsIEU+LCBtYXRjaGVyOiBNYXRjaGVyPFQsIEUsIFU+KTogVSB7XG4gICAgcmV0dXJuIG1hdGNoKG1hdGNoZXIsIHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5tYXBFcnJgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjbWFwZXJyKSAqL1xuICBtYXBFcnI8Rj4odGhpczogUmVzdWx0PFQsIEU+LCBtYXBFcnJGbjogKGU6IEUpID0+IEYpOiBSZXN1bHQ8VCwgRj4ge1xuICAgIHJldHVybiBtYXBFcnIobWFwRXJyRm4sIHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5vcmBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNvcikgKi9cbiAgb3I8Rj4odGhpczogUmVzdWx0PFQsIEU+LCBvclJlc3VsdDogUmVzdWx0PFQsIEY+KTogUmVzdWx0PFQsIEY+IHtcbiAgICByZXR1cm4gb3Iob3JSZXN1bHQsIHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5vckVsc2VgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjb3JlbHNlKSAqL1xuICBvckVsc2U8Rj4odGhpczogUmVzdWx0PFQsIEU+LCBvckVsc2VGbjogKGVycjogRSkgPT4gUmVzdWx0PFQsIEY+KTogUmVzdWx0PFQsIEY+IHtcbiAgICByZXR1cm4gb3JFbHNlKG9yRWxzZUZuLCB0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQuYW5kYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI2FuZCkgKi9cbiAgYW5kPFU+KHRoaXM6IFJlc3VsdDxULCBFPiwgbUFuZDogUmVzdWx0PFUsIEU+KTogUmVzdWx0PFUsIEU+IHtcbiAgICByZXR1cm4gYW5kKG1BbmQsIHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5hbmRUaGVuYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI2FuZHRoZW4pICovXG4gIGFuZFRoZW48VT4odGhpczogUmVzdWx0PFQsIEU+LCBhbmRUaGVuRm46ICh0OiBUKSA9PiBSZXN1bHQ8VSwgRT4pOiBSZXN1bHQ8VSwgRT4ge1xuICAgIHJldHVybiBhbmRUaGVuKGFuZFRoZW5GbiwgdGhpcyk7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LmNoYWluYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI2NoYWluKSAqL1xuICBjaGFpbjxVPih0aGlzOiBSZXN1bHQ8VCwgRT4sIGNoYWluRm46ICh0OiBUKSA9PiBSZXN1bHQ8VSwgRT4pOiBSZXN1bHQ8VSwgRT4ge1xuICAgIHJldHVybiBjaGFpbihjaGFpbkZuLCB0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQuZmxhdE1hcGBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNmbGF0bWFwKSAqL1xuICBmbGF0TWFwPFU+KHRoaXM6IFJlc3VsdDxULCBFPiwgZmxhdE1hcEZuOiAodDogVCkgPT4gUmVzdWx0PFUsIEU+KTogUmVzdWx0PFUsIEU+IHtcbiAgICByZXR1cm4gZmxhdE1hcChmbGF0TWFwRm4sIHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC51bndyYXBgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjdW53cmFwKSAqL1xuICB1bnNhZmVseVVud3JhcCgpOiBUIHtcbiAgICByZXR1cm4gdGhpcy52YWx1ZTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQudW53cmFwRXJyYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI3Vud3JhcGVycikgKi9cbiAgdW5zYWZlbHlVbndyYXBFcnIoKTogbmV2ZXIge1xuICAgIHRocm93IG5ldyBFcnJvcignVHJpZWQgdG8gYHVuc2FmZWx5VW53cmFwRXJyYCBhbiBgT2tgJyk7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LnVud3JhcE9yYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI3Vud3JhcG9yKSAqL1xuICB1bndyYXBPcih0aGlzOiBSZXN1bHQ8VCwgRT4sIGRlZmF1bHRWYWx1ZTogVCk6IFQge1xuICAgIHJldHVybiB1bndyYXBPcihkZWZhdWx0VmFsdWUsIHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC51bndyYXBPckVsc2VgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjdW53cmFwT3JFbHNlKSAqL1xuICB1bndyYXBPckVsc2UodGhpczogUmVzdWx0PFQsIEU+LCBlbHNlRm46IChlcnJvcjogRSkgPT4gVCk6IFQge1xuICAgIHJldHVybiB1bndyYXBPckVsc2UoZWxzZUZuLCB0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQudG9NYXliZWBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCN0b21heWJlKSAqL1xuICB0b01heWJlKHRoaXM6IFJlc3VsdDxULCBFPik6IE1heWJlPFQ+IHtcbiAgICByZXR1cm4gdG9NYXliZSh0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQudG9TdHJpbmdgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjdG9zdHJpbmcpICovXG4gIHRvU3RyaW5nKHRoaXM6IFJlc3VsdDxULCBFPik6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRvU3RyaW5nKHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5lcXVhbHNgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjZXF1YWxzKSAqL1xuICBlcXVhbHModGhpczogUmVzdWx0PFQsIEU+LCBjb21wYXJpc29uOiBSZXN1bHQ8VCwgRT4pOiBib29sZWFuIHtcbiAgICByZXR1cm4gZXF1YWxzKGNvbXBhcmlzb24sIHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5hcGBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNhcCkgKi9cbiAgYXA8QSwgQj4odGhpczogUmVzdWx0PChhOiBBKSA9PiBCLCBFPiwgcjogUmVzdWx0PEEsIEU+KTogUmVzdWx0PEIsIEU+IHtcbiAgICByZXR1cm4gYXAodGhpcywgcik7XG4gIH1cbn1cblxuLyoqXG4gIEFuIGBFcnJgIGluc3RhbmNlIGlzIHRoZSAqZmFpbHVyZSogdmFyaWFudCBpbnN0YW5jZSBvZiB0aGVcbiAgW2BSZXN1bHRgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjcmVzdWx0KSB0eXBlLCByZXByZXNlbnRpbmcgYSBmYWlsdXJlXG4gIG91dGNvbWUgZnJvbSBhbiBvcGVyYXRpb24gd2hpY2ggbWF5IGZhaWwuIEZvciBhIGZ1bGwgZGlzY3Vzc2lvbiwgc2VlIFt0aGVcbiAgbW9kdWxlIGRvY3NdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCkuXG5cbiAgQHR5cGVwYXJhbSBUIFRoZSB0eXBlIHdoaWNoIHdvdWxkIGJlIHdyYXBwZWQgaW4gYW4gYE9rYCB2YXJpYW50IG9mIGBSZXN1bHRgLlxuICBAdHlwZXBhcmFtIEUgVGhlIHR5cGUgd3JhcHBlZCBpbiB0aGlzIGBFcnJgIHZhcmlhbnQgb2YgYFJlc3VsdGAuXG4gICovXG5leHBvcnQgY2xhc3MgRXJyPFQsIEU+IGltcGxlbWVudHMgUmVzdWx0U2hhcGU8VCwgRT4ge1xuICAvKipcbiAgICBVbndyYXAgdGhlIGNvbnRhaW5lZCBlcnJvciAuIEEgY29udmVuaWVuY2UgbWV0aG9kIGZvciBmdW5jdGlvbmFsIGlkaW9tcy5cblxuICAgIEEgY29tbW9uIHNjZW5hcmlvIHdoZXJlIHlvdSBtaWdodCB3YW50IHRvIHVzZSB0aGlzIGlzIGluIGEgcGlwZWxpbmUgb2ZcbiAgICBmdW5jdGlvbnM6XG5cbiAgICBgYGB0c1xuICAgIGltcG9ydCBSZXN1bHQsIHsgT2sgfSBmcm9tICd0cnVlLW15dGgvcmVzdWx0JztcblxuICAgIGZ1bmN0aW9uIGdldE1lc3NhZ2VzKHJlc3VsdHM6IEFycmF5PFJlc3VsdDxzdHJpbmcsIEVycm9yPj4pOiBBcnJheTxudW1iZXI+IHtcbiAgICAgIHJldHVybiBtYXliZVN0cmluZ3NcbiAgICAgICAgLmZpbHRlcihSZXN1bHQuaXNFcnIpXG4gICAgICAgIC5tYXAoRXJyLnVud3JhcEVycilcbiAgICAgICAgLm1hcChlID0+IGUubWVzc2FnZSk7XG4gICAgfVxuICAgIGBgYFxuICAgKi9cbiAgc3RhdGljIHVud3JhcEVycjxGPih0aGVFcnI6IEVycjxGLCBhbnk+KTogRiB7XG4gICAgcmV0dXJuIHRoZUVyci5lcnJvcjtcbiAgfVxuXG4gIC8qKiBgRXJyYCBpcyBhbHdheXMgW2BWYXJpYW50LkVycmBdKC4uL2VudW1zL19yZXN1bHRfLnZhcmlhbnQjZXJyKS4gKi9cbiAgcmVhZG9ubHkgdmFyaWFudDogVmFyaWFudC5FcnIgPSBWYXJpYW50LkVycjtcblxuICAvKiogVGhlIHdyYXBwZWQgZXJyb3IgdmFsdWUuICovXG4gIHJlYWRvbmx5IGVycm9yOiBFO1xuXG4gIC8qKlxuICAgIENyZWF0ZSBhbiBpbnN0YW5jZSBvZiBgUmVzdWx0LkVycmAgd2l0aCBgbmV3YC5cblxuICAgIE5vdGU6IFdoaWxlIHlvdSAqbWF5KiBjcmVhdGUgdGhlIGBSZXN1bHRgIHR5cGUgdmlhIG5vcm1hbFxuICAgIEphdmFTY3JpcHQgY2xhc3MgY29uc3RydWN0aW9uLCBpdCBpcyBub3QgcmVjb21tZW5kZWQgZm9yIHRoZSBmdW5jdGlvbmFsXG4gICAgc3R5bGUgZm9yIHdoaWNoIHRoZSBsaWJyYXJ5IGlzIGludGVuZGVkLiBJbnN0ZWFkLCB1c2UgW2BSZXN1bHQuZXJyYF0uXG5cbiAgICBbYFJlc3VsdC5lcnJgXTogLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI2VyclxuXG4gICAgYGBgdHNcbiAgICAvLyBBdm9pZDpcbiAgICBjb25zdCBhbkVyciA9IG5ldyBSZXN1bHQuRXJyKCdhbGFzLCBmYWlsdXJlJyk7XG5cbiAgICAvLyBQcmVmZXI6XG4gICAgY29uc3QgYW5FcnIgPSBSZXN1bHQuZXJyKCdhbGFzLCBmYWlsdXJlJyk7XG4gICAgYGBgXG5cbiAgICBOb3RlIHRoYXQgeW91IG1heSBleHBsaWNpdGx5IHBhc3MgYFVuaXRgIHRvIHRoZSBgRXJyYCBjb25zdHJ1Y3RvciB0byBjcmVhdGVcbiAgICBhIGBSZXN1bHQ8VCwgVW5pdD5gLiBIb3dldmVyLCB5b3UgbWF5ICpub3QqIGNhbGwgdGhlIGBFcnJgIGNvbnN0cnVjdG9yIHdpdGhcbiAgICBgbnVsbGAgb3IgYHVuZGVmaW5lZGAgdG8gZ2V0IHRoYXQgcmVzdWx0ICh0aGUgdHlwZSBzeXN0ZW0gd29uJ3QgYWxsb3cgeW91IHRvXG4gICAgY29uc3RydWN0IGl0IHRoYXQgd2F5KS4gSW5zdGVhZCwgZm9yIGNvbnZlbmllbmNlLCB5b3UgY2FuIHNpbXBseSBjYWxsXG4gICAgYFJlc3VsdC5lcnIoKWAsIHdoaWNoIHdpbGwgY29uc3RydWN0IHRoZSB0eXBlIGNvcnJlY3RseS5cblxuICAgIEBwYXJhbSBlcnJvclxuICAgIFRoZSB2YWx1ZSB0byB3cmFwIGluIGEgYFJlc3VsdC5FcnJgLlxuXG4gICAgYE5vdGU6IG51bGxgIGFuZCBgdW5kZWZpbmVkYCBhcmUgYWxsb3dlZCBieSB0aGUgdHlwZSBzaWduYXR1cmUgc28gdGhhdCB0aGVcbiAgICBjb25zdHJ1Y3RvciBtYXkgYHRocm93YCBvbiB0aG9zZSByYXRoZXIgdGhhbiBjb25zdHJ1Y3RpbmcgYSB0eXBlIGxpa2VcbiAgICBgUmVzdWx0PG51bWJlciwgdW5kZWZpbmVkPmAuXG5cbiAgICBAdGhyb3dzIElmIHlvdSBwYXNzIGBudWxsYCBvciBgdW5kZWZpbmVkYC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKGVycm9yOiBFIHwgbnVsbCkge1xuICAgIGlmIChpc1ZvaWQoZXJyb3IpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdUcmllZCB0byBjb25zdHJ1Y3QgYEVycmAgd2l0aCBgbnVsbGAgb3IgYHVuZGVmaW5lZGAuIE1heWJlIHlvdSB3YW50IGBNYXliZS5Ob3RoaW5nYD8nXG4gICAgICApO1xuICAgIH1cblxuICAgIHRoaXMuZXJyb3IgPSBlcnJvcjtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQuaXNPa2BdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNpc29rKSAqL1xuICBpc09rKHRoaXM6IFJlc3VsdDxULCBFPik6IHRoaXMgaXMgT2s8VCwgRT4ge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQuaXNFcnJgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjaXNlcnIpICovXG4gIGlzRXJyKHRoaXM6IFJlc3VsdDxULCBFPik6IHRoaXMgaXMgRXJyPFQsIEU+IHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQubWFwYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI21hcCkgKi9cbiAgbWFwPFU+KHRoaXM6IFJlc3VsdDxULCBFPiwgbWFwRm46ICh0OiBUKSA9PiBVKTogUmVzdWx0PFUsIEU+IHtcbiAgICByZXR1cm4gbWFwKG1hcEZuLCB0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQubWFwT3JgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjbWFwb3IpICovXG4gIG1hcE9yPFU+KHRoaXM6IFJlc3VsdDxULCBFPiwgb3JVOiBVLCBtYXBGbjogKHQ6IFQpID0+IFUpOiBVIHtcbiAgICByZXR1cm4gbWFwT3Iob3JVLCBtYXBGbiwgdGhpcyk7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0Lm1hcE9yRWxzZWBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNtYXBvcmVsc2UpICovXG4gIG1hcE9yRWxzZTxVPih0aGlzOiBSZXN1bHQ8VCwgRT4sIG9yRWxzZUZuOiAoZXJyOiBFKSA9PiBVLCBtYXBGbjogKHQ6IFQpID0+IFUpOiBVIHtcbiAgICByZXR1cm4gbWFwT3JFbHNlKG9yRWxzZUZuLCBtYXBGbiwgdGhpcyk7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0Lm1hdGNoYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI21hdGNoKSAqL1xuICBtYXRjaDxVPih0aGlzOiBSZXN1bHQ8VCwgRT4sIG1hdGNoT2JqOiBNYXRjaGVyPFQsIEUsIFU+KTogVSB7XG4gICAgcmV0dXJuIG1hdGNoKG1hdGNoT2JqLCB0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQubWFwRXJyYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI21hcGVycikgKi9cbiAgbWFwRXJyPEY+KHRoaXM6IFJlc3VsdDxULCBFPiwgbWFwRXJyRm46IChlOiBFKSA9PiBGKTogUmVzdWx0PFQsIEY+IHtcbiAgICByZXR1cm4gbWFwRXJyKG1hcEVyckZuLCB0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQub3JgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjb3IpICovXG4gIG9yPEY+KHRoaXM6IFJlc3VsdDxULCBFPiwgb3JSZXN1bHQ6IFJlc3VsdDxULCBGPik6IFJlc3VsdDxULCBGPiB7XG4gICAgcmV0dXJuIG9yKG9yUmVzdWx0LCB0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQub3JFbHNlYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI29yZWxzZSkgKi9cbiAgb3JFbHNlPEY+KHRoaXM6IFJlc3VsdDxULCBFPiwgb3JFbHNlRm46IChlcnI6IEUpID0+IFJlc3VsdDxULCBGPik6IFJlc3VsdDxULCBGPiB7XG4gICAgcmV0dXJuIG9yRWxzZShvckVsc2VGbiwgdGhpcyk7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LmFuZGBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNhbmQpICovXG4gIGFuZDxVPih0aGlzOiBSZXN1bHQ8VCwgRT4sIG1BbmQ6IFJlc3VsdDxVLCBFPik6IFJlc3VsdDxVLCBFPiB7XG4gICAgcmV0dXJuIGFuZChtQW5kLCB0aGlzKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQuYW5kVGhlbmBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNhbmR0aGVuKSAqL1xuICBhbmRUaGVuPFU+KHRoaXM6IFJlc3VsdDxULCBFPiwgYW5kVGhlbkZuOiAodDogVCkgPT4gUmVzdWx0PFUsIEU+KTogUmVzdWx0PFUsIEU+IHtcbiAgICByZXR1cm4gYW5kVGhlbihhbmRUaGVuRm4sIHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5jaGFpbmBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNjaGFpbikgKi9cbiAgY2hhaW48VT4odGhpczogUmVzdWx0PFQsIEU+LCBjaGFpbkZuOiAodDogVCkgPT4gUmVzdWx0PFUsIEU+KTogUmVzdWx0PFUsIEU+IHtcbiAgICByZXR1cm4gdGhpcy5hbmRUaGVuKGNoYWluRm4pO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC5mbGF0TWFwYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI2ZsYXRtYXApICovXG4gIGZsYXRNYXA8VT4odGhpczogUmVzdWx0PFQsIEU+LCBmbGF0TWFwRm46ICh0OiBUKSA9PiBSZXN1bHQ8VSwgRT4pOiBSZXN1bHQ8VSwgRT4ge1xuICAgIHJldHVybiB0aGlzLmFuZFRoZW4oZmxhdE1hcEZuKTtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQudW5zYWZlbHlVbndyYXBgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjdW5zYWZlbHl1bndyYXApICovXG4gIHVuc2FmZWx5VW53cmFwKCk6IG5ldmVyIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1RyaWVkIHRvIGB1bnNhZmVseVVud3JhcCBhbiBFcnJgJyk7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LnVuc2FmZWx5VW53cmFwRXJyYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI3Vuc2FmZWx5dW53cmFwZXJyKSAqL1xuICB1bnNhZmVseVVud3JhcEVycigpOiBFIHtcbiAgICByZXR1cm4gdGhpcy5lcnJvcjtcbiAgfVxuXG4gIC8qKiBNZXRob2QgdmFyaWFudCBmb3IgW2BSZXN1bHQudW53cmFwT3JgXSguLi9tb2R1bGVzL19yZXN1bHRfLmh0bWwjdW53cmFwb3IpICovXG4gIHVud3JhcE9yKHRoaXM6IFJlc3VsdDxULCBFPiwgZGVmYXVsdFZhbHVlOiBUKTogVCB7XG4gICAgcmV0dXJuIHVud3JhcE9yKGRlZmF1bHRWYWx1ZSwgdGhpcyk7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LnVud3JhcE9yRWxzZWBdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCN1bndyYXBvcmVsc2UpICovXG4gIHVud3JhcE9yRWxzZSh0aGlzOiBSZXN1bHQ8VCwgRT4sIGVsc2VGbjogKGVycm9yOiBFKSA9PiBUKTogVCB7XG4gICAgcmV0dXJuIHVud3JhcE9yRWxzZShlbHNlRm4sIHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC50b01heWJlYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI3RvbWF5YmUpICovXG4gIHRvTWF5YmUodGhpczogUmVzdWx0PFQsIEU+KTogTWF5YmU8VD4ge1xuICAgIHJldHVybiB0b01heWJlKHRoaXMpO1xuICB9XG5cbiAgLyoqIE1ldGhvZCB2YXJpYW50IGZvciBbYFJlc3VsdC50b1N0cmluZ2BdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCN0b3N0cmluZykgKi9cbiAgdG9TdHJpbmcodGhpczogUmVzdWx0PFQsIEU+KTogc3RyaW5nIHtcbiAgICByZXR1cm4gdG9TdHJpbmcodGhpcyk7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LmVxdWFsc2BdKC4uL21vZHVsZXMvX3Jlc3VsdF8uaHRtbCNlcXVhbHMpICovXG4gIGVxdWFscyh0aGlzOiBSZXN1bHQ8VCwgRT4sIGNvbXBhcmlzb246IFJlc3VsdDxULCBFPik6IGJvb2xlYW4ge1xuICAgIHJldHVybiBlcXVhbHMoY29tcGFyaXNvbiwgdGhpcyk7XG4gIH1cblxuICAvKiogTWV0aG9kIHZhcmlhbnQgZm9yIFtgUmVzdWx0LmFwYF0oLi4vbW9kdWxlcy9fcmVzdWx0Xy5odG1sI2FwKSAqL1xuICBhcDxBLCBCPih0aGlzOiBSZXN1bHQ8KGE6IEEpID0+IEIsIEU+LCByOiBSZXN1bHQ8QSwgRT4pOiBSZXN1bHQ8QiwgRT4ge1xuICAgIHJldHVybiBhcCh0aGlzLCByKTtcbiAgfVxufVxuXG4vKipcbiAgSXMgdGhpcyBgUmVzdWx0YCBhbiBgT2tgIGluc3RhbmNlP1xuXG4gIEluIFR5cGVTY3JpcHQsIG5hcnJvd3MgdGhlIHR5cGUgZnJvbSBgUmVzdWx0PFQsIEU+YCB0byBgT2s8VCwgRT5gLlxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNPazxULCBFPihyZXN1bHQ6IFJlc3VsdDxULCBFPik6IHJlc3VsdCBpcyBPazxULCBFPiB7XG4gIHJldHVybiByZXN1bHQudmFyaWFudCA9PT0gVmFyaWFudC5Paztcbn1cblxuLyoqXG4gIElzIHRoaXMgYFJlc3VsdGAgYW4gYEVycmAgaW5zdGFuY2U/XG5cbiAgSW4gVHlwZVNjcmlwdCwgbmFycm93cyB0aGUgdHlwZSBmcm9tIGBSZXN1bHQ8VCwgRT5gIHRvIGBFcnI8VCwgRT5gLlxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNFcnI8VCwgRT4ocmVzdWx0OiBSZXN1bHQ8VCwgRT4pOiByZXN1bHQgaXMgRXJyPFQsIEU+IHtcbiAgcmV0dXJuIHJlc3VsdC52YXJpYW50ID09PSBWYXJpYW50LkVycjtcbn1cblxuLyoqXG4gIENyZWF0ZSBhbiBpbnN0YW5jZSBvZiBgUmVzdWx0Lk9rYC5cblxuICBJZiB5b3UgbmVlZCB0byBjcmVhdGUgYW4gaW5zdGFuY2Ugd2l0aCBhIHNwZWNpZmljIHR5cGUgKGFzIHlvdSBkbyB3aGVuZXZlciB5b3VcbiAgYXJlIG5vdCBjb25zdHJ1Y3RpbmcgaW1tZWRpYXRlbHkgZm9yIGEgZnVuY3Rpb24gcmV0dXJuIG9yIGFzIGFuIGFyZ3VtZW50IHRvIGFcbiAgZnVuY3Rpb24pLCB5b3UgY2FuIHVzZSBhIHR5cGUgcGFyYW1ldGVyOlxuXG4gIGBgYHRzXG4gIGNvbnN0IHlheU51bWJlciA9IFJlc3VsdC5vazxudW1iZXIsIHN0cmluZz4oMTIpO1xuICBgYGBcblxuICBOb3RlOiBgbnVsbGAgaXMgYWxsb3dlZCBieSB0aGUgdHlwZSBzaWduYXR1cmUgc28gdGhhdCBzbyB0aGF0IHRoZSBmdW5jdGlvblxuICBtYXkgYmUgdXNlZCB0byAgYHRocm93YCBvbiBwYXNzaW5nIGBudWxsYCByYXRoZXIgdGhhbiBjb25zdHJ1Y3RpbmcgYSB0eXBlIGxpa2VcbiAgYFJlc3VsdDxudWxsLCBzdHJpbmc+YC4gYHVuZGVmaW5lZGAgaXMgYWxsb3dlZCBhcyBhIGNvbnZlbmllbmNlIG1ldGhvZCBmb3JcbiAgY29uc3RydWN0aW5nIGEgYFJlc3VsdDxVbml0LCBFPmAuXG5cbiAgYGBgdHNcbiAgY29uc3Qgbm9ybWFsUmVzdWx0ID0gUmVzdWx0Lm9rPG51bWJlciwgc3RyaW5nPig0Mik7XG4gIGNvbnN0IGV4cGxpY2l0VW5pdCA9IFJlc3VsdC5vazxVbml0LCBzdHJpbmc+KFVuaXQpO1xuICBjb25zdCBpbXBsaWNpdFVuaXQgPSBSZXN1bHQub2s8VW5pdCwgc3RyaW5nPigpO1xuICBgYGBcblxuICBJbiB0aGUgY29udGV4dCBvZiBhbiBpbW1lZGlhdGUgZnVuY3Rpb24gcmV0dXJuLCBvciBhbiBhcnJvdyBmdW5jdGlvbiB3aXRoIGFcbiAgc2luZ2xlIGV4cHJlc3Npb24gdmFsdWUsIHlvdSBkbyBub3QgaGF2ZSB0byBzcGVjaWZ5IHRoZSB0eXBlcywgc28gdGhpcyBjYW4gYmVcbiAgcXVpdGUgY29udmVuaWVudC5cblxuICBgYGB0c1xuICB0eXBlIFNvbWVEYXRhID0ge1xuICAgIC8vLi4uXG4gIH07XG5cbiAgY29uc3QgaXNWYWxpZCA9IChkYXRhOiBTb21lRGF0YSk6IGJvb2xlYW4gPT4ge1xuICAgIC8vIHRydWUgb3IgZmFsc2UuLi5cbiAgfVxuXG4gIGNvbnN0IGFycm93VmFsaWRhdGUgPSAoZGF0YTogU29tZURhdGEpOiBSZXN1bHQ8VW5pdCwgc3RyaW5nPiA9PlxuICAgIGlzVmFsaWQoZGF0YSkgPyBSZXN1bHQub2soKSA6IFJlc3VsdC5lcnIoJ3NvbWV0aGluZyB3YXMgd3JvbmchJyk7XG5cbiAgZnVuY3Rpb24gZm5WYWxpZGF0ZShkYXRhOiBzb21lRGF0YSk6IFJlc3VsdDxVbml0LCBzdHJpbmc+IHtcbiAgICByZXR1cm4gaXNWYWxpZChkYXRhKSA/IFJlc3VsdC5vaygpIDogUmVzdWx0LmVycignc29tZXRoaW5nIHdhcyB3cm9uZycpO1xuICB9XG4gIGBgYFxuXG4gIEB0eXBlcGFyYW0gVCBUaGUgdHlwZSBvZiB0aGUgaXRlbSBjb250YWluZWQgaW4gdGhlIGBSZXN1bHRgLlxuICBAcGFyYW0gdmFsdWUgVGhlIHZhbHVlIHRvIHdyYXAgaW4gYSBgUmVzdWx0Lk9rYC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG9rPFQsIEU+KCk6IFJlc3VsdDxVbml0LCBFPjtcbmV4cG9ydCBmdW5jdGlvbiBvazxULCBFPih2YWx1ZTogVCk6IFJlc3VsdDxULCBFPjtcbmV4cG9ydCBmdW5jdGlvbiBvazxULCBFPih2YWx1ZT86IFQpOiBSZXN1bHQ8VW5pdCwgRT4gfCBSZXN1bHQ8VCwgRT4ge1xuICByZXR1cm4gdmFsdWUgPT09IHVuZGVmaW5lZCA/IG5ldyBPayhVbml0KSA6IG5ldyBPayh2YWx1ZSk7XG59XG5cbi8qKiBgUmVzdWx0Lm9mYCBpcyBhbiBhbGlhcyBmb3IgYFJlc3VsdC5va2AuICovXG5leHBvcnQgY29uc3Qgb2YgPSBvaztcblxuLyoqXG4gIENyZWF0ZSBhbiBpbnN0YW5jZSBvZiBgUmVzdWx0LkVycm9yYC5cblxuICBJZiB5b3UgbmVlZCB0byBjcmVhdGUgYW4gaW5zdGFuY2Ugd2l0aCBhIHNwZWNpZmljIHR5cGUgKGFzIHlvdSBkbyB3aGVuZXZlciB5b3VcbiAgYXJlIG5vdCBjb25zdHJ1Y3RpbmcgaW1tZWRpYXRlbHkgZm9yIGEgZnVuY3Rpb24gcmV0dXJuIG9yIGFzIGFuIGFyZ3VtZW50IHRvIGFcbiAgZnVuY3Rpb24pLCB5b3UgY2FuIHVzZSBhIHR5cGUgcGFyYW1ldGVyOlxuXG4gIGBgYHRzXG4gIGNvbnN0IG5vdFN0cmluZyA9IFJlc3VsdC5lcnI8bnVtYmVyLCBzdHJpbmc+KCdzb21ldGhpbmcgd2VudCB3cm9uZycpO1xuICBgYGBcblxuICBOb3RlOiBgbnVsbGAgaXMgYWxsb3dlZCBieSB0aGUgdHlwZSBzaWduYXR1cmUgc28gdGhhdCBzbyB0aGF0IHRoZSBmdW5jdGlvblxuICBtYXkgYmUgdXNlZCB0byAgYHRocm93YCBvbiBwYXNzaW5nIGBudWxsYCByYXRoZXIgdGhhbiBjb25zdHJ1Y3RpbmcgYSB0eXBlIGxpa2VcbiAgYFJlc3VsdDxudWxsLCBzdHJpbmc+YC4gYHVuZGVmaW5lZGAgaXMgYWxsb3dlZCBhcyBhIGNvbnZlbmllbmNlIG1ldGhvZCBmb3JcbiAgY29uc3RydWN0aW5nIGEgYFJlc3VsdDxVbml0LCBFPmAuXG5cbiAgYGBgdHNcbiAgY29uc3Qgbm9ybWFsUmVzdWx0ID0gUmVzdWx0LmVycjxudW1iZXIsIHN0cmluZz4oJ29oIG5vJyk7XG4gIGNvbnN0IGV4cGxpY2l0VW5pdCA9IFJlc3VsdC5lcnI8bnVtYmVyLCBVbml0PihVbml0KTtcbiAgY29uc3QgaW1wbGljaXRVbml0ID0gUmVzdWx0LmVycjxudW1iZXIsIFVuaXQ+KCk7XG4gIGBgYFxuXG4gIEluIHRoZSBjb250ZXh0IG9mIGFuIGltbWVkaWF0ZSBmdW5jdGlvbiByZXR1cm4sIG9yIGFuIGFycm93IGZ1bmN0aW9uIHdpdGggYVxuICBzaW5nbGUgZXhwcmVzc2lvbiB2YWx1ZSwgeW91IGRvIG5vdCBoYXZlIHRvIHNwZWNpZnkgdGhlIHR5cGVzLCBzbyB0aGlzIGNhbiBiZVxuICBxdWl0ZSBjb252ZW5pZW50LlxuXG4gIGBgYHRzXG4gIHR5cGUgU29tZURhdGEgPSB7XG4gICAgLy8uLi5cbiAgfTtcblxuICBjb25zdCBpc1ZhbGlkID0gKGRhdGE6IFNvbWVEYXRhKTogYm9vbGVhbiA9PiB7XG4gICAgLy8gdHJ1ZSBvciBmYWxzZS4uLlxuICB9XG5cbiAgY29uc3QgYXJyb3dWYWxpZGF0ZSA9IChkYXRhOiBTb21lRGF0YSk6IFJlc3VsdDxudW1iZXIsIFVuaXQ+ID0+XG4gICAgaXNWYWxpZChkYXRhKSA/IFJlc3VsdC5vayg0MikgOiBSZXN1bHQuZXJyKCk7XG5cbiAgZnVuY3Rpb24gZm5WYWxpZGF0ZShkYXRhOiBzb21lRGF0YSk6IFJlc3VsdDxudW1iZXIsIFVuaXQ+IHtcbiAgICByZXR1cm4gaXNWYWxpZChkYXRhKSA/IFJlc3VsdC5vayg0MikgOiBSZXN1bHQuZXJyKCk7XG4gIH1cbiAgYGBgXG5cbiAgQHR5cGVwYXJhbSBUIFRoZSB0eXBlIG9mIHRoZSBpdGVtIGNvbnRhaW5lZCBpbiB0aGUgYFJlc3VsdGAuXG4gIEBwYXJhbSBFIFRoZSBlcnJvciB2YWx1ZSB0byB3cmFwIGluIGEgYFJlc3VsdC5FcnJgLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZXJyPFQsIEU+KCk6IFJlc3VsdDxULCBVbml0PjtcbmV4cG9ydCBmdW5jdGlvbiBlcnI8VCwgRT4oZXJyb3I6IEUpOiBSZXN1bHQ8VCwgRT47XG5leHBvcnQgZnVuY3Rpb24gZXJyPFQsIEU+KGVycm9yPzogRSk6IFJlc3VsdDxULCBVbml0PiB8IFJlc3VsdDxULCBFPiB7XG4gIHJldHVybiBpc1ZvaWQoZXJyb3IpID8gbmV3IEVycihVbml0KSA6IG5ldyBFcnIoZXJyb3IpO1xufVxuXG4vKipcbiAgTWFwIG92ZXIgYSBgUmVzdWx0YCBpbnN0YW5jZTogYXBwbHkgdGhlIGZ1bmN0aW9uIHRvIHRoZSB3cmFwcGVkIHZhbHVlIGlmIHRoZVxuICBpbnN0YW5jZSBpcyBgT2tgLCBhbmQgcmV0dXJuIHRoZSB3cmFwcGVkIGVycm9yIHZhbHVlIHdyYXBwZWQgYXMgYSBuZXcgYEVycmAgb2ZcbiAgdGhlIGNvcnJlY3QgdHlwZSAoYFJlc3VsdDxVLCBFPmApIGlmIHRoZSBpbnN0YW5jZSBpcyBgRXJyYC5cblxuICBgUmVzdWx0Lm1hcGAgd29ya3MgYSBsb3QgbGlrZSBgQXJyYXkucHJvdG90eXBlLm1hcGAsIGJ1dCB3aXRoIG9uZSBpbXBvcnRhbnRcbiAgZGlmZmVyZW5jZS4gQm90aCBgUmVzdWx0YCBhbmQgYEFycmF5YCBhcmUgY29udGFpbmVycyBmb3Igb3RoZXIga2luZHMgb2YgaXRlbXMsXG4gIGJ1dCB3aGVyZSBgQXJyYXkucHJvdG90eXBlLm1hcGAgaGFzIDAgdG8gX25fIGl0ZW1zLCBhIGBSZXN1bHRgIGFsd2F5cyBoYXNcbiAgZXhhY3RseSBvbmUgaXRlbSwgd2hpY2ggaXMgKmVpdGhlciogYSBzdWNjZXNzIG9yIGFuIGVycm9yIGluc3RhbmNlLlxuXG4gIFdoZXJlIGBBcnJheS5wcm90b3R5cGUubWFwYCB3aWxsIGFwcGx5IHRoZSBtYXBwaW5nIGZ1bmN0aW9uIHRvIGV2ZXJ5IGl0ZW0gaW5cbiAgdGhlIGFycmF5IChpZiB0aGVyZSBhcmUgYW55KSwgYFJlc3VsdC5tYXBgIHdpbGwgb25seSBhcHBseSB0aGUgbWFwcGluZ1xuICBmdW5jdGlvbiB0byB0aGUgKHNpbmdsZSkgZWxlbWVudCBpZiBhbiBgT2tgIGluc3RhbmNlLCBpZiB0aGVyZSBpcyBvbmUuXG5cbiAgSWYgeW91IGhhdmUgbm8gaXRlbXMgaW4gYW4gYXJyYXkgb2ZcbiAgbnVtYmVycyBuYW1lZCBgZm9vYCBhbmQgY2FsbCBgZm9vLm1hcCh4ID0+IHggKyAxKWAsIHlvdSdsbCBzdGlsbCBzb21lIGhhdmUgYW5cbiAgYXJyYXkgd2l0aCBub3RoaW5nIGluIGl0LiBCdXQgaWYgeW91IGhhdmUgYW55IGl0ZW1zIGluIHRoZSBhcnJheSAoYFsyLCAzXWApLFxuICBhbmQgeW91IGNhbGwgYGZvby5tYXAoeCA9PiB4ICsgMSlgIG9uIGl0LCB5b3UnbGwgZ2V0IGEgbmV3IGFycmF5IHdpdGggZWFjaCBvZlxuICB0aG9zZSBpdGVtcyBpbnNpZGUgdGhlIGFycmF5IFwiY29udGFpbmVyXCIgdHJhbnNmb3JtZWQgKGBbMywgNF1gKS5cblxuICBXaXRoIGBSZXN1bHQubWFwYCwgdGhlIGBFcnJgIHZhcmlhbnQgaXMgdHJlYXRlZCAqYnkgdGhlIGBtYXBgIGZ1bmN0aW9uKiBraW5kXG4gIG9mIHRoZSBzYW1lIHdheSBhcyB0aGUgZW1wdHkgYXJyYXkgY2FzZTogaXQncyBqdXN0IGlnbm9yZWQsIGFuZCB5b3UgZ2V0IGJhY2sgYVxuICBuZXcgYFJlc3VsdGAgdGhhdCBpcyBzdGlsbCBqdXN0IHRoZSBzYW1lIGBFcnJgIGluc3RhbmNlLiBCdXQgaWYgeW91IGhhdmUgYW5cbiAgYE9rYCB2YXJpYW50LCB0aGUgbWFwIGZ1bmN0aW9uIGlzIGFwcGxpZWQgdG8gaXQsIGFuZCB5b3UgZ2V0IGJhY2sgYSBuZXdcbiAgYFJlc3VsdGAgd2l0aCB0aGUgdmFsdWUgdHJhbnNmb3JtZWQsIGFuZCBzdGlsbCB3cmFwcGVkIGluIGFuIGBPa2AuXG5cbiAgIyMjIyBFeGFtcGxlc1xuXG4gIGBgYHRzXG4gIGltcG9ydCB7IG9rLCBlcnIsIG1hcCwgdG9TdHJpbmcgfSBmcm9tICd0cnVlLW15dGgvcmVzdWx0JztcbiAgY29uc3QgZG91YmxlID0gbiA9PiBuICogMjtcblxuICBjb25zdCBhbk9rID0gb2soMTIpO1xuICBjb25zdCBtYXBwZWRPayA9IG1hcChkb3VibGUsIGFuT2spO1xuICBjb25zb2xlLmxvZyh0b1N0cmluZyhtYXBwZWRPaykpOyAvLyBPaygyNClcblxuICBjb25zdCBhbkVyciA9IGVycihcIm5vdGhpbmcgaGVyZSFcIik7XG4gIGNvbnN0IG1hcHBlZEVyciA9IG1hcChkb3VibGUsIGFuRXJyKTtcbiAgY29uc29sZS5sb2codG9TdHJpbmcobWFwcGVkT2spKTsgLy8gRXJyKG5vdGhpbmcgaGVyZSEpXG4gIGBgYFxuXG4gIEB0eXBlcGFyYW0gVCAgVGhlIHR5cGUgb2YgdGhlIHZhbHVlIHdyYXBwZWQgaW4gYW4gYE9rYCBpbnN0YW5jZSwgYW5kIHRha2VuIGFzXG4gICAgICAgICAgICAgICAgdGhlIGFyZ3VtZW50IHRvIHRoZSBgbWFwRm5gLlxuICBAdHlwZXBhcmFtIFUgIFRoZSB0eXBlIG9mIHRoZSB2YWx1ZSB3cmFwcGVkIGluIHRoZSBuZXcgYE9rYCBpbnN0YW5jZSBhZnRlclxuICAgICAgICAgICAgICAgIGFwcGx5aW5nIGBtYXBGbmAsIHRoYXQgaXMsIHRoZSB0eXBlIHJldHVybmVkIGJ5IGBtYXBGbmAuXG4gIEB0eXBlcGFyYW0gRSAgVGhlIHR5cGUgb2YgdGhlIHZhbHVlIHdyYXBwZWQgaW4gYW4gYEVycmAgaW5zdGFuY2UuXG4gIEBwYXJhbSBtYXBGbiAgVGhlIGZ1bmN0aW9uIHRvIGFwcGx5IHRoZSB2YWx1ZSB0byBpZiBgcmVzdWx0YCBpcyBgT2tgLlxuICBAcGFyYW0gcmVzdWx0IFRoZSBgUmVzdWx0YCBpbnN0YW5jZSB0byBtYXAgb3Zlci5cbiAgQHJldHVybnMgICAgICBBIG5ldyBgUmVzdWx0YCB3aXRoIHRoZSByZXN1bHQgb2YgYXBwbHlpbmcgYG1hcEZuYCB0byB0aGUgdmFsdWVcbiAgICAgICAgICAgICAgICBpbiBhbiBgT2tgLCBvciBlbHNlIHRoZSBvcmlnaW5hbCBgRXJyYCB2YWx1ZSB3cmFwcGVkIGluIHRoZSBuZXdcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1hcDxULCBVLCBFPihtYXBGbjogKHQ6IFQpID0+IFUsIHJlc3VsdDogUmVzdWx0PFQsIEU+KTogUmVzdWx0PFUsIEU+O1xuZXhwb3J0IGZ1bmN0aW9uIG1hcDxULCBVLCBFPihtYXBGbjogKHQ6IFQpID0+IFUpOiAocmVzdWx0OiBSZXN1bHQ8VCwgRT4pID0+IFJlc3VsdDxVLCBFPjtcbmV4cG9ydCBmdW5jdGlvbiBtYXA8VCwgVSwgRT4oXG4gIG1hcEZuOiAodDogVCkgPT4gVSxcbiAgcmVzdWx0PzogUmVzdWx0PFQsIEU+XG4pOiBSZXN1bHQ8VSwgRT4gfCAoKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBSZXN1bHQ8VSwgRT4pIHtcbiAgY29uc3Qgb3AgPSAocjogUmVzdWx0PFQsIEU+KSA9PiAoaXNPayhyKSA/IG9rKG1hcEZuKHIudmFsdWUpKSA6IHIpIGFzIFJlc3VsdDxVLCBFPjtcbiAgcmV0dXJuIGN1cnJ5MShvcCwgcmVzdWx0KTtcbn1cblxuLyoqXG4gIE1hcCBvdmVyIGEgYFJlc3VsdGAgaW5zdGFuY2UgYXMgaW4gW2BtYXBgXSgjbWFwKSBhbmQgZ2V0IG91dCB0aGUgdmFsdWVcbiAgaWYgYHJlc3VsdGAgaXMgYW4gYE9rYCwgb3IgcmV0dXJuIGEgZGVmYXVsdCB2YWx1ZSBpZiBgcmVzdWx0YCBpcyBhbiBgRXJyYC5cblxuICAjIyMjIEV4YW1wbGVzXG5cbiAgYGBgdHNcbiAgaW1wb3J0IHsgb2ssIGVyciwgbWFwT3IgfSBmcm9tICd0cnVlLW15dGgvcmVzdWx0JztcblxuICBjb25zdCBsZW5ndGggPSAoczogc3RyaW5nKSA9PiBzLmxlbmd0aDtcblxuICBjb25zdCBhbk9rU3RyaW5nID0gb2soJ2Egc3RyaW5nJyk7XG4gIGNvbnN0IHRoZVN0cmluZ0xlbmd0aCA9IG1hcE9yKDAsIGFuT2tTdHJpbmcpO1xuICBjb25zb2xlLmxvZyh0aGVTdHJpbmdMZW5ndGgpOyAgLy8gOFxuXG4gIGNvbnN0IGFuRXJyID0gZXJyKCd1aCBvaCcpO1xuICBjb25zdCBhbkVyck1hcHBlZCA9IG1hcE9yKDAsIGFuRXJyKTtcbiAgY29uc29sZS5sb2coYW5FcnJNYXBwZWQpOyAgLy8gMFxuICBgYGBcblxuICBAcGFyYW0gb3JVIFRoZSBkZWZhdWx0IHZhbHVlIHRvIHVzZSBpZiBgcmVzdWx0YCBpcyBhbiBgRXJyYC5cbiAgQHBhcmFtIG1hcEZuIFRoZSBmdW5jdGlvbiB0byBhcHBseSB0aGUgdmFsdWUgdG8gaWYgYHJlc3VsdGAgaXMgYW4gYE9rYC5cbiAgQHBhcmFtIHJlc3VsdCBUaGUgYFJlc3VsdGAgaW5zdGFuY2UgdG8gbWFwIG92ZXIuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtYXBPcjxULCBVLCBFPihvclU6IFUsIG1hcEZuOiAodDogVCkgPT4gVSwgcmVzdWx0OiBSZXN1bHQ8VCwgRT4pOiBVO1xuZXhwb3J0IGZ1bmN0aW9uIG1hcE9yPFQsIFUsIEU+KG9yVTogVSwgbWFwRm46ICh0OiBUKSA9PiBVKTogKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBVO1xuZXhwb3J0IGZ1bmN0aW9uIG1hcE9yPFQsIFUsIEU+KG9yVTogVSk6IChtYXBGbjogKHQ6IFQpID0+IFUpID0+IChyZXN1bHQ6IFJlc3VsdDxULCBFPikgPT4gVTtcbmV4cG9ydCBmdW5jdGlvbiBtYXBPcjxULCBVLCBFPihcbiAgb3JVOiBVLFxuICBtYXBGbj86ICh0OiBUKSA9PiBVLFxuICByZXN1bHQ/OiBSZXN1bHQ8VCwgRT5cbik6IFUgfCAoKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBVKSB8ICgobWFwRm46ICh0OiBUKSA9PiBVKSA9PiAocmVzdWx0OiBSZXN1bHQ8VCwgRT4pID0+IFUpIHtcbiAgZnVuY3Rpb24gZnVsbE9wKGZuOiAodDogVCkgPT4gVSwgcjogUmVzdWx0PFQsIEU+KTogVSB7XG4gICAgcmV0dXJuIGlzT2socikgPyBmbihyLnZhbHVlKSA6IG9yVTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnRpYWxPcChmbjogKHQ6IFQpID0+IFUpOiAobWF5YmU6IFJlc3VsdDxULCBFPikgPT4gVTtcbiAgZnVuY3Rpb24gcGFydGlhbE9wKGZuOiAodDogVCkgPT4gVSwgY3VycmllZFJlc3VsdDogUmVzdWx0PFQsIEU+KTogVTtcbiAgZnVuY3Rpb24gcGFydGlhbE9wKFxuICAgIGZuOiAodDogVCkgPT4gVSxcbiAgICBjdXJyaWVkUmVzdWx0PzogUmVzdWx0PFQsIEU+XG4gICk6IFUgfCAoKG1heWJlOiBSZXN1bHQ8VCwgRT4pID0+IFUpIHtcbiAgICByZXR1cm4gY3VycmllZFJlc3VsdCAhPT0gdW5kZWZpbmVkXG4gICAgICA/IGZ1bGxPcChmbiwgY3VycmllZFJlc3VsdClcbiAgICAgIDogKGV4dHJhQ3VycmllZFJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBmdWxsT3AoZm4sIGV4dHJhQ3VycmllZFJlc3VsdCk7XG4gIH1cblxuICByZXR1cm4gbWFwRm4gPT09IHVuZGVmaW5lZFxuICAgID8gcGFydGlhbE9wXG4gICAgOiByZXN1bHQgPT09IHVuZGVmaW5lZFxuICAgICAgPyBwYXJ0aWFsT3AobWFwRm4pXG4gICAgICA6IHBhcnRpYWxPcChtYXBGbiwgcmVzdWx0KTtcbn1cblxuLyoqXG4gIE1hcCBvdmVyIGEgYFJlc3VsdGAgaW5zdGFuY2UgYXMgaW4gW2BtYXBgXSgjbWFwKSBhbmQgZ2V0IG91dCB0aGUgdmFsdWUgaWZcbiAgYHJlc3VsdGAgaXMgYE9rYCwgb3IgYXBwbHkgYSBmdW5jdGlvbiAoYG9yRWxzZUZuYCkgdG8gdGhlIHZhbHVlIHdyYXBwZWQgaW5cbiAgdGhlIGBFcnJgIHRvIGdldCBhIGRlZmF1bHQgdmFsdWUuXG5cbiAgTGlrZSBbYG1hcE9yYF0oI21hcG9yKSBidXQgdXNpbmcgYSBmdW5jdGlvbiB0byB0cmFuc2Zvcm0gdGhlIGVycm9yIGludG8gYVxuICB1c2FibGUgdmFsdWUgaW5zdGVhZCBvZiBzaW1wbHkgdXNpbmcgYSBkZWZhdWx0IHZhbHVlLlxuXG4gICMjIyMgRXhhbXBsZXNcblxuICBgYGB0c1xuICBpbXBvcnQgeyBvaywgZXJyLCBtYXBPckVsc2UgfSBmcm9tICd0cnVlLW15dGgvcmVzdWx0JztcblxuICBjb25zdCBzdW1tYXJpemUgPSAoczogc3RyaW5nKSA9PiBgVGhlIHJlc3BvbnNlIHdhczogJyR7c30nYDtcbiAgY29uc3QgZ2V0UmVhc29uID0gKGVycjogeyBjb2RlOiBudW1iZXIsIHJlYXNvbjogc3RyaW5nIH0pID0+IGVyci5yZWFzb247XG5cbiAgY29uc3Qgb2tSZXNwb25zZSA9IG9rKFwiVGhpbmdzIGFyZSBncmFuZCBoZXJlLlwiKTtcbiAgY29uc3QgbWFwcGVkT2tBbmRVbndyYXBwZWQgPSBtYXBPckVsc2UoZ2V0UmVhc29uLCBzdW1tYXJpemUsIG9rUmVzcG9uc2UpO1xuICBjb25zb2xlLmxvZyhtYXBwZWRPa0FuZFVud3JhcHBlZCk7ICAvLyBUaGUgcmVzcG9uc2Ugd2FzOiAnVGhpbmdzIGFyZSBncmFuZCBoZXJlLidcblxuICBjb25zdCBlcnJSZXNwb25zZSA9IGVycih7IGNvZGU6IDUwMCwgcmVhc29uOiAnTm90aGluZyBhdCB0aGlzIGVuZHBvaW50IScgfSk7XG4gIGNvbnN0IG1hcHBlZEVyckFuZFVud3JhcHBlZCA9IG1hcE9yRWxzZShnZXRSZWFzb24sIHN1bW1hcml6ZSwgZXJyUmVzcG9uc2UpO1xuICBjb25zb2xlLmxvZyhtYXBwZWRFcnJBbmRVbndyYXBwZWQpOyAgLy8gTm90aGluZyBhdCB0aGlzIGVuZHBvaW50IVxuICBgYGBcblxuICBAdHlwZXBhcmFtIFQgICAgVGhlIHR5cGUgb2YgdGhlIHdyYXBwZWQgYE9rYCB2YWx1ZS5cbiAgQHR5cGVwYXJhbSBVICAgIFRoZSB0eXBlIG9mIHRoZSByZXN1bHRpbmcgdmFsdWUgZnJvbSBhcHBseWluZyBgbWFwRm5gIHRvIHRoZVxuICAgICAgICAgICAgICAgICAgYE9rYCB2YWx1ZSBvciBgb3JFbHNlRm5gIHRvIHRoZSBgRXJyYCB2YWx1ZS5cbiAgQHR5cGVwYXJhbSBFICAgIFRoZSB0eXBlIG9mIHRoZSB3cmFwcGVkIGBFcnJgIHZhbHVlLlxuICBAcGFyYW0gb3JFbHNlRm4gVGhlIGZ1bmN0aW9uIHRvIGFwcGx5IHRvIHRoZSB3cmFwcGVkIGBFcnJgIHZhbHVlIHRvIGdldCBhXG4gICAgICAgICAgICAgICAgICB1c2FibGUgdmFsdWUgaWYgYHJlc3VsdGAgaXMgYW4gYEVycmAuXG4gIEBwYXJhbSBtYXBGbiAgICBUaGUgZnVuY3Rpb24gdG8gYXBwbHkgdG8gdGhlIHdyYXBwZWQgYE9rYCB2YWx1ZSBpZiBgcmVzdWx0YCBpc1xuICAgICAgICAgICAgICAgICAgYW4gYE9rYC5cbiAgQHBhcmFtIHJlc3VsdCAgIFRoZSBgUmVzdWx0YCBpbnN0YW5jZSB0byBtYXAgb3Zlci5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1hcE9yRWxzZTxULCBVLCBFPihcbiAgb3JFbHNlRm46IChlcnI6IEUpID0+IFUsXG4gIG1hcEZuOiAodDogVCkgPT4gVSxcbiAgcmVzdWx0OiBSZXN1bHQ8VCwgRT5cbik6IFU7XG5leHBvcnQgZnVuY3Rpb24gbWFwT3JFbHNlPFQsIFUsIEU+KFxuICBvckVsc2VGbjogKGVycjogRSkgPT4gVSxcbiAgbWFwRm46ICh0OiBUKSA9PiBVXG4pOiAocmVzdWx0OiBSZXN1bHQ8VCwgRT4pID0+IFU7XG5leHBvcnQgZnVuY3Rpb24gbWFwT3JFbHNlPFQsIFUsIEU+KFxuICBvckVsc2VGbjogKGVycjogRSkgPT4gVVxuKTogKG1hcEZuOiAodDogVCkgPT4gVSkgPT4gKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBVO1xuZXhwb3J0IGZ1bmN0aW9uIG1hcE9yRWxzZTxULCBVLCBFPihcbiAgb3JFbHNlRm46IChlcnI6IEUpID0+IFUsXG4gIG1hcEZuPzogKHQ6IFQpID0+IFUsXG4gIHJlc3VsdD86IFJlc3VsdDxULCBFPlxuKTogVSB8ICgocmVzdWx0OiBSZXN1bHQ8VCwgRT4pID0+IFUpIHwgKChtYXBGbjogKHQ6IFQpID0+IFUpID0+IChyZXN1bHQ6IFJlc3VsdDxULCBFPikgPT4gVSkge1xuICBmdW5jdGlvbiBmdWxsT3AoZm46ICh0OiBUKSA9PiBVLCByOiBSZXN1bHQ8VCwgRT4pIHtcbiAgICByZXR1cm4gaXNPayhyKSA/IGZuKHIudmFsdWUpIDogb3JFbHNlRm4oci5lcnJvcik7XG4gIH1cblxuICBmdW5jdGlvbiBwYXJ0aWFsT3AoZm46ICh0OiBUKSA9PiBVKTogKG1heWJlOiBSZXN1bHQ8VCwgRT4pID0+IFU7XG4gIGZ1bmN0aW9uIHBhcnRpYWxPcChmbjogKHQ6IFQpID0+IFUsIGN1cnJpZWRSZXN1bHQ6IFJlc3VsdDxULCBFPik6IFU7XG4gIGZ1bmN0aW9uIHBhcnRpYWxPcChcbiAgICBmbjogKHQ6IFQpID0+IFUsXG4gICAgY3VycmllZFJlc3VsdD86IFJlc3VsdDxULCBFPlxuICApOiBVIHwgKChtYXliZTogUmVzdWx0PFQsIEU+KSA9PiBVKSB7XG4gICAgcmV0dXJuIGN1cnJpZWRSZXN1bHQgIT09IHVuZGVmaW5lZFxuICAgICAgPyBmdWxsT3AoZm4sIGN1cnJpZWRSZXN1bHQpXG4gICAgICA6IChleHRyYUN1cnJpZWRSZXN1bHQ6IFJlc3VsdDxULCBFPikgPT4gZnVsbE9wKGZuLCBleHRyYUN1cnJpZWRSZXN1bHQpO1xuICB9XG5cbiAgcmV0dXJuIG1hcEZuID09PSB1bmRlZmluZWRcbiAgICA/IHBhcnRpYWxPcFxuICAgIDogcmVzdWx0ID09PSB1bmRlZmluZWRcbiAgICAgID8gcGFydGlhbE9wKG1hcEZuKVxuICAgICAgOiBwYXJ0aWFsT3AobWFwRm4sIHJlc3VsdCk7XG59XG5cbi8qKlxuICBNYXAgb3ZlciBhIGBSZXN1bHRgLCBleGFjdGx5IGFzIGluIFtgbWFwYF0oI21hcCksIGJ1dCBvcGVyYXRpbmcgb24gdGhlIHZhbHVlXG4gIHdyYXBwZWQgaW4gYW4gYEVycmAgaW5zdGVhZCBvZiB0aGUgdmFsdWUgd3JhcHBlZCBpbiB0aGUgYE9rYC4gVGhpcyBpcyBoYW5keVxuICBmb3Igd2hlbiB5b3UgbmVlZCB0byBsaW5lIHVwIGEgYnVuY2ggb2YgZGlmZmVyZW50IHR5cGVzIG9mIGVycm9ycywgb3IgaWYgeW91XG4gIG5lZWQgYW4gZXJyb3Igb2Ygb25lIHNoYXBlIHRvIGJlIGluIGEgZGlmZmVyZW50IHNoYXBlIHRvIHVzZSBzb21ld2hlcmUgZWxzZSBpblxuICB5b3VyIGNvZGViYXNlLlxuXG4gICMjIyMgRXhhbXBsZXNcblxuICBgYGB0c1xuICBpbXBvcnQgeyBvaywgZXJyLCBtYXBFcnIsIHRvU3RyaW5nIH0gZnJvbSAndHJ1ZS1teXRoL3Jlc3VsdCc7XG5cbiAgY29uc3QgcmVhc29uID0gKGVycjogeyBjb2RlOiBudW1iZXIsIHJlYXNvbjogc3RyaW5nIH0pID0+IGVyci5yZWFzb247XG5cbiAgY29uc3QgYW5PayA9IG9rKDEyKTtcbiAgY29uc3QgbWFwcGVkT2sgPSBtYXBFcnIocmVhc29uLCBhbk9rKTtcbiAgY29uc29sZS5sb2codG9TdHJpbmcobWFwcGVkT2spKTsgIC8vIE9rKDEyKVxuXG4gIGNvbnN0IGFuRXJyID0gZXJyKHsgY29kZTogMTAxLCByZWFzb246ICdiYWQgZmlsZScgfSk7XG4gIGNvbnN0IG1hcHBlZEVyciA9IG1hcEVycihyZWFzb24sIGFuRXJyKTtcbiAgY29uc29sZS5sb2codG9TdHJpbmcobWFwcGVkRXJyKSk7ICAvLyBFcnIoYmFkIGZpbGUpXG4gIGBgYFxuXG4gIEB0eXBlcGFyYW0gVCAgICBUaGUgdHlwZSBvZiB0aGUgdmFsdWUgd3JhcHBlZCBpbiB0aGUgYE9rYCBvZiB0aGUgYFJlc3VsdGAuXG4gIEB0eXBlcGFyYW0gRSAgICBUaGUgdHlwZSBvZiB0aGUgdmFsdWUgd3JhcHBlZCBpbiB0aGUgYEVycmAgb2YgdGhlIGBSZXN1bHRgLlxuICBAdHlwZXBhcmFtIEYgICAgVGhlIHR5cGUgb2YgdGhlIHZhbHVlIHdyYXBwZWQgaW4gdGhlIGBFcnJgIG9mIGEgbmV3IGBSZXN1bHRgLFxuICAgICAgICAgICAgICAgICAgcmV0dXJuZWQgYnkgdGhlIGBtYXBFcnJGbmAuXG4gIEBwYXJhbSBtYXBFcnJGbiBUaGUgZnVuY3Rpb24gdG8gYXBwbHkgdG8gdGhlIHZhbHVlIHdyYXBwZWQgaW4gYEVycmAgaWYgYHJlc3VsdGAgaXMgYW4gYEVycmAuXG4gIEBwYXJhbSByZXN1bHQgICBUaGUgYFJlc3VsdGAgaW5zdGFuY2UgdG8gbWFwIG92ZXIgYW4gZXJyb3IgY2FzZSBmb3IuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtYXBFcnI8VCwgRSwgRj4obWFwRXJyRm46IChlOiBFKSA9PiBGLCByZXN1bHQ6IFJlc3VsdDxULCBFPik6IFJlc3VsdDxULCBGPjtcbmV4cG9ydCBmdW5jdGlvbiBtYXBFcnI8VCwgRSwgRj4obWFwRXJyRm46IChlOiBFKSA9PiBGKTogKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBSZXN1bHQ8VCwgRj47XG5leHBvcnQgZnVuY3Rpb24gbWFwRXJyPFQsIEUsIEY+KFxuICBtYXBFcnJGbjogKGU6IEUpID0+IEYsXG4gIHJlc3VsdD86IFJlc3VsdDxULCBFPlxuKTogUmVzdWx0PFQsIEY+IHwgKChyZXN1bHQ6IFJlc3VsdDxULCBFPikgPT4gUmVzdWx0PFQsIEY+KSB7XG4gIGNvbnN0IG9wID0gKHI6IFJlc3VsdDxULCBFPikgPT4gKGlzT2socikgPyByIDogZXJyKG1hcEVyckZuKHIuZXJyb3IpKSkgYXMgUmVzdWx0PFQsIEY+O1xuICByZXR1cm4gY3VycnkxKG9wLCByZXN1bHQpO1xufVxuXG4vKipcbiAgWW91IGNhbiB0aGluayBvZiB0aGlzIGxpa2UgYSBzaG9ydC1jaXJjdWl0aW5nIGxvZ2ljYWwgXCJhbmRcIiBvcGVyYXRpb24gb24gYVxuICBgUmVzdWx0YCB0eXBlLiBJZiBgcmVzdWx0YCBpcyBgT2tgLCB0aGVuIHRoZSByZXN1bHQgaXMgdGhlIGBhbmRSZXN1bHRgLiBJZlxuICBgcmVzdWx0YCBpcyBgRXJyYCwgdGhlIHJlc3VsdCBpcyB0aGUgYEVycmAuXG5cbiAgVGhpcyBpcyB1c2VmdWwgd2hlbiB5b3UgaGF2ZSBhbm90aGVyIGBSZXN1bHRgIHZhbHVlIHlvdSB3YW50IHRvIHByb3ZpZGUgaWZcbiAgYW5kICpvbmx5IGlmKiB5b3UgaGF2ZSBhbiBgT2tgIOKAkyB0aGF0IGlzLCB3aGVuIHlvdSBuZWVkIHRvIG1ha2Ugc3VyZSB0aGF0IGlmIHlvdVxuICBgRXJyYCwgd2hhdGV2ZXIgZWxzZSB5b3UncmUgaGFuZGluZyBhIGBSZXN1bHRgIHRvICphbHNvKiBnZXRzIHRoYXQgYEVycmAuXG5cbiAgTm90aWNlIHRoYXQsIHVubGlrZSBpbiBbYG1hcGBdKCNtYXApIG9yIGl0cyB2YXJpYW50cywgdGhlIG9yaWdpbmFsIGByZXN1bHRgIGlzXG4gIG5vdCBpbnZvbHZlZCBpbiBjb25zdHJ1Y3RpbmcgdGhlIG5ldyBgUmVzdWx0YC5cblxuICAjIyMjIEV4YW1wbGVzXG5cbiAgYGBgdHNcbiAgaW1wb3J0IHsgYW5kLCBvaywgZXJyLCB0b1N0cmluZyB9IGZyb20gJ3RydWUtbXl0aC9yZXN1bHQnO1xuXG4gIGNvbnN0IG9rQSA9IG9rKCdBJyk7XG4gIGNvbnN0IG9rQiA9IG9rKCdCJyk7XG4gIGNvbnN0IGFuRXJyID0gZXJyKHsgc286ICdiYWQnIH0pO1xuXG4gIGNvbnNvbGUubG9nKHRvU3RyaW5nKGFuZChva0IsIG9rQSkpKTsgIC8vIE9rKEIpXG4gIGNvbnNvbGUubG9nKHRvU3RyaW5nKGFuZChva0IsIGFuRXJyKSkpOyAgLy8gRXJyKFtvYmplY3QgT2JqZWN0XSlcbiAgY29uc29sZS5sb2codG9TdHJpbmcoYW5kKGFuRXJyLCBva0EpKSk7ICAvLyBFcnIoW29iamVjdCBPYmplY3RdKVxuICBjb25zb2xlLmxvZyh0b1N0cmluZyhhbmQoYW5FcnIsIGFuRXJyKSkpOyAgLy8gRXJyKFtvYmplY3QgT2JqZWN0XSlcbiAgYGBgXG5cbiAgQHR5cGVwYXJhbSBUICAgICBUaGUgdHlwZSBvZiB0aGUgdmFsdWUgd3JhcHBlZCBpbiB0aGUgYE9rYCBvZiB0aGUgYFJlc3VsdGAuXG4gIEB0eXBlcGFyYW0gVSAgICAgVGhlIHR5cGUgb2YgdGhlIHZhbHVlIHdyYXBwZWQgaW4gdGhlIGBPa2Agb2YgdGhlIGBhbmRSZXN1bHRgLFxuICAgICAgICAgICAgICAgICAgIGkuZS4gdGhlIHN1Y2Nlc3MgdHlwZSBvZiB0aGUgYFJlc3VsdGAgcHJlc2VudCBpZiB0aGUgY2hlY2tlZFxuICAgICAgICAgICAgICAgICAgIGBSZXN1bHRgIGlzIGBPa2AuXG4gIEB0eXBlcGFyYW0gRSAgICAgVGhlIHR5cGUgb2YgdGhlIHZhbHVlIHdyYXBwZWQgaW4gdGhlIGBFcnJgIG9mIHRoZSBgUmVzdWx0YC5cbiAgQHBhcmFtIGFuZFJlc3VsdCBUaGUgYFJlc3VsdGAgaW5zdGFuY2UgdG8gcmV0dXJuIGlmIGByZXN1bHRgIGlzIGBFcnJgLlxuICBAcGFyYW0gcmVzdWx0ICAgIFRoZSBgUmVzdWx0YCBpbnN0YW5jZSB0byBjaGVjay5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFuZDxULCBVLCBFPihhbmRSZXN1bHQ6IFJlc3VsdDxVLCBFPiwgcmVzdWx0OiBSZXN1bHQ8VCwgRT4pOiBSZXN1bHQ8VSwgRT47XG5leHBvcnQgZnVuY3Rpb24gYW5kPFQsIFUsIEU+KGFuZFJlc3VsdDogUmVzdWx0PFUsIEU+KTogKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBSZXN1bHQ8VSwgRT47XG5leHBvcnQgZnVuY3Rpb24gYW5kPFQsIFUsIEU+KFxuICBhbmRSZXN1bHQ6IFJlc3VsdDxVLCBFPixcbiAgcmVzdWx0PzogUmVzdWx0PFQsIEU+XG4pOiBSZXN1bHQ8VSwgRT4gfCAoKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBSZXN1bHQ8VSwgRT4pIHtcbiAgY29uc3Qgb3AgPSAocjogUmVzdWx0PFQsIEU+KSA9PiAoaXNPayhyKSA/IGFuZFJlc3VsdCA6IChyIGFzIEVycjxhbnksIEU+KSk7XG4gIHJldHVybiBjdXJyeTEob3AsIHJlc3VsdCk7XG59XG5cbi8qKlxuICBBcHBseSBhIGZ1bmN0aW9uIHRvIHRoZSB3cmFwcGVkIHZhbHVlIGlmIGBPa2AgYW5kIHJldHVybiBhIG5ldyBgT2tgXG4gIGNvbnRhaW5pbmcgdGhlIHJlc3VsdGluZyB2YWx1ZTsgb3IgaWYgaXQgaXMgYEVycmAgcmV0dXJuIGl0IHVubW9kaWZpZWQuXG5cbiAgVGhpcyBkaWZmZXJzIGZyb20gYG1hcGAgaW4gdGhhdCBgdGhlbkZuYCByZXR1cm5zIGFub3RoZXIgYFJlc3VsdGAuIFlvdSBjYW4gdXNlXG4gIGBhbmRUaGVuYCB0byBjb21iaW5lIHR3byBmdW5jdGlvbnMgd2hpY2ggKmJvdGgqIGNyZWF0ZSBhIGBSZXN1bHRgIGZyb20gYW5cbiAgdW53cmFwcGVkIHR5cGUuXG5cbiAgWW91IG1heSBmaW5kIHRoZSBgLnRoZW5gIG1ldGhvZCBvbiBhbiBFUzYgYFByb21pc2VgIGhlbHBmdWwgZm9yIGNvbXBhcmlzb246IGlmXG4gIHlvdSBoYXZlIGEgYFByb21pc2VgLCB5b3UgY2FuIHBhc3MgaXRzIGB0aGVuYCBtZXRob2QgYSBjYWxsYmFjayB3aGljaFxuICByZXR1cm5zIGFub3RoZXIgYFByb21pc2VgLCBhbmQgdGhlIHJlc3VsdCB3aWxsIG5vdCBiZSBhICpuZXN0ZWQqIHByb21pc2UsIGJ1dFxuICBhIHNpbmdsZSBgUHJvbWlzZWAuIFRoZSBkaWZmZXJlbmNlIGlzIHRoYXQgYFByb21pc2UjdGhlbmAgdW53cmFwcyAqYWxsKlxuICBsYXllcnMgdG8gb25seSBldmVyIHJldHVybiBhIHNpbmdsZSBgUHJvbWlzZWAgdmFsdWUsIHdoZXJlYXMgYFJlc3VsdC5hbmRUaGVuYFxuICB3aWxsIG5vdCB1bndyYXAgbmVzdGVkIGBSZXN1bHRgcy5cblxuICBUaGlzIGlzIGFsc28gY29tbW9ubHkga25vd24gYXMgKGFuZCB0aGVyZWZvcmUgYWxpYXNlZCBhcykgW2BmbGF0TWFwYF0gb3JcbiAgW2BjaGFpbmBdLiBJdCBpcyBzb21ldGltZXMgYWxzbyBrbm93biBhcyBgYmluZGAsIGJ1dCAqbm90KiBhbGlhc2VkIGFzIHN1Y2hcbiAgYmVjYXVzZSBbYGJpbmRgIGFscmVhZHkgbWVhbnMgc29tZXRoaW5nIGluIEphdmFTY3JpcHRdW2JpbmRdLlxuXG4gIFtgZmxhdE1hcGBdOiAjZmxhdG1hcFxuICBbYGNoYWluYF06ICNjaGFpblxuICBbYmluZF06IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL0Z1bmN0aW9uL2JpbmRcblxuICAjIyMjIEV4YW1wbGVzXG5cbiAgYGBgdHNcbiAgaW1wb3J0IHsgb2ssIGVyciwgYW5kVGhlbiwgdG9TdHJpbmcgfSBmcm9tICd0cnVlLW15dGgvcmVzdWx0JztcblxuICBjb25zdCB0b0xlbmd0aEFzUmVzdWx0ID0gKHM6IHN0cmluZykgPT4gb2socy5sZW5ndGgpO1xuXG4gIGNvbnN0IGFuT2sgPSBvaygnanVzdCBhIHN0cmluZycpO1xuICBjb25zdCBsZW5ndGhBc1Jlc3VsdCA9IGFuZFRoZW4odG9MZW5ndGhBc1Jlc3VsdCwgYW5Payk7XG4gIGNvbnNvbGUubG9nKHRvU3RyaW5nKGxlbmd0aEFzUmVzdWx0KSk7ICAvLyBPaygxMylcblxuICBjb25zdCBhbkVyciA9IGVycihbJ3Nyc2x5JywgJ3doYXRldmVyJ10pO1xuICBjb25zdCBub3RMZW5ndGhBc1Jlc3VsdCA9IGFuZFRoZW4odG9MZW5ndGhBc1Jlc3VsdCwgYW5FcnIpO1xuICBjb25zb2xlLmxvZyh0b1N0cmluZyhub3RMZW5ndGhBc1Jlc3VsdCkpOyAgLy8gRXJyKHNyc2x5LHdoYXRldmVyKVxuICBgYGBcblxuICBAdHlwZXBhcmFtIFQgICBUaGUgdHlwZSBvZiB0aGUgdmFsdWUgd3JhcHBlZCBpbiB0aGUgYE9rYCBvZiB0aGUgYFJlc3VsdGAuXG4gIEB0eXBlcGFyYW0gVSAgIFRoZSB0eXBlIG9mIHRoZSB2YWx1ZSB3cmFwcGVkIGluIHRoZSBgT2tgIG9mIHRoZSBgUmVzdWx0YFxuICAgICAgICAgICAgICAgICByZXR1cm5lZCBieSB0aGUgYHRoZW5GbmAuXG4gIEB0eXBlcGFyYW0gRSAgIFRoZSB0eXBlIG9mIHRoZSB2YWx1ZSB3cmFwcGVkIGluIHRoZSBgRXJyYCBvZiB0aGUgYFJlc3VsdGAuXG4gIEBwYXJhbSB0aGVuRm4gIFRoZSBmdW5jdGlvbiB0byBhcHBseSB0byB0aGUgd3JhcHBlZCBgVGAgaWYgYG1heWJlYCBpcyBgSnVzdGAuXG4gIEBwYXJhbSByZXN1bHQgIFRoZSBgTWF5YmVgIHRvIGV2YWx1YXRlIGFuZCBwb3NzaWJseSBhcHBseSBhIGZ1bmN0aW9uIHRvLlxuICovXG5leHBvcnQgZnVuY3Rpb24gYW5kVGhlbjxULCBVLCBFPihcbiAgdGhlbkZuOiAodDogVCkgPT4gUmVzdWx0PFUsIEU+LFxuICByZXN1bHQ6IFJlc3VsdDxULCBFPlxuKTogUmVzdWx0PFUsIEU+O1xuZXhwb3J0IGZ1bmN0aW9uIGFuZFRoZW48VCwgVSwgRT4oXG4gIHRoZW5GbjogKHQ6IFQpID0+IFJlc3VsdDxVLCBFPlxuKTogKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBSZXN1bHQ8VSwgRT47XG5leHBvcnQgZnVuY3Rpb24gYW5kVGhlbjxULCBVLCBFPihcbiAgdGhlbkZuOiAodDogVCkgPT4gUmVzdWx0PFUsIEU+LFxuICByZXN1bHQ/OiBSZXN1bHQ8VCwgRT5cbik6IFJlc3VsdDxVLCBFPiB8ICgocmVzdWx0OiBSZXN1bHQ8VCwgRT4pID0+IFJlc3VsdDxVLCBFPikge1xuICBjb25zdCBvcCA9IChyOiBSZXN1bHQ8VCwgRT4pID0+IChpc09rKHIpID8gdGhlbkZuKHIudmFsdWUpIDogKHIgYXMgRXJyPGFueSwgRT4pKTtcbiAgcmV0dXJuIGN1cnJ5MShvcCwgcmVzdWx0KTtcbn1cblxuLyoqIEFsaWFzIGZvciBbYGFuZFRoZW5gXSgjYW5kdGhlbikuICovXG5leHBvcnQgY29uc3QgY2hhaW4gPSBhbmRUaGVuO1xuXG4vKiogQWxpYXMgZm9yIFtgYW5kVGhlbmBdKCNhbmR0aGVuKS4gKi9cbmV4cG9ydCBjb25zdCBmbGF0TWFwID0gYW5kVGhlbjtcblxuLyoqXG4gIFByb3ZpZGUgYSBmYWxsYmFjayBmb3IgYSBnaXZlbiBgUmVzdWx0YC4gQmVoYXZlcyBsaWtlIGEgbG9naWNhbCBgb3JgOiBpZiB0aGVcbiAgYHJlc3VsdGAgdmFsdWUgaXMgYW4gYE9rYCwgcmV0dXJucyB0aGF0IGByZXN1bHRgOyBvdGhlcndpc2UsIHJldHVybnMgdGhlXG4gIGBkZWZhdWx0UmVzdWx0YCB2YWx1ZS5cblxuICBUaGlzIGlzIHVzZWZ1bCB3aGVuIHlvdSB3YW50IHRvIG1ha2Ugc3VyZSB0aGF0IHNvbWV0aGluZyB3aGljaCB0YWtlcyBhXG4gIGBSZXN1bHRgIGFsd2F5cyBlbmRzIHVwIGdldHRpbmcgYW4gYE9rYCB2YXJpYW50LCBieSBzdXBwbHlpbmcgYSBkZWZhdWx0IHZhbHVlXG4gIGZvciB0aGUgY2FzZSB0aGF0IHlvdSBjdXJyZW50bHkgaGF2ZSBhbiBgRXJyYC5cblxuICBgYGB0c1xuICBpbXBvcnQgeyBvaywgZXJyLCBSZXN1bHQsIG9yIH0gZnJvbSAndHJ1ZS11dGlscy9yZXN1bHQnO1xuXG4gIGNvbnN0IG9rQSA9IG9rPHN0cmluZywgc3RyaW5nPignYScpO1xuICBjb25zdCBva0IgPSBvazxzdHJpbmcsIHN0cmluZz4oJ2InKTtcbiAgY29uc3QgYW5FcnIgPSBlcnI8c3RyaW5nLCBzdHJpbmc+KCc6d2F0OicpO1xuICBjb25zdCBhbm90aGVyRXJyID0gZXJyPHN0cmluZywgc3RyaW5nPignOmhlYWRkZXNrOicpO1xuXG4gIGNvbnNvbGUubG9nKG9yKG9rQiwgb2tBKS50b1N0cmluZygpKTsgIC8vIE9rKEEpXG4gIGNvbnNvbGUubG9nKG9yKGFuRXJyLCBva0EpLnRvU3RyaW5nKCkpOyAgLy8gT2soQSlcbiAgY29uc29sZS5sb2cob3Iob2tCLCBhbkVycikudG9TdHJpbmcoKSk7ICAvLyBPayhCKVxuICBjb25zb2xlLmxvZyhvcihhbm90aGVyRXJyLCBhbkVycikudG9TdHJpbmcoKSk7ICAvLyBFcnIoOmhlYWRkZXNrOilcbiAgYGBgXG5cbiAgQHR5cGVwYXJhbSBUICAgICAgICAgIFRoZSB0eXBlIHdyYXBwZWQgaW4gdGhlIGBPa2AgY2FzZSBvZiBgcmVzdWx0YC5cbiAgQHR5cGVwYXJhbSBFICAgICAgICAgIFRoZSB0eXBlIHdyYXBwZWQgaW4gdGhlIGBFcnJgIGNhc2Ugb2YgYHJlc3VsdGAuXG4gIEB0eXBlcGFyYW0gRiAgICAgICAgICBUaGUgdHlwZSB3cmFwcGVkIGluIHRoZSBgRXJyYCBjYXNlIG9mIGBkZWZhdWx0UmVzdWx0YC5cbiAgQHBhcmFtIGRlZmF1bHRSZXN1bHQgIFRoZSBgUmVzdWx0YCB0byB1c2UgaWYgYHJlc3VsdGAgaXMgYW4gYEVycmAuXG4gIEBwYXJhbSByZXN1bHQgICAgICAgICBUaGUgYFJlc3VsdGAgaW5zdGFuY2UgdG8gY2hlY2suXG4gIEByZXR1cm5zICAgICAgICAgICAgICBgcmVzdWx0YCBpZiBpdCBpcyBhbiBgT2tgLCBvdGhlcndpc2UgYGRlZmF1bHRSZXN1bHRgLlxuICovXG5leHBvcnQgZnVuY3Rpb24gb3I8VCwgRSwgRj4oZGVmYXVsdFJlc3VsdDogUmVzdWx0PFQsIEY+LCByZXN1bHQ6IFJlc3VsdDxULCBFPik6IFJlc3VsdDxULCBGPjtcbmV4cG9ydCBmdW5jdGlvbiBvcjxULCBFLCBGPihkZWZhdWx0UmVzdWx0OiBSZXN1bHQ8VCwgRj4pOiAocmVzdWx0OiBSZXN1bHQ8VCwgRT4pID0+IFJlc3VsdDxULCBGPjtcbmV4cG9ydCBmdW5jdGlvbiBvcjxULCBFLCBGPihcbiAgZGVmYXVsdFJlc3VsdDogUmVzdWx0PFQsIEY+LFxuICByZXN1bHQ/OiBSZXN1bHQ8VCwgRT5cbik6IFJlc3VsdDxULCBGPiB8ICgocmVzdWx0OiBSZXN1bHQ8VCwgRT4pID0+IFJlc3VsdDxULCBGPikge1xuICBjb25zdCBvcCA9IChyOiBSZXN1bHQ8VCwgRT4pID0+IChpc09rKHIpID8gKHIgYXMgT2s8VCwgYW55PikgOiBkZWZhdWx0UmVzdWx0KTtcbiAgcmV0dXJuIGN1cnJ5MShvcCwgcmVzdWx0KTtcbn1cblxuLyoqXG4gIExpa2UgYG9yYCwgYnV0IHVzaW5nIGEgZnVuY3Rpb24gdG8gY29uc3RydWN0IHRoZSBhbHRlcm5hdGl2ZSBgUmVzdWx0YC5cblxuICBTb21ldGltZXMgeW91IG5lZWQgdG8gcGVyZm9ybSBhbiBvcGVyYXRpb24gdXNpbmcgb3RoZXIgZGF0YSBpbiB0aGUgZW52aXJvbm1lbnRcbiAgdG8gY29uc3RydWN0IHRoZSBmYWxsYmFjayB2YWx1ZS4gSW4gdGhlc2Ugc2l0dWF0aW9ucywgeW91IGNhbiBwYXNzIGEgZnVuY3Rpb25cbiAgKHdoaWNoIG1heSBiZSBhIGNsb3N1cmUpIGFzIHRoZSBgZWxzZUZuYCB0byBnZW5lcmF0ZSB0aGUgZmFsbGJhY2sgYFJlc3VsdDxUPmAuXG4gIEl0IGNhbiB0aGVuIHRyYW5zZm9ybSB0aGUgZGF0YSBpbiB0aGUgYEVycmAgdG8gc29tZXRoaW5nIHVzYWJsZSBhcyBhbiBgT2tgLCBvclxuICBnZW5lcmF0ZSBhIG5ldyBgRXJyYCBpbnN0YW5jZSBhcyBhcHByb3ByaWF0ZS5cblxuICBVc2VmdWwgZm9yIHRyYW5zZm9ybWluZyBmYWlsdXJlcyB0byB1c2FibGUgZGF0YS5cblxuICBAcGFyYW0gZWxzZUZuIFRoZSBmdW5jdGlvbiB0byBhcHBseSB0byB0aGUgY29udGVudHMgb2YgdGhlIGBFcnJgIGlmIGByZXN1bHRgXG4gICAgICAgICAgICAgICAgaXMgYW4gYEVycmAsIHRvIGNyZWF0ZSBhIG5ldyBgUmVzdWx0YC5cbiAgQHBhcmFtIHJlc3VsdCBUaGUgYFJlc3VsdGAgdG8gdXNlIGlmIGl0IGlzIGFuIGBPa2AuXG4gIEByZXR1cm5zICAgICAgVGhlIGByZXN1bHRgIGlmIGl0IGlzIGBPa2AsIG9yIHRoZSBgUmVzdWx0YCByZXR1cm5lZCBieSBgZWxzZUZuYFxuICAgICAgICAgICAgICAgIGlmIGByZXN1bHRgIGlzIGFuIGBFcnIuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBvckVsc2U8VCwgRSwgRj4oXG4gIGVsc2VGbjogKGVycjogRSkgPT4gUmVzdWx0PFQsIEY+LFxuICByZXN1bHQ6IFJlc3VsdDxULCBFPlxuKTogUmVzdWx0PFQsIEY+O1xuZXhwb3J0IGZ1bmN0aW9uIG9yRWxzZTxULCBFLCBGPihcbiAgZWxzZUZuOiAoZXJyOiBFKSA9PiBSZXN1bHQ8VCwgRj5cbik6IChyZXN1bHQ6IFJlc3VsdDxULCBFPikgPT4gUmVzdWx0PFQsIEY+O1xuZXhwb3J0IGZ1bmN0aW9uIG9yRWxzZTxULCBFLCBGPihcbiAgZWxzZUZuOiAoZXJyOiBFKSA9PiBSZXN1bHQ8VCwgRj4sXG4gIHJlc3VsdD86IFJlc3VsdDxULCBFPlxuKTogUmVzdWx0PFQsIEY+IHwgKChyZXN1bHQ6IFJlc3VsdDxULCBFPikgPT4gUmVzdWx0PFQsIEY+KSB7XG4gIGNvbnN0IG9wID0gKHI6IFJlc3VsdDxULCBFPikgPT4gKGlzT2socikgPyAociBhcyBPazxULCBhbnk+KSA6IGVsc2VGbihyLnVuc2FmZWx5VW53cmFwRXJyKCkpKTtcbiAgcmV0dXJuIGN1cnJ5MShvcCwgcmVzdWx0KTtcbn1cblxuLyoqXG4gIEdldCB0aGUgdmFsdWUgb3V0IG9mIHRoZSBgUmVzdWx0YC5cblxuICBSZXR1cm5zIHRoZSBjb250ZW50IG9mIGFuIGBPa2AsIGJ1dCAqKnRocm93cyBpZiB0aGUgYFJlc3VsdGAgaXMgYEVycmAuKipcbiAgUHJlZmVyIHRvIHVzZSBbYHVud3JhcE9yYF0oI3Vud3JhcG9yKSBvciBbYHVud3JhcE9yRWxzZWBdKCN1bndyYXBvcmVsc2UpLlxuXG4gIEB0aHJvd3MgSWYgdGhlIGBSZXN1bHRgIGluc3RhbmNlIGlzIGBOb3RoaW5nYC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVuc2FmZWx5VW53cmFwPFQsIEU+KHJlc3VsdDogUmVzdWx0PFQsIEU+KTogVCB7XG4gIHJldHVybiByZXN1bHQudW5zYWZlbHlVbndyYXAoKTtcbn1cblxuLyoqIEFsaWFzIGZvciBbYHVuc2FmZWx5VW53cmFwYF0oI3Vuc2FmZWx5dW53cmFwKSAqL1xuZXhwb3J0IGNvbnN0IHVuc2FmZWx5R2V0ID0gdW5zYWZlbHlVbndyYXA7XG5cbi8qKiBBbGlhcyBmb3IgW2B1bnNhZmVseVVud3JhcGBdKCN1bnNhZmVseXVud3JhcCkgKi9cbmV4cG9ydCBjb25zdCB1bnNhZmVHZXQgPSB1bnNhZmVseVVud3JhcDtcblxuLyoqXG4gIEdldCB0aGUgZXJyb3IgdmFsdWUgb3V0IG9mIHRoZSBbYFJlc3VsdGBdKCNyZXN1bHQpLlxuXG4gIFJldHVybnMgdGhlIGNvbnRlbnQgb2YgYW4gYEVycmAsIGJ1dCAqKnRocm93cyBpZiB0aGUgYFJlc3VsdGAgaXMgYE9rYCoqLlxuICBQcmVmZXIgdG8gdXNlIFtgdW53cmFwT3JFbHNlYF0oI3Vud3JhcG9yZWxzZSkuXG5cbiAgQHBhcmFtIHJlc3VsdFxuICBAdGhyb3dzIEVycm9yIElmIHRoZSBgUmVzdWx0YCBpbnN0YW5jZSBpcyBgTm90aGluZ2AuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1bnNhZmVseVVud3JhcEVycjxULCBFPihyZXN1bHQ6IFJlc3VsdDxULCBFPik6IEUge1xuICByZXR1cm4gcmVzdWx0LnVuc2FmZWx5VW53cmFwRXJyKCk7XG59XG5cbi8qKiBBbGlhcyBmb3IgW2B1bnNhZmVseVVud3JhcEVycmBdKCN1bnNhZmVseXVud3JhcGVycikgKi9cbmV4cG9ydCBjb25zdCB1bnNhZmVseUdldEVyciA9IHVuc2FmZWx5VW53cmFwRXJyO1xuXG4vKipcbiAgU2FmZWx5IGdldCB0aGUgdmFsdWUgb3V0IG9mIHRoZSBgT2tgIHZhcmlhbnQgb2YgYSBbYFJlc3VsdGBdKCNyZXN1bHQpLlxuXG4gIFRoaXMgaXMgdGhlIHJlY29tbWVuZGVkIHdheSB0byBnZXQgYSB2YWx1ZSBvdXQgb2YgYSBgUmVzdWx0YCBtb3N0IG9mIHRoZSB0aW1lLlxuXG4gIGBgYHRzXG4gIGltcG9ydCB7IG9rLCBlcnIsIHVud3JhcE9yIH0gZnJvbSAndHJ1ZS1teXRoL3Jlc3VsdCc7XG5cbiAgY29uc3QgYW5PayA9IG9rPG51bWJlciwgc3RyaW5nPigxMik7XG4gIGNvbnNvbGUubG9nKHVud3JhcE9yKDAsIGFuT2spKTsgIC8vIDEyXG5cbiAgY29uc3QgYW5FcnIgPSBlcnI8bnVtYmVyLCBzdHJpbmc+KCdub29vb28nKTtcbiAgY29uc29sZS5sb2codW53cmFwT3IoMCwgYW5FcnIpKTsgIC8vIDBcbiAgYGBgXG5cbiAgQHR5cGVwYXJhbSBUICAgICAgICBUaGUgdmFsdWUgd3JhcHBlZCBpbiB0aGUgYE9rYC5cbiAgQHR5cGVwYXJhbSBFICAgICAgICBUaGUgdmFsdWUgd3JhcHBlZCBpbiB0aGUgYEVycmAuXG4gIEBwYXJhbSBkZWZhdWx0VmFsdWUgVGhlIHZhbHVlIHRvIHVzZSBpZiBgcmVzdWx0YCBpcyBhbiBgRXJyYC5cbiAgQHBhcmFtIHJlc3VsdCAgICAgICBUaGUgYFJlc3VsdGAgaW5zdGFuY2UgdG8gdW53cmFwIGlmIGl0IGlzIGFuIGBPa2AuXG4gIEByZXR1cm5zICAgICAgICAgICAgVGhlIGNvbnRlbnQgb2YgYHJlc3VsdGAgaWYgaXQgaXMgYW4gYE9rYCwgb3RoZXJ3aXNlXG4gICAgICAgICAgICAgICAgICAgICAgYGRlZmF1bHRWYWx1ZWAuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1bndyYXBPcjxULCBFPihkZWZhdWx0VmFsdWU6IFQsIHJlc3VsdDogUmVzdWx0PFQsIEU+KTogVDtcbmV4cG9ydCBmdW5jdGlvbiB1bndyYXBPcjxULCBFPihkZWZhdWx0VmFsdWU6IFQpOiAocmVzdWx0OiBSZXN1bHQ8VCwgRT4pID0+IFQ7XG5leHBvcnQgZnVuY3Rpb24gdW53cmFwT3I8VCwgRT4oXG4gIGRlZmF1bHRWYWx1ZTogVCxcbiAgcmVzdWx0PzogUmVzdWx0PFQsIEU+XG4pOiBUIHwgKChyZXN1bHQ6IFJlc3VsdDxULCBFPikgPT4gVCkge1xuICBjb25zdCBvcCA9IChyOiBSZXN1bHQ8VCwgRT4pID0+IChpc09rKHIpID8gci52YWx1ZSA6IGRlZmF1bHRWYWx1ZSk7XG4gIHJldHVybiBjdXJyeTEob3AsIHJlc3VsdCk7XG59XG5cbi8qKiBBbGlhcyBmb3IgW2B1bndyYXBPcmBdKCN1bndyYXBvcikgKi9cbmV4cG9ydCBjb25zdCBnZXRPciA9IHVud3JhcE9yO1xuXG4vKipcbiAgU2FmZWx5IGdldCB0aGUgdmFsdWUgb3V0IG9mIGEgW2BSZXN1bHRgXSgjcmVzdWx0KSBieSByZXR1cm5pbmcgdGhlIHdyYXBwZWRcbiAgdmFsdWUgaWYgaXQgaXMgYE9rYCwgb3IgYnkgYXBwbHlpbmcgYG9yRWxzZUZuYCB0byB0aGUgdmFsdWUgaW4gdGhlIGBFcnJgLlxuXG4gIFRoaXMgaXMgdXNlZnVsIHdoZW4geW91IG5lZWQgdG8gKmdlbmVyYXRlKiBhIHZhbHVlIChlLmcuIGJ5IHVzaW5nIGN1cnJlbnRcbiAgdmFsdWVzIGluIHRoZSBlbnZpcm9ubWVudCDigJMgd2hldGhlciBwcmVsb2FkZWQgb3IgYnkgbG9jYWwgY2xvc3VyZSkgaW5zdGVhZCBvZlxuICBoYXZpbmcgYSBzaW5nbGUgZGVmYXVsdCB2YWx1ZSBhdmFpbGFibGUgKGFzIGluIFtgdW53cmFwT3JgXSgjdW53cmFwb3IpKS5cblxuICBgYGB0c1xuICBpbXBvcnQgeyBvaywgZXJyLCB1bndyYXBPckVsc2UgfSBmcm9tICd0cnVlLW15dGgvcmVzdWx0JztcblxuICAvLyBZb3UgY2FuIGltYWdpbmUgdGhhdCBzb21lT3RoZXJWYWx1ZSBtaWdodCBiZSBkeW5hbWljLlxuICBjb25zdCBzb21lT3RoZXJWYWx1ZSA9IDI7XG4gIGNvbnN0IGhhbmRsZUVyciA9IChlcnJWYWx1ZTogc3RyaW5nKSA9PiBlcnJWYWx1ZS5sZW5ndGggKyBzb21lT3RoZXJWYWx1ZTtcblxuICBjb25zdCBhbk9rID0gb2s8bnVtYmVyLCBzdHJpbmc+KDQyKTtcbiAgY29uc29sZS5sb2codW53cmFwT3JFbHNlKGhhbmRsZUVyciwgYW5PaykpOyAgLy8gNDJcblxuICBjb25zdCBhbkVyciA9IGVycjxudW1iZXIsIHN0cmluZz4oJ29oIHRlaCBub2VzJyk7XG4gIGNvbnNvbGUubG9nKHVud3JhcE9yRWxzZShoYW5kbGVFcnIsIGFuRXJyKSk7ICAvLyAxM1xuICBgYGBcblxuICBAdHlwZXBhcmFtIFQgICAgVGhlIHZhbHVlIHdyYXBwZWQgaW4gdGhlIGBPa2AuXG4gIEB0eXBlcGFyYW0gRSAgICBUaGUgdmFsdWUgd3JhcHBlZCBpbiB0aGUgYEVycmAuXG4gIEBwYXJhbSBvckVsc2VGbiBBIGZ1bmN0aW9uIGFwcGxpZWQgdG8gdGhlIHZhbHVlIHdyYXBwZWQgaW4gYHJlc3VsdGAgaWYgaXQgaXNcbiAgICAgICAgICAgICAgICAgIGFuIGBFcnJgLCB0byBnZW5lcmF0ZSB0aGUgZmluYWwgdmFsdWUuXG4gIEBwYXJhbSByZXN1bHQgICBUaGUgYHJlc3VsdGAgdG8gdW53cmFwIGlmIGl0IGlzIGFuIGBPa2AuXG4gIEByZXR1cm5zICAgICAgICBUaGUgdmFsdWUgd3JhcHBlZCBpbiBgcmVzdWx0YCBpZiBpdCBpcyBgT2tgIG9yIHRoZSB2YWx1ZVxuICAgICAgICAgICAgICAgICAgcmV0dXJuZWQgYnkgYG9yRWxzZUZuYCBhcHBsaWVkIHRvIHRoZSB2YWx1ZSBpbiBgRXJyYC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVud3JhcE9yRWxzZTxULCBFPihvckVsc2VGbjogKGVycm9yOiBFKSA9PiBULCByZXN1bHQ6IFJlc3VsdDxULCBFPik6IFQ7XG5leHBvcnQgZnVuY3Rpb24gdW53cmFwT3JFbHNlPFQsIEU+KG9yRWxzZUZuOiAoZXJyb3I6IEUpID0+IFQpOiAocmVzdWx0OiBSZXN1bHQ8VCwgRT4pID0+IFQ7XG5leHBvcnQgZnVuY3Rpb24gdW53cmFwT3JFbHNlPFQsIEU+KFxuICBvckVsc2VGbjogKGVycm9yOiBFKSA9PiBULFxuICByZXN1bHQ/OiBSZXN1bHQ8VCwgRT5cbik6IFQgfCAoKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBUKSB7XG4gIGNvbnN0IG9wID0gKHI6IFJlc3VsdDxULCBFPikgPT4gKGlzT2socikgPyByLnZhbHVlIDogb3JFbHNlRm4oci5lcnJvcikpO1xuICByZXR1cm4gY3VycnkxKG9wLCByZXN1bHQpO1xufVxuXG4vKiogQWxpYXMgZm9yIFtgdW53cmFwT3JFbHNlYF0oI3Vud3JhcG9yZWxzZSkgKi9cbmV4cG9ydCBjb25zdCBnZXRPckVsc2UgPSB1bndyYXBPckVsc2U7XG5cbi8qKlxuICBDb252ZXJ0IGEgW2BSZXN1bHRgXSgjcmVzdWx0KSB0byBhIFtgTWF5YmVgXSguLi9tb2R1bGVzL19tYXliZV8uaHRtbCNtYXliZSkuXG5cbiAgVGhlIGNvbnZlcnRlZCB0eXBlIHdpbGwgYmUgW2BKdXN0YF0gaWYgdGhlIGBSZXN1bHRgIGlzIFtgT2tgXSBvciBbYE5vdGhpbmdgXVxuICBpZiB0aGUgYFJlc3VsdGAgaXMgW2BFcnJgXTsgdGhlIHdyYXBwZWQgZXJyb3IgdmFsdWUgd2lsbCBiZSBkaXNjYXJkZWQuXG5cbiAgW2BKdXN0YF06IC4uL2NsYXNzZXMvX21heWJlXy5qdXN0Lmh0bWxcbiAgW2BOb3RoaW5nYF06IC4uL2NsYXNzZXMvX21heWJlXy5ub3RoaW5nLmh0bWxcbiAgW2BPa2BdOiAuLi9jbGFzc2VzL19yZXN1bHRfLm9rLmh0bWxcbiAgW2BFcnJgXTogLi4vY2xhc3Nlcy9fcmVzdWx0Xy5lcnIuaHRtbFxuXG4gIEBwYXJhbSByZXN1bHQgVGhlIGBSZXN1bHRgIHRvIGNvbnZlcnQgdG8gYSBgTWF5YmVgXG4gIEByZXR1cm5zICAgICAgYEp1c3RgIHRoZSB2YWx1ZSBpbiBgcmVzdWx0YCBpZiBpdCBpcyBgT2tgOyBvdGhlcndpc2UgYE5vdGhpbmdgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0b01heWJlPFQ+KHJlc3VsdDogUmVzdWx0PFQsIGFueT4pOiBNYXliZTxUPiB7XG4gIHJldHVybiBpc09rKHJlc3VsdCkgPyBqdXN0KHJlc3VsdC52YWx1ZSkgOiBub3RoaW5nKCk7XG59XG5cbi8qKlxuICBUcmFuc2Zvcm0gYSBbYE1heWJlYF0oLi4vbW9kdWxlcy9fbWF5YmVfLmh0bWwjbWF5YmUpIGludG8gYSBbYFJlc3VsdGBdKCNyZXN1bHQpLlxuXG4gIElmIHRoZSBgTWF5YmVgIGlzIGEgW2BKdXN0YF0sIGl0cyB2YWx1ZSB3aWxsIGJlIHdyYXBwZWQgaW4gdGhlIFtgT2tgXSB2YXJpYW50O1xuICBpZiBpdCBpcyBhIFtgTm90aGluZ2BdIHRoZSBgZXJyVmFsdWVgIHdpbGwgYmUgd3JhcHBlZCBpbiB0aGUgW2BFcnJgXSB2YXJpYW50LlxuXG4gIFtgSnVzdGBdOiAuLi9jbGFzc2VzL19tYXliZV8uanVzdC5odG1sXG4gIFtgTm90aGluZ2BdOiAuLi9jbGFzc2VzL19tYXliZV8ubm90aGluZy5odG1sXG4gIFtgT2tgXTogLi4vY2xhc3Nlcy9fcmVzdWx0Xy5vay5odG1sXG4gIFtgRXJyYF06IC4uL2NsYXNzZXMvX3Jlc3VsdF8uZXJyLmh0bWxcblxuICBAcGFyYW0gZXJyVmFsdWUgQSB2YWx1ZSB0byB3cmFwIGluIGFuIGBFcnJgIGlmIGBtYXliZWAgaXMgYSBgTm90aGluZ2AuXG4gIEBwYXJhbSBtYXliZSAgICBUaGUgYE1heWJlYCB0byBjb252ZXJ0IHRvIGEgYFJlc3VsdGAuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmcm9tTWF5YmU8VCwgRT4oZXJyVmFsdWU6IEUsIG1heWJlOiBNYXliZTxUPik6IFJlc3VsdDxULCBFPjtcbmV4cG9ydCBmdW5jdGlvbiBmcm9tTWF5YmU8VCwgRT4oZXJyVmFsdWU6IEUpOiAobWF5YmU6IE1heWJlPFQ+KSA9PiBSZXN1bHQ8VCwgRT47XG5leHBvcnQgZnVuY3Rpb24gZnJvbU1heWJlPFQsIEU+KFxuICBlcnJWYWx1ZTogRSxcbiAgbWF5YmU/OiBNYXliZTxUPlxuKTogUmVzdWx0PFQsIEU+IHwgKChtYXliZTogTWF5YmU8VD4pID0+IFJlc3VsdDxULCBFPikge1xuICBjb25zdCBvcCA9IChtOiBNYXliZTxUPikgPT4gKGlzSnVzdChtKSA/IG9rPFQsIEU+KE1heWJlLnVuc2FmZWx5VW53cmFwKG0pKSA6IGVycjxULCBFPihlcnJWYWx1ZSkpO1xuICByZXR1cm4gY3VycnkxKG9wLCBtYXliZSk7XG59XG5cbi8qKlxuICBDcmVhdGUgYSBgU3RyaW5nYCByZXByZXNlbnRhdGlvbiBvZiBhIGByZXN1bHRgIGluc3RhbmNlLlxuXG4gIEFuIGBPa2AgaW5zdGFuY2Ugd2lsbCBiZSBwcmludGVkIGFzIGBPayg8cmVwcmVzZW50YXRpb24gb2YgdGhlIHZhbHVlPilgLCBhbmRcbiAgYW4gYEVycmAgaW5zdGFuY2Ugd2lsbCBiZSBwcmludGVkIGFzIGBFcnIoPHJlcHJlc2VudGF0aW9uIG9mIHRoZSBlcnJvcj4pYCxcbiAgd2hlcmUgdGhlIHJlcHJlc2VudGF0aW9uIG9mIHRoZSB2YWx1ZSBvciBlcnJvciBpcyBzaW1wbHkgdGhlIHZhbHVlIG9yIGVycm9yJ3NcbiAgb3duIGB0b1N0cmluZ2AgcmVwcmVzZW50YXRpb24uIEZvciBleGFtcGxlOlxuXG4gICAgICAgICAgICAgICAgY2FsbCAgICAgICAgICAgICAgICB8ICAgICAgICAgb3V0cHV0XG4gIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSB8IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgYHRvU3RyaW5nKG9rKDQyKSlgICAgICAgICAgICAgICAgIHwgYE9rKDQyKWBcbiAgYHRvU3RyaW5nKG9rKFsxLCAyLCAzXSkpYCAgICAgICAgIHwgYE9rKDEsMiwzKWBcbiAgYHRvU3RyaW5nKG9rKHsgYW46ICdvYmplY3QnIH0pKWAgIHwgYE9rKFtvYmplY3QgT2JqZWN0XSlgblxuICBgdG9TdHJpbmcoZXJyKDQyKSlgICAgICAgICAgICAgICAgfCBgRXJyKDQyKWBcbiAgYHRvU3RyaW5nKGVycihbMSwgMiwgM10pKWAgICAgICAgIHwgYEVycigxLDIsMylgXG4gIGB0b1N0cmluZyhlcnIoeyBhbjogJ29iamVjdCcgfSkpYCB8IGBFcnIoW29iamVjdCBPYmplY3RdKWBcblxuICBAdHlwZXBhcmFtIFQgVGhlIHR5cGUgb2YgdGhlIHdyYXBwZWQgdmFsdWU7IGl0cyBvd24gYC50b1N0cmluZ2Agd2lsbCBiZSB1c2VkXG4gICAgICAgICAgICAgICB0byBwcmludCB0aGUgaW50ZXJpb3IgY29udGVudHMgb2YgdGhlIGBKdXN0YCB2YXJpYW50LlxuICBAcGFyYW0gbWF5YmUgVGhlIHZhbHVlIHRvIGNvbnZlcnQgdG8gYSBzdHJpbmcuXG4gIEByZXR1cm5zICAgICBUaGUgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBgTWF5YmVgLlxuICovXG5leHBvcnQgY29uc3QgdG9TdHJpbmcgPSA8VCwgRT4ocmVzdWx0OiBSZXN1bHQ8VCwgRT4pOiBzdHJpbmcgPT4ge1xuICBjb25zdCBib2R5ID0gKGlzT2socmVzdWx0KSA/IHJlc3VsdC52YWx1ZSA6IHJlc3VsdC5lcnJvcikudG9TdHJpbmcoKTtcbiAgcmV0dXJuIGAke3Jlc3VsdC52YXJpYW50LnRvU3RyaW5nKCl9KCR7Ym9keX0pYDtcbn07XG5cbi8qKiBBIGxpZ2h0d2VpZ2h0IG9iamVjdCBkZWZpbmluZyBob3cgdG8gaGFuZGxlIGVhY2ggdmFyaWFudCBvZiBhIE1heWJlLiAqL1xuZXhwb3J0IHR5cGUgTWF0Y2hlcjxULCBFLCBBPiA9IHtcbiAgT2s6ICh2YWx1ZTogVCkgPT4gQTtcbiAgRXJyOiAoZXJyb3I6IEUpID0+IEE7XG59O1xuXG4vKipcbiAgUGVyZm9ybXMgdGhlIHNhbWUgYmFzaWMgZnVuY3Rpb25hbGl0eSBhcyBgZ2V0T3JFbHNlYCwgYnV0IGluc3RlYWQgb2Ygc2ltcGx5XG4gIHVud3JhcHBpbmcgdGhlIHZhbHVlIGlmIGl0IGlzIGBPa2AgYW5kIGFwcGx5aW5nIGEgdmFsdWUgdG8gZ2VuZXJhdGUgdGhlIHNhbWVcbiAgZGVmYXVsdCB0eXBlIGlmIGl0IGlzIGBOb3RoaW5nYCwgbGV0cyB5b3Ugc3VwcGx5IGZ1bmN0aW9ucyB3aGljaCBtYXkgdHJhbnNmb3JtXG4gIHRoZSB3cmFwcGVkIHR5cGUgaWYgaXQgaXMgYE9rYCBvciBnZXQgYSBkZWZhdWx0IHZhbHVlIGZvciBgTm90aGluZ2AuXG5cbiAgVGhpcyBpcyBraW5kIG9mIGxpa2UgYSBwb29yIG1hbidzIHZlcnNpb24gb2YgcGF0dGVybiBtYXRjaGluZywgd2hpY2hcbiAgSmF2YVNjcmlwdCBjdXJyZW50bHkgbGFja3MuXG5cbiAgSW5zdGVhZCBvZiBjb2RlIGxpa2UgdGhpczpcblxuICBgYGB0c1xuICBpbXBvcnQgeyBSZXN1bHQsIGlzT2ssIG1hdGNoIH0gZnJvbSAndHJ1ZS1teXRoL3Jlc3VsdCc7XG5cbiAgY29uc3QgbG9nVmFsdWUgPSAobWlnaHRCZUFOdW1iZXI6IFJlc3VsdDxudW1iZXIsIHN0cmluZz4pID0+IHtcbiAgICBjb25zb2xlLmxvZyhcbiAgICAgIGlzT2sobWlnaHRCZUFOdW1iZXIpXG4gICAgICAgID8gdW5zYWZlbHlVbndyYXAobWlnaHRCZUFOdW1iZXIpLnRvU3RyaW5nKClcbiAgICAgICAgOiBgVGhlcmUgd2FzIGFuIGVycm9yOiAke3Vuc2FmZWx5R2V0RXJyKG1pZ2h0QmVBTnVtYmVyKX1gXG4gICAgKTtcbiAgfTtcbiAgYGBgXG5cbiAgLi4ud2UgY2FuIHdyaXRlIGNvZGUgbGlrZSB0aGlzOlxuXG4gIGBgYHRzXG4gIGltcG9ydCB7IFJlc3VsdCwgbWF0Y2ggfSBmcm9tICd0cnVlLW15dGgvcmVzdWx0JztcblxuICBjb25zdCBsb2dWYWx1ZSA9IChtaWdodEJlQU51bWJlcjogUmVzdWx0PG51bWJlciwgc3RyaW5nPikgPT4ge1xuICAgIGNvbnN0IHZhbHVlID0gbWF0Y2goXG4gICAgICB7XG4gICAgICAgIE9rOiBuID0+IG4udG9TdHJpbmcoKSxcbiAgICAgICAgRXJyOiBlID0+IGBUaGVyZSB3YXMgYW4gZXJyb3I6ICR7ZX1gLFxuICAgICAgfSxcbiAgICAgIG1pZ2h0QmVBTnVtYmVyXG4gICAgKTtcbiAgICBjb25zb2xlLmxvZyh2YWx1ZSk7XG4gIH07XG4gIGBgYFxuXG4gIFRoaXMgaXMgc2xpZ2h0bHkgbG9uZ2VyIHRvIHdyaXRlLCBidXQgY2xlYXJlcjogdGhlIG1vcmUgY29tcGxleCB0aGUgcmVzdWx0aW5nXG4gIGV4cHJlc3Npb24sIHRoZSBoYWlyZXIgaXQgaXMgdG8gdW5kZXJzdGFuZCB0aGUgdGVybmFyeS4gVGh1cywgdGhpcyBpc1xuICBlc3BlY2lhbGx5IGNvbnZlbmllbnQgZm9yIHRpbWVzIHdoZW4gdGhlcmUgaXMgYSBjb21wbGV4IHJlc3VsdCwgZS5nLiB3aGVuXG4gIHJlbmRlcmluZyBwYXJ0IG9mIGEgUmVhY3QgY29tcG9uZW50IGlubGluZSBpbiBKU1gvVFNYLlxuXG4gIEBwYXJhbSBtYXRjaGVyIEEgbGlnaHR3ZWlnaHQgb2JqZWN0IGRlZmluaW5nIHdoYXQgdG8gZG8gaW4gdGhlIGNhc2Ugb2YgZWFjaFxuICAgICAgICAgICAgICAgICB2YXJpYW50LlxuICBAcGFyYW0gbWF5YmUgICBUaGUgYG1heWJlYCBpbnN0YW5jZSB0byBjaGVjay5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1hdGNoPFQsIEUsIEE+KG1hdGNoZXI6IE1hdGNoZXI8VCwgRSwgQT4sIHJlc3VsdDogUmVzdWx0PFQsIEU+KTogQTtcbmV4cG9ydCBmdW5jdGlvbiBtYXRjaDxULCBFLCBBPihtYXRjaGVyOiBNYXRjaGVyPFQsIEUsIEE+KTogKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBBO1xuZXhwb3J0IGZ1bmN0aW9uIG1hdGNoPFQsIEUsIEE+KFxuICBtYXRjaGVyOiBNYXRjaGVyPFQsIEUsIEE+LFxuICByZXN1bHQ/OiBSZXN1bHQ8VCwgRT5cbik6IEEgfCAoKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBBKSB7XG4gIGNvbnN0IG9wID0gKHI6IFJlc3VsdDxULCBFPikgPT4gbWFwT3JFbHNlKG1hdGNoZXIuRXJyLCBtYXRjaGVyLk9rLCByKTtcbiAgcmV0dXJuIGN1cnJ5MShvcCwgcmVzdWx0KTtcbn1cblxuLyoqIEFsaWFzIGZvciBbYG1hdGNoYF0oI21hdGNoKSAqL1xuZXhwb3J0IGNvbnN0IGNhdGEgPSBtYXRjaDtcblxuLyoqXG4gIEFsbG93cyBxdWljayB0cmlwbGUtZXF1YWwgZXF1YWxpdHkgY2hlY2sgYmV0d2VlbiB0aGUgdmFsdWVzIGluc2lkZSB0d28gYHJlc3VsdGBzXG4gIHdpdGhvdXQgaGF2aW5nIHRvIHVud3JhcCB0aGVtIGZpcnN0LlxuXG4gIGBgYHRzXG4gIGNvbnN0IGEgPSBSZXN1bHQub2YoMylcbiAgY29uc3QgYiA9IFJlc3VsdC5vZigzKVxuICBjb25zdCBjID0gUmVzdWx0Lm9mKG51bGwpXG4gIGNvbnN0IGQgPSBSZXN1bHQubm90aGluZygpXG5cbiAgUmVzdWx0LmVxdWFscyhhLCBiKSAvLyB0cnVlXG4gIFJlc3VsdC5lcXVhbHMoYSwgYykgLy8gZmFsc2VcbiAgUmVzdWx0LmVxdWFscyhjLCBkKSAvLyB0cnVlXG4gIGBgYFxuXG4gIEBwYXJhbSByZXN1bHRCIEEgYG1heWJlYCB0byBjb21wYXJlIHRvLlxuICBAcGFyYW0gcmVzdWx0QSBBIGBtYXliZWAgaW5zdGFuY2UgdG8gY2hlY2suXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBlcXVhbHM8VCwgRT4ocmVzdWx0QjogUmVzdWx0PFQsIEU+LCByZXN1bHRBOiBSZXN1bHQ8VCwgRT4pOiBib29sZWFuO1xuZXhwb3J0IGZ1bmN0aW9uIGVxdWFsczxULCBFPihyZXN1bHRCOiBSZXN1bHQ8VCwgRT4pOiAocmVzdWx0QTogUmVzdWx0PFQsIEU+KSA9PiBib29sZWFuO1xuZXhwb3J0IGZ1bmN0aW9uIGVxdWFsczxULCBFPihcbiAgcmVzdWx0QjogUmVzdWx0PFQsIEU+LFxuICByZXN1bHRBPzogUmVzdWx0PFQsIEU+XG4pOiBib29sZWFuIHwgKChhOiBSZXN1bHQ8VCwgRT4pID0+IGJvb2xlYW4pIHtcbiAgcmV0dXJuIHJlc3VsdEEgIT09IHVuZGVmaW5lZFxuICAgID8gcmVzdWx0QS5tYXRjaCh7XG4gICAgICAgIEVycjogKCkgPT4gaXNFcnIocmVzdWx0QiksXG4gICAgICAgIE9rOiBhID0+IGlzT2socmVzdWx0QikgJiYgcmVzdWx0Qi51bnNhZmVseVVud3JhcCgpID09PSBhLFxuICAgICAgfSlcbiAgICA6IChjdXJyaWVkUmVzdWx0QTogUmVzdWx0PFQsIEU+KSA9PlxuICAgICAgICBjdXJyaWVkUmVzdWx0QS5tYXRjaCh7XG4gICAgICAgICAgRXJyOiAoKSA9PiBpc0VycihyZXN1bHRCKSxcbiAgICAgICAgICBPazogYSA9PiBpc09rKHJlc3VsdEIpICYmIHJlc3VsdEIudW5zYWZlbHlVbndyYXAoKSA9PT0gYSxcbiAgICAgICAgfSk7XG59XG5cbi8qKlxuICBBbGxvd3MgeW91IHRvICphcHBseSogKHRodXMgYGFwYCkgYSB2YWx1ZSB0byBhIGZ1bmN0aW9uIHdpdGhvdXQgaGF2aW5nIHRvXG4gIHRha2UgZWl0aGVyIG91dCBvZiB0aGUgY29udGV4dCBvZiB0aGVpciBgUmVzdWx0YHMuIFRoaXMgZG9lcyBtZWFuIHRoYXQgdGhlXG4gIHRyYW5zZm9ybWluZyBmdW5jdGlvbiBpcyBpdHNlbGYgd2l0aGluIGEgYFJlc3VsdGAsIHdoaWNoIGNhbiBiZSBoYXJkIHRvIGdyb2tcbiAgYXQgZmlyc3QgYnV0IGxldHMgeW91IGRvIHNvbWUgdmVyeSBlbGVnYW50IHRoaW5ncy4gRm9yIGV4YW1wbGUsIGBhcGAgYWxsb3dzXG4gIHlvdSB0byBkbyB0aGlzOlxuXG4gIGBgYHRzXG4gIGltcG9ydCBSZXN1bHQgZnJvbSAndHJ1ZS1teXRoL3Jlc3VsdCc7XG5cbiAgY29uc3Qgb25lID0gUmVzdWx0Lm9rPG51bWJlciwgc3RyaW5nPigxKTtcbiAgY29uc3QgZml2ZSA9IFJlc3VsdC5vazxudW1iZXIsIHN0cmluZz4oNSk7XG4gIGNvbnN0IHdob29wcyA9IFJlc3VsdC5lcnI8bnVtYmVyLCBzdHJpbmc+KCdvaCBubycpO1xuXG4gIGNvbnN0IGFkZCA9IChhOiBudW1iZXIpID0+IChiOiBudW1iZXIpID0+IGEgKyBiO1xuICBjb25zdCByZXN1bHRBZGQgPSBSZXN1bHQub2s8dHlwZW9mIGFkZCwgc3RyaW5nPihhZGQpO1xuXG4gIHJlc3VsdEFkZC5hcChvbmUpLmFwKGZpdmUpOyAvLyBPayg2KVxuICByZXN1bHRBZGQuYXAob25lKS5hcCh3aG9vcHMpOyAvLyBFcnIoJ29oIG5vJylcbiAgcmVzdWx0QWRkLmFwKHdob29wcykuYXAoZml2ZSkgLy8gRXJyKCdvaCBubycpXG4gIGBgYFxuXG4gIFdpdGhvdXQgYFJlc3VsdC5hcGAsIHlvdSdkIG5lZWQgdG8gZG8gc29tZXRoaW5nIGxpa2UgYSBuZXN0ZWQgYFJlc3VsdC5tYXRjaGA6XG5cbiAgYGBgdHNcbiAgaW1wb3J0IHsgb2ssIGVyciB9IGZyb20gJ3RydWUtbXl0aC9yZXN1bHQnO1xuXG4gIGNvbnN0IG9uZSA9IG9rPG51bWJlciwgc3RyaW5nPigxKTtcbiAgY29uc3QgZml2ZSA9IG9rPG51bWJlciwgc3RyaW5nPig1KTtcbiAgY29uc3Qgd2hvb3BzID0gZXJyPG51bWJlciwgc3RyaW5nPignb2ggbm8nKTtcblxuICBvbmUubWF0Y2goe1xuICAgIE9rOiBuID0+IGZpdmUubWF0Y2goe1xuICAgICAgT2s6IG8gPT4gb2s8bnVtYmVyLCBzdHJpbmc+KG4gKyBvKSxcbiAgICAgIEVycjogZSA9PiBlcnI8bnVtYmVyLCBzdHJpbmc+KGUpLFxuICAgIH0pLFxuICAgIEVycjogZSAgPT4gZXJyPG51bWJlciwgc3RyaW5nPihlKSxcbiAgfSk7IC8vIE9rKDYpXG5cbiAgb25lLm1hdGNoKHtcbiAgICBPazogbiA9PiB3aG9vcHMubWF0Y2goe1xuICAgICAgT2s6IG8gPT4gb2s8bnVtYmVyLCBzdHJpbmc+KG4gKyBvKSxcbiAgICAgIEVycjogZSA9PiBlcnI8bnVtYmVyLCBzdHJpbmc+KGUpLFxuICAgIH0pLFxuICAgIEVycjogZSAgPT4gZXJyPG51bWJlciwgc3RyaW5nPihlKSxcbiAgfSk7IC8vIEVycignb2ggbm8nKVxuXG4gIHdob29wcy5tYXRjaCh7XG4gICAgT2s6IG4gPT4gZml2ZS5tYXRjaCh7XG4gICAgICBPazogbyA9PiBvayhuICsgbyksXG4gICAgICBFcnI6IGUgPT4gZXJyKGUpLFxuICAgIH0pLFxuICAgIEVycjogZSAgPT4gZXJyKGUpLFxuICB9KTsgLy8gRXJyKCdvaCBubycpXG4gIGBgYFxuXG4gIEFuZCB0aGlzIGtpbmQgb2YgdGhpbmcgY29tZXMgdXAgcXVpdGUgb2Z0ZW4gb25jZSB5b3UncmUgdXNpbmcgYE1heWJlYCB0b1xuICBoYW5kbGUgb3B0aW9uYWxpdHkgdGhyb3VnaG91dCB5b3VyIGFwcGxpY2F0aW9uLlxuXG4gIEZvciBhbm90aGVyIGV4YW1wbGUsIGltYWdpbmUgeW91IG5lZWQgdG8gY29tcGFyZSB0aGUgZXF1YWxpdHkgb2YgdHdvXG4gIEltbXV0YWJsZUpTIGRhdGEgc3RydWN0dXJlcywgd2hlcmUgYSBgPT09YCBjb21wYXJpc29uIHdvbid0IHdvcmsuIFdpdGggYGFwYCxcbiAgdGhhdCdzIGFzIHNpbXBsZSBhcyB0aGlzOlxuXG4gIGBgYHRzXG4gIGltcG9ydCB7IG9rIH0gZnJvbSAndHJ1ZS1teXRoL3Jlc3VsdCc7XG4gIGltcG9ydCBJbW11dGFibGUgZnJvbSAnaW1tdXRhYmxlJztcbiAgaW1wb3J0IHsgY3VycnkgfSBmcm9tICdsb2Rhc2gnXG5cbiAgY29uc3QgaXMgPSBjdXJyeShJbW11dGFibGUuaXMpO1xuXG4gIGNvbnN0IHggPSBvayhJbW11dGFibGUuU2V0Lm9mKDEsIDIsIDMpKTtcbiAgY29uc3QgeSA9IG9rKEltbXV0YWJsZS5TZXQub2YoMiwgMywgNCkpO1xuXG4gIG9rKGlzKS5hcCh4KS5hcCh5KTsgLy8gT2soZmFsc2UpXG4gIGBgYFxuXG4gIFdpdGhvdXQgYGFwYCwgd2UncmUgYmFjayB0byB0aGF0IGduYXJseSBuZXN0ZWQgYG1hdGNoYDpcblxuICBgYGB0c1xuICAgKiBpbXBvcnQgUmVzdWx0LCB7IG9rLCBlcnIgfSBmcm9tICd0cnVlLW15dGgvcmVzdWx0JztcbiAgaW1wb3J0IEltbXV0YWJsZSBmcm9tICdpbW11dGFibGUnO1xuICBpbXBvcnQgeyBjdXJyeSB9IGZyb20gJ2xvZGFzaCdcblxuICBjb25zdCBpcyA9IGN1cnJ5KEltbXV0YWJsZS5pcyk7XG5cbiAgY29uc3QgeCA9IG9rKEltbXV0YWJsZS5TZXQub2YoMSwgMiwgMykpO1xuICBjb25zdCB5ID0gb2soSW1tdXRhYmxlLlNldC5vZigyLCAzLCA0KSk7XG5cbiAgeC5tYXRjaCh7XG4gICAgT2s6IGlYID0+IHkubWF0Y2goe1xuICAgICAgT2s6IGlZID0+IFJlc3VsdC5vZihJbW11dGFibGUuaXMoaVgsIGlZKSksXG4gICAgICBFcnI6IChlKSA9PiBvayhmYWxzZSksXG4gICAgfSlcbiAgICBFcnI6IChlKSA9PiBvayhmYWxzZSksXG4gIH0pOyAvLyBPayhmYWxzZSlcbiAgYGBgXG5cbiAgSW4gc3VtbWFyeTogYW55d2hlcmUgeW91IGhhdmUgdHdvIGBNYXliZWAgaW5zdGFuY2VzIGFuZCBuZWVkIHRvIHBlcmZvcm0gYW5cbiAgb3BlcmF0aW9uIHRoYXQgdXNlcyBib3RoIG9mIHRoZW0sIGBhcGAgaXMgeW91ciBmcmllbmQuXG5cbiAgVHdvIHRoaW5ncyB0byBub3RlLCBib3RoIHJlZ2FyZGluZyAqY3VycnlpbmcqOlxuXG4gIDEuICBBbGwgZnVuY3Rpb25zIHBhc3NlZCB0byBgYXBgIG11c3QgYmUgY3VycmllZC4gVGhhdCBpcywgdGhleSBtdXN0IGJlIG9mIHRoZVxuICAgICAgZm9ybSAoZm9yIGFkZCkgYChhOiBudW1iZXIpID0+IChiOiBudW1iZXIpID0+IGEgKyBiYCwgKm5vdCogdGhlIG1vcmUgdXN1YWxcbiAgICAgIGAoYTogbnVtYmVyLCBiOiBudW1iZXIpID0+IGEgKyBiYCB5b3Ugc2VlIGluIEphdmFTY3JpcHQgbW9yZSBnZW5lcmFsbHkuXG5cbiAgICAgIEZvciBjb252ZW5pZW5jZSwgeW91IG1heSB3YW50IHRvIGxvb2sgYXQgTG9kYXNoJ3MgYF8uY3VycnlgIG9yIFJhbWRhJ3NcbiAgICAgIGBSLmN1cnJ5YCwgd2hpY2ggYWxsb3cgeW91IHRvIGNyZWF0ZSBjdXJyaWVkIHZlcnNpb25zIG9mIGZ1bmN0aW9uc1xuICAgICAgd2hlbmV2ZXIgeW91IHdhbnQ6XG5cbiAgICAgIGBgYFxuICAgICAgaW1wb3J0IFJlc3VsdCBmcm9tICd0cnVlLW15dGgvcmVzdWx0JztcbiAgICAgIGltcG9ydCB7IGN1cnJ5IH0gZnJvbSAnbG9kYXNoJztcblxuICAgICAgY29uc3Qgbm9ybWFsQWRkID0gKGE6IG51bWJlciwgYjogbnVtYmVyKSA9PiBhICsgYjtcbiAgICAgIGNvbnN0IGN1cnJpZWRBZGQgPSBjdXJyeShub3JtYWxBZGQpOyAvLyAoYTogbnVtYmVyKSA9PiAoYjogbnVtYmVyKSA9PiBhICsgYjtcblxuICAgICAgUmVzdWx0Lm9mKGN1cnJpZWRBZGQpLmFwKFJlc3VsdC5vZigxKSkuYXAoUmVzdWx0Lm9mKDUpKTsgLy8gT2soNilcbiAgICAgIGBgYFxuXG4gIDIuICBZb3Ugd2lsbCBuZWVkIHRvIGNhbGwgYGFwYCBhcyBtYW55IHRpbWVzIGFzIHRoZXJlIGFyZSBhcmd1bWVudHMgdG8gdGhlXG4gICAgICBmdW5jdGlvbiB5b3UncmUgZGVhbGluZyB3aXRoLiBTbyBpbiB0aGUgY2FzZSBvZiBgYWRkYCwgd2hpY2ggaGFzIHRoZVxuICAgICAgXCJhcml0eVwiIChmdW5jdGlvbiBhcmd1bWVudCBjb3VudCkgb2YgMiAoYGFgIGFuZCBgYmApLCB5b3UnbGwgbmVlZCB0byBjYWxsXG4gICAgICBgYXBgIHR3aWNlOiBvbmNlIGZvciBgYWAsIGFuZCBvbmNlIGZvciBgYmAuIFRvIHNlZSB3aHksIGxldCdzIGxvb2sgYXQgd2hhdFxuICAgICAgdGhlIHJlc3VsdCBpbiBlYWNoIHBoYXNlIGlzOlxuXG4gICAgICBgYGB0c1xuICAgICAgY29uc3QgYWRkID0gKGE6IG51bWJlcikgPT4gKGI6IG51bWJlcikgPT4gYSArIGI7XG5cbiAgICAgIGNvbnN0IG1heWJlQWRkID0gUmVzdWx0Lm9mKGFkZCk7IC8vIE9rKChhOiBudW1iZXIpID0+IChiOiBudW1iZXIpID0+IGEgKyBiKVxuICAgICAgY29uc3QgbWF5YmVBZGQxID0gbWF5YmVBZGQuYXAoUmVzdWx0Lm9mKDEpKTsgLy8gT2soKGI6IG51bWJlcikgPT4gMSArIGIpXG4gICAgICBjb25zdCBmaW5hbCA9IG1heWJlQWRkMS5hcChSZXN1bHQub2YoMykpOyAvLyBPayg0KVxuICAgICAgYGBgXG5cbiAgICAgIFNvIGZvciBgdG9TdHJpbmdgLCB3aGljaCBqdXN0IHRha2VzIGEgc2luZ2xlIGFyZ3VtZW50LCB5b3Ugd291bGQgb25seSBuZWVkXG4gICAgICB0byBjYWxsIGBhcGAgb25jZS5cblxuICAgICAgYGBgdHNcbiAgICAgIGNvbnN0IHRvU3RyID0gKHY6IHsgdG9TdHJpbmcoKTogc3RyaW5nIH0pID0+IHYudG9TdHJpbmcoKTtcbiAgICAgIFJlc3VsdC5vZih0b1N0cikuYXAoMTIpOyAvLyBPayhcIjEyXCIpXG4gICAgICBgYGBcblxuICBPbmUgb3RoZXIgc2NlbmFyaW8gd2hpY2ggZG9lc24ndCBjb21lIHVwICpxdWl0ZSogYXMgb2Z0ZW4gYnV0IGlzIGNvbmNlaXZhYmxlXG4gIGlzIHdoZXJlIHlvdSBoYXZlIHNvbWV0aGluZyB0aGF0IG1heSBvciBtYXkgbm90IGFjdHVhbGx5IGNvbnN0cnVjdCBhIGZ1bmN0aW9uXG4gIGZvciBoYW5kbGluZyBhIHNwZWNpZmljIGBSZXN1bHRgIHNjZW5hcmlvLiBJbiB0aGF0IGNhc2UsIHlvdSBjYW4gd3JhcCB0aGVcbiAgcG9zc2libHktcHJlc2VudCBpbiBgYXBgIGFuZCB0aGVuIHdyYXAgdGhlIHZhbHVlcyB0byBhcHBseSB0byB0aGUgZnVuY3Rpb24gdG9cbiAgaW4gYFJlc3VsdGAgdGhlbXNlbHZlcy5cblxuICBCZWNhdXNlIGBSZXN1bHRgIG9mdGVuIHJlcXVpcmVzIHlvdSB0byB0eXBlIG91dCB0aGUgZnVsbCB0eXBlIHBhcmFtZXRlcml6YXRpb25cbiAgb24gYSByZWd1bGFyIGJhc2lzLCBpdCdzIGNvbnZlbmllbnQgdG8gdXNlIFR5cGVTY3JpcHQncyBgdHlwZW9mYCBvcGVyYXRvciB0b1xuICB3cml0ZSBvdXQgdGhlIHR5cGUgb2YgYSBjdXJyaWVkIGZ1bmN0aW9uLiBGb3IgZXhhbXBsZSwgaWYgeW91IGhhZCBhIGZ1bmN0aW9uXG4gIHRoYXQgc2ltcGx5IG1lcmdlZCB0aHJlZSBzdHJpbmdzLCB5b3UgbWlnaHQgd3JpdGUgaXQgbGlrZSB0aGlzOlxuXG4gIGBgYHRzXG4gIGltcG9ydCBSZXN1bHQgZnJvbSAndHJ1ZS1teXRoL3Jlc3VsdCc7XG4gIGltcG9ydCB7IGN1cnJ5IH0gZnJvbSAnbG9kYXNoJztcblxuICBjb25zdCBtZXJnZTNTdHJzID0gKGE6IHN0cmluZywgYjogc3RyaW5nLCBjOiBzdHJpbmcpID0+IHN0cmluZztcbiAgY29uc3QgY3VycmllZE1lcmdlID0gY3VycnkobWVyZ2UzU3Rycyk7XG5cbiAgY29uc3QgZm4gPSBSZXN1bHQub2s8dHlwZW9mIGN1cnJpZWRNZXJnZSwgc3RyaW5nPihjdXJyaWVkTWVyZ2UpO1xuICBgYGBcblxuICBUaGUgYWx0ZXJuYXRpdmUgaXMgd3JpdGluZyBvdXQgdGhlIGZ1bGwgc2lnbmF0dXJlIGxvbmctZm9ybTpcblxuICBgYGB0c1xuICBjb25zdCBmbiA9IFJlc3VsdC5vazwoYTogc3RyaW5nKSA9PiAoYjogc3RyaW5nKSA9PiAoYzogc3RyaW5nKSA9PiBzdHJpbmcsIHN0cmluZz4oY3VycmllZE1lcmdlKTtcbiAgYGBgXG5cbiAgKipBc2lkZToqKiBgYXBgIGlzIG5vdCBuYW1lZCBgYXBwbHlgIGJlY2F1c2Ugb2YgdGhlIG92ZXJsYXAgd2l0aCBKYXZhU2NyaXB0J3NcbiAgZXhpc3RpbmcgW2BhcHBseWBdIGZ1bmN0aW9uIOKAkyBhbmQgYWx0aG91Z2ggc3RyaWN0bHkgc3BlYWtpbmcsIHRoZXJlIGlzbid0IGFueVxuICBkaXJlY3Qgb3ZlcmxhcCAoYFJlc3VsdC5hcHBseWAgYW5kIGBGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHlgIGRvbid0IGludGVyc2VjdFxuICBhdCBhbGwpIGl0J3MgdXNlZnVsIHRvIGhhdmUgYSBkaWZmZXJlbnQgbmFtZSB0byBhdm9pZCBpbXBseWluZyB0aGF0IHRoZXkncmVcbiAgdGhlIHNhbWUuXG5cbiAgW2BhcHBseWBdOiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9GdW5jdGlvbi9hcHBseVxuXG4gIEBwYXJhbSByZXN1bHRGbiByZXN1bHQgb2YgYSBmdW5jdGlvbiBmcm9tIFQgdG8gVVxuICBAcGFyYW0gcmVzdWx0IHJlc3VsdCBvZiBhIFQgdG8gYXBwbHkgdG8gYGZuYFxuICovXG5leHBvcnQgZnVuY3Rpb24gYXA8VCwgVSwgRT4ocmVzdWx0Rm46IFJlc3VsdDwodDogVCkgPT4gVSwgRT4sIHJlc3VsdDogUmVzdWx0PFQsIEU+KTogUmVzdWx0PFUsIEU+O1xuZXhwb3J0IGZ1bmN0aW9uIGFwPFQsIFUsIEU+KFxuICByZXN1bHRGbjogUmVzdWx0PCh0OiBUKSA9PiBVLCBFPlxuKTogKHJlc3VsdDogUmVzdWx0PFQsIEU+KSA9PiBSZXN1bHQ8VSwgRT47XG5leHBvcnQgZnVuY3Rpb24gYXA8VCwgVSwgRT4oXG4gIHJlc3VsdEZuOiBSZXN1bHQ8KHZhbDogVCkgPT4gVSwgRT4sXG4gIHJlc3VsdD86IFJlc3VsdDxULCBFPlxuKTogUmVzdWx0PFUsIEU+IHwgKCh2YWw6IFJlc3VsdDxULCBFPikgPT4gUmVzdWx0PFUsIEU+KSB7XG4gIGNvbnN0IG9wID0gKHI6IFJlc3VsdDxULCBFPikgPT5cbiAgICByLm1hdGNoKHtcbiAgICAgIE9rOiB2YWwgPT4gcmVzdWx0Rm4ubWFwKGZuID0+IGZuKHZhbCkpLFxuICAgICAgRXJyOiBlID0+IFJlc3VsdC5lcnI8VSwgRT4oZSksXG4gICAgfSk7XG5cbiAgcmV0dXJuIGN1cnJ5MShvcCwgcmVzdWx0KTtcbn1cblxuLyoqXG4gIERldGVybWluZSB3aGV0aGVyIGFuIGl0ZW0gaXMgYW4gaW5zdGFuY2Ugb2YgYEp1c3RgIG9yIGBOb3RoaW5nYC5cblxuICBAcGFyYW0gaXRlbSBUaGUgaXRlbSB0byBjaGVjay5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzSW5zdGFuY2U8VCA9IGFueSwgRSA9IGFueT4oaXRlbTogYW55KTogaXRlbSBpcyBSZXN1bHQ8VCwgRT4ge1xuICByZXR1cm4gaXRlbSBpbnN0YW5jZW9mIE9rIHx8IGl0ZW0gaW5zdGFuY2VvZiBFcnI7XG59XG5cbi8qKlxuICBBIHZhbHVlIHdoaWNoIG1heSAoYE9rYCkgb3IgbWF5IG5vdCAoYEVycmApIGJlIHByZXNlbnQuXG5cbiAgVGhlIGJlaGF2aW9yIG9mIHRoaXMgdHlwZSBpcyBjaGVja2VkIGJ5IFR5cGVTY3JpcHQgYXQgY29tcGlsZSB0aW1lLCBhbmQgYmVhcnNcbiAgbm8gcnVudGltZSBvdmVyaGVhZCBvdGhlciB0aGFuIHRoZSB2ZXJ5IHNtYWxsIGNvc3Qgb2YgdGhlIGNvbnRhaW5lciBvYmplY3QuXG4gKi9cbmV4cG9ydCB0eXBlIFJlc3VsdDxULCBFPiA9IE9rPFQsIEU+IHwgRXJyPFQsIEU+O1xuZXhwb3J0IGNvbnN0IFJlc3VsdCA9IHtcbiAgVmFyaWFudCxcbiAgT2ssXG4gIEVycixcbiAgaXNPayxcbiAgaXNFcnIsXG4gIG9rLFxuICBlcnIsXG4gIG1hcCxcbiAgbWFwT3IsXG4gIG1hcE9yRWxzZSxcbiAgbWFwRXJyLFxuICBhbmQsXG4gIGFuZFRoZW4sXG4gIGNoYWluLFxuICBmbGF0TWFwLFxuICBvcixcbiAgb3JFbHNlLFxuICB1bnNhZmVseVVud3JhcCxcbiAgdW5zYWZlbHlHZXQsXG4gIHVuc2FmZUdldCxcbiAgdW5zYWZlbHlVbndyYXBFcnIsXG4gIHVuc2FmZWx5R2V0RXJyLFxuICB1bndyYXBPcixcbiAgZ2V0T3IsXG4gIHVud3JhcE9yRWxzZSxcbiAgZ2V0T3JFbHNlLFxuICB0b01heWJlLFxuICBmcm9tTWF5YmUsXG4gIHRvU3RyaW5nLFxuICBtYXRjaCxcbiAgY2F0YSxcbiAgZXF1YWxzLFxuICBhcCxcbiAgaXNJbnN0YW5jZSxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFJlc3VsdDtcbiJdfQ==